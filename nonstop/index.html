<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NGUYEN BAC SON - NONSTOP</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px 0; /* Th√™m padding cho n·ªôi dung */
            background-color: #0d0d1a; /* N·ªÅn t·ªëi h∆°n */
            color: white;
            font-family: Arial, sans-serif;
            overflow-x: hidden; /* Ch·ªâ ngƒÉn cu·ªôn ngang */
        }

        /* Ti√™u ƒë·ªÅ b√†i h√°t, s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t b·∫±ng JS */
        #currentSongTitle {
            margin-bottom: 20px;
            color: #61dafb;
            text-shadow: 0 0 15px rgba(97, 218, 251, 0.5);
            font-size: 1.5rem;
            text-align: center;
        }
        
        /* Menu ch·ªçn nh·∫°c */
        #songSelector {
            background-color: #1e2126;
            color: #61dafb;
            border: 2px solid #61dafb;
            padding: 10px;
            font-size: 16px;
            margin-bottom: 20px; /* Kho·∫£ng c√°ch gi·ªØa menu v√† player */
            border-radius: 5px;
            width: 80%;
            max-width: 600px;
            cursor: pointer;
        }

        #audioElement {
            width: 80%;
            max-width: 600px;
            margin-top: 0; /* X√≥a margin-top v√¨ ƒë√£ c√≥ menu ·ªü tr√™n */
            filter: invert(0.9) hue-rotate(180deg);
        }

        #visualizerCanvas {
            border: none;
            background-color: #0d0d1a;
            margin-top: 20px; /* Th√™m kho·∫£ng c√°ch v·ªõi player */
            box-shadow: 0 0 50px rgba(0, 255, 255, 0.1);
            max-width: 900px; /* ƒê·∫∑t chi·ªÅu r·ªông t·ªëi ƒëa */
            width: 90%; /* Responsive */
        }

    </style>
</head>
<body>

    <h1 id="currentSongTitle">Loading playlist...</h1>
    
    <select id="songSelector"></select>

    <audio id="audioElement" controls crossorigin="anonymous"></audio>

    <canvas id="visualizerCanvas"></canvas>

    <script>
        // --- üéµ YOUR PLAYLIST üéµ ---
        //
        // Th√™m c√°c b√†i nh·∫°c c·ªßa b·∫°n v√†o ƒë√¢y.
        // Ch·ªâ c·∫ßn cung c·∫•p 'title' (t√™n hi·ªÉn th·ªã) v√† 'src' (URL c·ªßa file mp3).
        //
        const playlist = [
            {
                title: "Fortune Telling ",
                src: "https://nguyenbacson.io.vn/nguyenbacson-music.mp3"
            },
            {
                title: "Bass Down Low",
                src: "https://nguyenbacson.io.vn/nguyenbacson.mp3" 
            },
            {
                title: "More updates coming soon",
                src: "URL_BAI_NHAC_THU_3_CUA_BAN.mp3" // 
            }
            


        // C√†i ƒë·∫∑t k√≠ch th∆∞·ªõc Canvas
        const canvas = document.getElementById('visualizerCanvas');
        // L·∫•y chi·ªÅu r·ªông t·ª´ CSS (90% ho·∫∑c t·ªëi ƒëa 900px)
        canvas.width = canvas.clientWidth; 
        canvas.height = 300; // Gi·ªØ chi·ªÅu cao c·ªë ƒë·ªãnh
        
        const WIDTH = canvas.width;
        const HEIGHT = canvas.height;

        // --- L·∫•y c√°c ph·∫ßn t·ª≠ DOM ---
        const ctx = canvas.getContext('2d');
        const audio = document.getElementById('audioElement');
        const songSelector = document.getElementById('songSelector');
        const currentSongTitle = document.getElementById('currentSongTitle');

        // --- C√†i ƒë·∫∑t Web Audio API ---
        let audioCtx;
        let analyser;
        let source;
        let dataArray; 

        // --- 1. H√†m Kh·ªüi T·∫°o (M·ªöI) ---
        function initializePlaylist() {
            // 1. ƒê·ªï d·ªØ li·ªáu t·ª´ `playlist` v√†o menu <select>
            playlist.forEach((song, index) => {
                const option = document.createElement('option');
                option.value = index; // Gi√° tr·ªã l√† v·ªã tr√≠ (index) trong m·∫£ng
                option.textContent = song.title;
                songSelector.appendChild(option);
            });
            
            // 2. T·∫£i b√†i h√°t ƒë·∫ßu ti√™n l√™n tr√¨nh ph√°t
            loadSong(0); 
            
            // 3. Th√™m s·ª± ki·ªán 'change' cho menu <select>
            songSelector.addEventListener('change', (e) => {
                const selectedSongIndex = e.target.value;
                loadSong(selectedSongIndex);
                audio.play(); // T·ª± ƒë·ªông ph√°t khi ch·ªçn b√†i m·ªõi
            });
        }

        // --- 2. H√†m T·∫£i B√†i H√°t (M·ªöI) ---
        function loadSong(index) {
            const song = playlist[index];
            audio.src = song.src; // ƒê·∫∑t ngu·ªìn (src) cho th·∫ª <audio>
            currentSongTitle.textContent = song.title; // C·∫≠p nh·∫≠t ti√™u ƒë·ªÅ
            audio.load(); // T·∫£i file nh·∫°c
        }

        // --- 3. H√†m C√†i ƒê·∫∑t Audio Context ---
        // (Kh√¥ng thay ƒë·ªïi, v·∫´n ch·∫°y khi ng∆∞·ªùi d√πng nh·∫•n 'play' l·∫ßn ƒë·∫ßu)
        function setupAudioContext() {
            if (audioCtx) return; // ƒê·∫£m b·∫£o ch·ªâ kh·ªüi t·∫°o m·ªôt l·∫ßn
            
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioCtx.createAnalyser();
            analyser.fftSize = 2048; 
            
            const bufferLength = analyser.frequencyBinCount;
            dataArray = new Uint8Array(bufferLength); 
            
            source = audioCtx.createMediaElementSource(audio);
            
            source.connect(analyser);
            analyser.connect(audioCtx.destination);

            // B·∫Øt ƒë·∫ßu v√≤ng l·∫∑p v·∫Ω
            draw(); 
        }

        // K√≠ch ho·∫°t setupAudioContext khi ng∆∞·ªùi d√πng nh·∫•n 'play'
        audio.addEventListener('play', setupAudioContext);

        // --- 4. H√†m V·∫Ω S√≥ng Nh·∫°c ---
        // (Kh√¥ng thay ƒë·ªïi)
        function draw() {
            if (!audioCtx) {
                requestAnimationFrame(draw); 
                return;
            }

            requestAnimationFrame(draw);
            analyser.getByteFrequencyData(dataArray);
            ctx.clearRect(0, 0, WIDTH, HEIGHT); 
            
            const barWidth = 2;
            const spacing = 1;
            const totalBarWidth = barWidth + spacing;
            const numBars = Math.floor(WIDTH / totalBarWidth);
            let x = 0; 

            for (let i = 0; i < numBars; i++) {
                // L·∫•y m·∫´u d·ªØ li·ªáu t·∫ßn s·ªë m·ªôt c√°ch th√¥ng minh ƒë·ªÉ v·ª´a v·∫∑n
                const dataIndex = Math.floor(i * (dataArray.length / numBars));
                const barHeight = dataArray[dataIndex] * 0.8;
                
                const hue = i / numBars * 360; 
                const lightness = 40 + (barHeight / HEIGHT) * 50; 
                ctx.fillStyle = `hsl(${hue}, 100%, ${lightness}%)`; 
                
                ctx.fillRect(x, HEIGHT / 2 - barHeight / 2, barWidth, barHeight);
                x += totalBarWidth; 
            }
        };

        // --- 5. Ch·∫°y H√†m Kh·ªüi T·∫°o ---
        initializePlaylist();

    </script>
</body>
</html>
