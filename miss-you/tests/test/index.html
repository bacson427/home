<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HPBD_DUONG_V19_HEART</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Black+Ops+One&display=swap');
        
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Dancing Script', cursive; }
        canvas { display: block; position: absolute; top: 0; left: 0; z-index: 1; }

        /* N·ªÅn Bokeh Tr√°i tim m·ªù ·∫£o (D√πng CSS ƒë·ªÉ nh·∫π m√°y) */
        .bokeh-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #3a003a, #1a001a);
            overflow: hidden; z-index: 0;
        }
        .bokeh-heart {
            position: absolute; color: rgba(255, 105, 180, 0.2); font-size: 50px;
            animation: float 10s infinite linear;
        }
        @keyframes float { from { transform: translateY(100vh) rotate(0deg); opacity: 0; } to { transform: translateY(-20vh) rotate(360deg); opacity: 0.8; } }

        /* UI & Sticker */
        #ui-layer {
            position: absolute; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            flex-direction: column; z-index: 999; pointer-events: none;
        }

        .cyber-btn {
            pointer-events: auto; background: rgba(255, 105, 180, 0.3); color: #FF69B4; border: 2px solid #FF69B4;
            padding: 18px 50px; font-size: 22px; cursor: pointer; font-family: 'Black Ops One';
            box-shadow: 0 0 15px #FF69B4; transition: 0.3s; animation: pulse 2s infinite;
        }
        .cyber-btn:hover { background: #FF69B4; color: #FFF; box-shadow: 0 0 50px #FF69B4; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        .cat-sticker {
            position: absolute; bottom: 10px; width: 80px; z-index: 200;
            animation: bounce 1s infinite;
        }
        #cat-left { left: 20px; }
        #cat-right { right: 20px; transform: scaleX(-1); } /* L·∫≠t ng∆∞·ª£c cho ƒë·ªëi x·ª©ng */
        @keyframes bounce { 0%, 100% { transform: translateY(0) scaleX(var(--s, 1)); } 50% { transform: translateY(-10px) scaleX(var(--s, 1)); } }

        /* Message */
        #msg-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(20, 0, 10, 0.95); display: none; z-index: 3000;
            flex-direction: column; justify-content: center; align-items: center;
            padding: 20px; box-sizing: border-box;
        }
        #msg-content {
            color: #FF69B4; font-size: 18px; line-height: 1.6; font-family: 'Share Tech Mono';
            white-space: pre-wrap; max-width: 650px; text-shadow: 0 0 10px #FF69B4;
            border-left: 4px solid #FF69B4; padding-left: 20px; background: rgba(40, 0, 20, 0.6);
        }
        #skip-btn { margin-top: 30px; padding: 12px 30px; border: 1px solid #FFD700; background: transparent; color: #FFD700; display: none; pointer-events: auto; font-weight: bold; cursor: pointer; transition: 0.3s; }
    </style>
</head>
<body>
    <div class="bokeh-bg" id="bg-container"></div>
    <canvas id="c"></canvas>
    
    <div id="ui-layer">
        <button id="btn-start" class="cyber-btn">START LOVE SHOW</button>
        <img id="cat-left" class="cat-sticker" src="https://i.imgur.com/P5m7Z1h.png" style="--s:1" alt="cat">
        <img id="cat-right" class="cat-sticker" src="https://i.imgur.com/P5m7Z1h.png" style="--s:-1" alt="cat">
    </div>

    <div id="msg-layer">
        <div style="color: #FFD700; font-size: 22px; margin-bottom: 20px;">üíå A SPECIAL MESSAGE FOR YOU</div>
        <div id="msg-content"></div>
        <button id="skip-btn" onclick="startFinale()">CONTINUE >></button>
    </div>

    <audio id="audio" src="https://nguyenbacson.io.vn/miss-you-happy-birthday.mp3" loop></audio>

<script>
    // --- N·ªòI DUNG T√ÇM TH∆Ø ---
    const LETTER = `D∆∞∆°ng ∆°i, h√¥m nay 01/03/2026, c·∫≠u tr√≤n 19 tu·ªïi.

T·ªõ ch√∫c c·∫≠u ng√†y c√†ng xinh ƒë·∫πp, h·ªçc gi·ªèi, ƒë·∫°t ƒë∆∞·ª£c k·∫øt qu·∫£ cao v√† s·ªõm th·ª±c hi·ªán ƒë∆∞·ª£c m·ªçi ∆∞·ªõc m∆°.

T·ªõ xin l·ªói v√¨ th·ªùi gian qua ƒë√£ l√†m c·∫≠u bu·ªìn. NƒÉm m·ªõi mong c·∫≠u b·ªè qua cho t√≠nh c√°ch "tr·∫ª tr√¢u" c·ªßa t·ªõ nh√©.

Happy Birthday! ‚ù§Ô∏è

-- Nguy·ªÖn B·∫Øc S∆°n --`;

    // --- K·ªäCH B·∫¢N DRONE ---
    const SCRIPT = [
        { t: "G·ª¨I ƒê·∫æN\nTR∆Ø∆†NG TH·ªä D∆Ø∆†NG", c: "#FF69B4" },
        { t: "CH√öC M·ª™NG\nNƒÇM M·ªöI 2026", c: "#FFD700" }, 
        { t: "XU√ÇN B√çNH NG·ªå\nTH√ÄNH C√îNG R·ª∞C R·ª†", c: "#00FFFF" }, 
        { t: "HAPPY VALENTINE\n14/02 NG·ªåT NG√ÄO", c: "#FF0055" }, 
        { t: "QU·ªêC T·∫æ PH·ª§ N·ªÆ\n8/3 XINH ƒê·∫∏P", c: "#FFF" }, 
        
        // --- CAO TR√ÄO: HEART RAIN ---
        { action: "HEART_RAIN" }, 
        
        { t: "HAPPY BIRTHDAY\nSINH NH·∫¨T VUI V·∫∫", c: "#FFD700" },
        { t: "TU·ªîI 19\nR·ª∞C R·ª† T·ªéA S√ÅNG", c: "#FF69B4" },
        { action: "MSG" } 
    ];

    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');
    const isMobile = window.innerWidth < 768;
    let w, h;

    // C·∫§U H√åNH DRONE & RAIN (T·ªëi ∆∞u ƒë·ªÉ kh√¥ng lag)
    const DOT_GAP = isMobile ? 5 : 4; 
    const DOT_SIZE = isMobile ? 3 : 2.5; 
    const MAX_DRONES = isMobile ? 2500 : 4000;
    const MAX_RAIN_HEARTS = isMobile ? 300 : 600; // S·ªë l∆∞·ª£ng tim r∆°i t·ªëi ƒëa

    let state = "IDLE"; 
    let drones = [];
    let rainHearts = []; // H·∫°t m∆∞a tim
    let scriptIdx = 0;
    
    function resize() {
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
        createBokehBg(); // T·∫°o n·ªÅn
    }
    window.addEventListener('resize', resize);
    resize();

    // --- T·∫†O N·ªÄN BOKEH (CSS) ---
    function createBokehBg() {
        const bg = document.getElementById('bg-container');
        bg.innerHTML = '';
        for(let i=0; i<20; i++) {
            let h = document.createElement('div');
            h.className = 'bokeh-heart';
            h.innerHTML = '‚ù§';
            h.style.left = Math.random()*100 + '%';
            h.style.fontSize = Math.random()*30 + 20 + 'px';
            h.style.animationDuration = Math.random()*10 + 10 + 's';
            h.style.animationDelay = Math.random()*5 + 's';
            bg.appendChild(h);
        }
    }

    // --- START ---
    document.getElementById('btn-start').onclick = function() {
        this.style.display = 'none';
        document.getElementById('audio').play().catch(()=>{});
        runShow();
    };

    // --- SHOW CONTROL ---
    function runShow() {
        state = "SHOW";
        nextScene();
        // K√≠ch ho·∫°t m√®o b·∫Øn tim
        setInterval(catShootHeart, 600);
    }

    function nextScene() {
        if(scriptIdx >= SCRIPT.length) return;
        let s = SCRIPT[scriptIdx++];
        
        if(s.action === "HEART_RAIN") {
            runHeartRainEffect();
            return;
        }
        if(s.action === "MSG") {
            setTimeout(runMessage, 1500);
            return;
        }

        formText(s.t, s.c);
        setTimeout(nextScene, 10000); 
    }

    // --- HEART RAIN EFFECT (Hi·ªáu ·ª©ng ch√≠nh) ---
    function runHeartRainEffect() {
        state = "RAIN";
        // 1. X·∫øp ch·ªØ "Te amo" v√† h√¨nh tim l·ªõn
        formTeAmoHeart();

        // 2. T·∫°o m∆∞a tim r∆°i li√™n t·ª•c
        let rainInterval = setInterval(() => {
            if(state !== "RAIN") {
                clearInterval(rainInterval);
                return;
            }
            if(rainHearts.length < MAX_RAIN_HEARTS) {
                spawnRainHeart();
            }
        }, 50);

        // Chuy·ªÉn c·∫£nh sau 12s
        setTimeout(() => {
            if(state === "RAIN") {
                rainHearts = []; // D·ªçn s·∫°ch m∆∞a
                nextScene();
            }
        }, 12000);
    }

    // --- MESSAGE ---
    function runMessage() {
        state = "MSG";
        const layer = document.getElementById('msg-layer');
        const content = document.getElementById('msg-content');
        const btn = document.getElementById('skip-btn');
        layer.style.display = 'flex';
        
        // Drone bay l√†m n·ªÅn
        drones.forEach(d => {
            d.tx = Math.random() * w; d.ty = Math.random() * h;
            d.c = "rgba(255, 105, 180, 0.2)";
        });

        let i = 0;
        let tmr = setInterval(() => {
            content.innerText = LETTER.substring(0, i) + "_";
            i++;
            if(i > LETTER.length) {
                clearInterval(tmr);
                content.innerText = LETTER;
                btn.style.display = 'block';
                setTimeout(() => { if(state==="MSG") startFinale(); }, 15000);
            }
        }, 40);
    }

    window.startFinale = function() {
        document.getElementById('msg-layer').style.display = 'none';
        state = "FINALE";
        formCake();
    };

    // --- LOGIC: TEXT/SHAPE TO DRONES ---
    function formText(txt, color) {
        const tmp = document.createElement('canvas');
        const tCtx = tmp.getContext('2d');
        let fSize = isMobile ? 80 : 140;
        tCtx.font = `900 ${fSize}px "Arial Black"`;
        
        const lines = txt.split('\n');
        let maxW = 0; lines.forEach(l => maxW = Math.max(maxW, tCtx.measureText(l).width));

        tmp.width = maxW + 20; tmp.height = lines.length * fSize * 1.3;
        tCtx.font = `900 ${fSize}px "Arial Black"`;
        tCtx.fillStyle = '#fff'; tCtx.textAlign = 'center'; tCtx.textBaseline = 'middle';
        
        lines.forEach((l, i) => tCtx.fillText(l, tmp.width/2, fSize*0.8 + i*fSize));
        getPoints(tmp, color);
    }

    function formCake() {
        const tmp = document.createElement('canvas');
        const tCtx = tmp.getContext('2d');
        let s = Math.min(w, h) * 0.8;
        tmp.width = tmp.height = s;
        tCtx.font = `${s/2}px serif`;
        tCtx.fillStyle = '#fff'; tCtx.textAlign='center'; tCtx.textBaseline='middle';
        tCtx.fillText("üéÇ", s/2, s/2);
        getPoints(tmp, "#FFD700");
    }

    function formTeAmoHeart() {
        // 1. Ch·ªØ "Te amo"
        const tmp = document.createElement('canvas');
        const tCtx = tmp.getContext('2d');
        let fSize = isMobile ? 60 : 100;
        tCtx.font = `${fSize}px "Dancing Script"`;
        let mw = tCtx.measureText("Te amo").width;
        tmp.width = mw+20; tmp.height = fSize*1.5;
        tCtx.font = `${fSize}px "Dancing Script"`;
        tCtx.fillStyle = '#fff'; tCtx.fillText("Te amo", 10, fSize);
        let textPts = getPointsData(tmp, "#FF69B4");

        // 2. H√¨nh tr√°i tim l·ªõn (To√°n h·ªçc)
        let heartPts = [];
        let cx = w/2, cy = h/2 + (isMobile?50:100);
        let size = Math.min(w,h)*0.35;
        for(let i=0; i<300; i++) {
            let t = (i/300)*Math.PI*2;
            let x = 16 * Math.pow(Math.sin(t), 3);
            let y = -(13 * Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t));
            heartPts.push({x: cx + x*(size/20), y: cy + y*(size/20), c:"#FF1493"});
        }
        
        // G·ªôp l·∫°i v√† c·∫≠p nh·∫≠t drone
        let finalPts = textPts.concat(heartPts);
        // D·ªùi ch·ªØ l√™n tr√™n tim
        finalPts.slice(0, textPts.length).forEach(p => p.y -= (isMobile?150:250));
        updateDrones(finalPts);
    }

    // --- UTILS ---
    function getPoints(tmp, color) {
        let pts = getPointsData(tmp, color);
        updateDrones(pts);
    }
    function getPointsData(tmp, color) {
        const data = tmp.getContext('2d').getImageData(0,0, tmp.width, tmp.height).data;
        let points = [];
        let scale = Math.min(w*0.9/tmp.width, h*0.65/tmp.height);
        let sx = (w - tmp.width*scale)/2;
        let sy = (h - tmp.height*scale)/2;

        for(let y=0; y<tmp.height; y+=DOT_GAP) {
            for(let x=0; x<tmp.width; x+=DOT_GAP) {
                if(data[(y*tmp.width + x)*4 + 3] > 128) {
                    points.push({x: sx + x*scale, y: sy + y*scale, c: color});
                }
            }
        }
        if(points.length > MAX_DRONES) {
            points.sort(() => Math.random() - 0.5);
            points = points.slice(0, MAX_DRONES);
        }
        return points;
    }

    function updateDrones(pts) {
        pts.sort(() => Math.random() - 0.5);
        if(drones.length < pts.length) {
            let add = pts.length - drones.length;
            for(let i=0; i<add; i++) drones.push({x:Math.random()*w, y:Math.random()*h, tx:w/2, ty:h/2, c:pts[0].c});
        }
        drones.forEach((d, i) => {
            if(i < pts.length) { d.tx = pts[i].x; d.ty = pts[i].y; d.c = pts[i].c; }
            else { d.tx = Math.random()*w; d.ty = -100; d.c = "transparent"; }
        });
    }

    // --- EFFECTS: RAIN & CAT ---
    function spawnRainHeart() {
        // H·∫°t m∆∞a r∆°i theo ƒë∆∞·ªùng cong (gi·ªëng trong video)
        let startX = Math.random()*w;
        rainHearts.push({
            x: startX, y: -20,
            vx: (Math.random()-0.5)*2, vy: Math.random()*3+2, // V·∫≠n t·ªëc
            c: `hsl(${Math.random()*30+330}, 100%, 70%)`, // M√†u h·ªìng/ƒë·ªè
            offset: Math.random()*100 // ƒê·ªÉ t·∫°o ƒë∆∞·ªùng cong
        });
    }

    function catShootHeart() {
        if(state === "MSG") return;
        // B·∫Øn t·ª´ 2 v·ªã tr√≠ m√®o
        [20, w-60].forEach(x => {
            rainHearts.push({
                x: x + 20, y: h-40,
                vx: (x<w/2 ? 1 : -1) * (Math.random()*2+1), vy: -Math.random()*8-5,
                c: "#FF69B4", isShot: true
            });
        });
    }

    // --- RENDER LOOP ---
    function loop() {
        requestAnimationFrame(loop);
        ctx.clearRect(0,0,w,h);

        // 1. DRONES (Ch·ªØ/H√¨nh)
        drones.forEach(d => {
            d.x += (d.tx - d.x) * 0.1; d.y += (d.ty - d.y) * 0.1;
            ctx.fillStyle = d.c; ctx.fillRect(d.x, d.y, DOT_SIZE, DOT_SIZE);
        });

        // 2. HEART RAIN (M∆∞a tim)
        for(let i=rainHearts.length-1; i>=0; i--) {
            let r = rainHearts[i];
            if(r.isShot) { // Tim do m√®o b·∫Øn
                r.x += r.vx; r.y += r.vy; r.vy += 0.1;
            } else { // Tim m∆∞a r∆°i
                r.x += r.vx + Math.sin(r.y/50 + r.offset)*0.5; // ƒê∆∞·ªùng cong nh·∫π
                r.y += r.vy;
            }
            ctx.fillStyle = r.c; ctx.font = "16px serif"; ctx.fillText("‚ù§Ô∏è", r.x, r.y);
            if(r.y > h+20 || r.y < -50 || r.x < -20 || r.x > w+20) rainHearts.splice(i,1);
        }
    }
    loop();

</script>
</body>
</html>
