<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>G·ª≠i D∆∞∆°ng ‚ù§Ô∏è | Colorful Party</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Quicksand:wght@600;700&family=Montserrat:wght@800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #ff4d6d;
            --secondary: #ff8fa3;
            --bg: #fff0f3;
            --text-main: #800f2f;
        }

        body { 
            margin: 0; overflow: hidden; 
            background: var(--bg); 
            font-family: 'Quicksand', sans-serif;
            touch-action: none;
        }

        canvas { display: block; position: absolute; top: 0; left: 0; z-index: 2; pointer-events: none; }
        #hearts-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; overflow: hidden; }

        /* --- 1. H·ªòP QU√Ä M·ªû ƒê·∫¶U --- */
        #intro-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10000; display: flex; flex-direction: column; 
            justify-content: center; align-items: center;
            background: rgba(255, 240, 243, 0.95);
            transition: opacity 1s, transform 1s;
        }

        .gift-container { position: relative; cursor: pointer; animation: bounce 2s infinite; }
        .gift-box { width: 120px; height: 120px; background: #ff4d6d; border-radius: 10px; box-shadow: 0 10px 25px rgba(255, 77, 109, 0.4); position: relative; z-index: 10; }
        .gift-lid { width: 140px; height: 30px; background: #d90429; position: absolute; top: -15px; left: -10px; border-radius: 5px; z-index: 11; }
        .ribbon-vertical { width: 20px; height: 100%; background: #fff; position: absolute; left: 50px; top: 0; }
        .ribbon-horizontal { width: 100%; height: 20px; background: #fff; position: absolute; top: 50px; left: 0; }
        .bow { width: 60px; height: 30px; border: 5px solid #fff; border-radius: 50%; position: absolute; top: -40px; left: 30px; transform: rotate(-10deg); }
        .bow::before { content: ''; position: absolute; width: 60px; height: 30px; border: 5px solid #fff; border-radius: 50%; top: 0; left: -15px; transform: rotate(20deg); }

        .tap-hint { margin-top: 50px; font-family: 'Montserrat', sans-serif; color: #d90429; font-weight: bold; font-size: 1.2rem; animation: pulse 1s infinite; }

        /* --- 2. TERMINAL --- */
        #virus-terminal { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(255, 255, 255, 0.92); color: var(--text-main); 
            padding: 20px; box-sizing: border-box; font-size: 14px; 
            overflow: hidden; display: none; z-index: 2001;
            font-family: 'Courier New', monospace; font-weight: bold; line-height: 1.6;
        }

        /* --- 3. T√ÇM TH∆Ø --- */
        #msg-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; z-index: 3000;
            flex-direction: column; justify-content: center; align-items: center;
            opacity: 0; transition: opacity 1.5s;
        }
        #msg-layer.visible { opacity: 1; }
        
        #msg-box {
            width: 85%; max-width: 550px; max-height: 60vh; overflow-y: auto;
            background: rgba(255, 255, 255, 0.85); border: 2px solid #fff;
            padding: 30px; border-radius: 25px; 
            box-shadow: 0 20px 50px rgba(255, 0, 80, 0.2);
            color: var(--text-main); font-family: 'Quicksand'; font-size: clamp(16px, 4vw, 19px); 
            line-height: 1.8; white-space: pre-wrap; font-weight: 600;
            backdrop-filter: blur(15px);
        }
        
        #next-btn {
            margin-top: 25px; padding: 12px 35px; border: none;
            background: var(--primary); color: white; border-radius: 30px;
            font-family: 'Montserrat', sans-serif; font-weight: bold; 
            cursor: pointer; display: none;
            box-shadow: 0 5px 15px rgba(255, 77, 109, 0.4);
        }

        /* --- 4. TRANSITION --- */
        #white-flash {
            position: fixed; top:0; left:0; width:100%; height:100%; background: #fff0f3;
            z-index: 9999; opacity: 0; pointer-events: none; transition: opacity 2s;
            display: flex; justify-content: center; align-items: center; flex-direction: column;
        }
        .loading-heart { font-size: 60px; animation: beat 0.8s infinite; color: var(--primary);}
        .loading-text { margin-top: 15px; color: var(--text-main); font-family: 'Dancing Script'; font-size: 28px; font-weight: bold;}

        /* Tim bay n·ªÅn */
        .heart-bg { position: absolute; color: var(--secondary); font-size: 20px; user-select: none; animation: floatUp 5s linear infinite; opacity: 0; }
        @keyframes floatUp { 0% { transform: translateY(100vh) rotate(0deg); opacity: 0.8; } 100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        @keyframes beat { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes shake { 0% { transform: rotate(0); } 25% { transform: rotate(-10deg); } 75% { transform: rotate(10deg); } 100% { transform: rotate(0); } }
    </style>
</head>
<body>
    
    <div id="hearts-bg"></div>
    <canvas id="c"></canvas>

    <div id="intro-layer" onclick="openGift()">
        <div class="gift-container" id="gift-box-anim">
            <div class="bow"></div>
            <div class="gift-lid"></div>
            <div class="gift-box">
                <div class="ribbon-vertical"></div>
                <div class="ribbon-horizontal"></div>
            </div>
        </div>
        <div class="tap-hint">Ch·∫°m ƒë·ªÉ m·ªü qu√† cho D∆∞∆°ng üéÅ</div>
    </div>

    <div id="virus-terminal"></div>

    <div id="msg-layer">
        <div style="color: #ff4d6d; font-size: 35px; font-family: 'Dancing Script'; margin-bottom: 15px; font-weight: bold;">üíå Th∆∞ G·ª≠i D∆∞∆°ng</div>
        <div id="msg-box"></div>
        <button id="next-btn" onclick="doTransition()">ƒêI·ªÄU B·∫§T NG·ªú CU·ªêI >></button>
    </div>

    <div id="white-flash">
        <div class="loading-heart">‚ù§Ô∏è</div>
        <div class="loading-text">Ch·ªù t·ªõ m·ªôt ch√∫t...</div>
    </div>

    <audio id="audio" src="https://nguyenbacson.io.vn/miss-you-happy-birthday.mp3" loop></audio>

<script>
    const LETTER = `Ch√∫c m·ª´ng sinh nh·∫≠t tu·ªïi 19, c√¥ g√°i H√† Nam xinh ƒë·∫πp! üå∏\n\nCh√∫c c√¥ sinh vi√™n ƒê·∫°i h·ªçc Ph∆∞∆°ng ƒê√¥ng sang tu·ªïi m·ªõi h·ªçc t·∫≠p th·∫≠t t·ªët, lu√¥n vui v·∫ª v√† b·ªõt suy nghƒ© linh tinh nh√©.\n\nD√π c√≥ b·∫≠n deadline th√¨ c≈©ng nh·ªõ ƒÉn u·ªëng ƒë·∫ßy ƒë·ªß (ƒë·∫∑c bi·ªát l√† ƒëi ƒÉn nem n∆∞·ªõng cho ƒë·ª° th√®m nha). üç¢\n\nMong r·∫±ng m·ªçi ƒëi·ªÅu t·ªët ƒë·∫πp nh·∫•t s·∫Ω ƒë·∫øn v·ªõi c·∫≠u. Happy Birthday, my special girl! ‚ù§Ô∏è\n\n-- Nguy·ªÖn B·∫Øc S∆°n --`;

    const TERMINAL_LOGS = [
        "> K·∫æT N·ªêI SERVER TR√ÅI TIM...", "> T√åM KI·∫æM: 'TR∆Ø∆†NG TH·ªä D∆Ø∆†NG'", 
        "> QU√ä QU√ÅN: H√Ä NAM", "> ƒê·ªò D·ªÑ TH∆Ø∆†NG: V√î C·ª∞C üå∏", 
        "> ƒêANG T·∫¢I D·ªÆ LI·ªÜU...", "> 3...", "> 2...", "> 1...", "> B·∫ÆT ƒê·∫¶U BU·ªîI TI·ªÜC! ‚ù§Ô∏è"
    ];

    const DRONE_SEQUENCE = [
        { t: 1000, txt: "CH√öC M·ª™NG", color: "#d90429", font: 'Montserrat' },
        { t: 7000, txt: "SINH NH·∫¨T", color: "#ff758f", font: 'Montserrat' },
        { t: 13000, txt: "D∆Ø∆†NG 19", color: "#800f2f", font: 'Montserrat' },
        { t: 20000, shp: "HEART", color: "#d90429" },
        { t: 28000, txt: "XINH ƒê·∫∏P", color: "#ff4d6d", font: 'Dancing Script' },
        { t: 36000, txt: "H·∫†NH PH√öC", color: "#c9184a", font: 'Dancing Script' },
        { t: 45000, action: "SHOW_LETTER" }
    ];

    function createHeartBg() {
        const heart = document.createElement('div');
        heart.classList.add('heart-bg');
        heart.innerHTML = Math.random() < 0.5 ? '‚ù§Ô∏è' : 'üå∏';
        heart.style.left = Math.random() * 100 + 'vw';
        heart.style.fontSize = Math.random() * 20 + 15 + 'px';
        heart.style.animationDuration = Math.random() * 3 + 4 + 's';
        document.getElementById('hearts-bg').appendChild(heart);
        setTimeout(() => heart.remove(), 7000);
    }
    setInterval(createHeartBg, 400);

    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');
    let w, h;
    let drones = [], fireworks = [], particles = []; 
    let state = "INTRO"; 
    const DOT_GAP = 3; 

    function resize() {
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    function createDrone(x, y) {
        return { x: x || Math.random()*w, y: y || h+100, tx: Math.random()*w, ty: Math.random()*h, color: '#ff758f', size: 2, active: false };
    }

    function openGift() {
        const audio = document.getElementById("audio");
        audio.play().catch(()=>{});
        const gift = document.getElementById("gift-box-anim");
        const layer = document.getElementById("intro-layer");
        gift.style.animation = "shake 0.5s";
        setTimeout(() => {
            gift.style.transform = "scale(5)"; gift.style.opacity = "0"; layer.style.opacity = "0";
            // B·∫Øn ph√°o hoa m·ªü m√†n nhi·ªÅu h∆°n, ƒë·ªß m√†u
            for(let i=0; i<15; i++) setTimeout(launchFirework, i*80);
            setTimeout(() => { layer.style.display = "none"; runVirus(); }, 800);
        }, 500);
    }

    function runVirus() {
        state = "VIRUS";
        const term = document.getElementById("virus-terminal");
        term.style.display = "block";
        let line = 0, char = 0, txt = "";
        function type() {
            if(line >= TERMINAL_LOGS.length) { setTimeout(() => { term.style.display = "none"; startDroneShow(); }, 1000); return; }
            const str = TERMINAL_LOGS[line];
            term.innerHTML = txt + str.substring(0, char) + "_"; term.scrollTop = term.scrollHeight;
            if(char < str.length) { char++; setTimeout(type, 30); } else { txt += str + "<br><br>"; line++; char=0; setTimeout(type, 200); }
        }
        type();
    }

    window.startDroneShow = function() {
        state = "DRONE";
        document.getElementById("msg-layer").style.display = "none";
        
        // B·∫Øn ph√°o hoa d√†y h∆°n (800ms m·ªôt qu·∫£), x√°c su·∫•t cao h∆°n (50%)
        setInterval(() => {
            if(state === "DRONE" && Math.random() < 0.5) launchFirework();
        }, 800);

        DRONE_SEQUENCE.forEach(s => {
            setTimeout(() => {
                if(s.action === "SHOW_LETTER") { showMessage(); return; }
                if(s.txt) formText(s.txt, s.color, s.font);
                if(s.shp) formShape(s.shp, s.color);
            }, s.t);
        });
    }

    function showMessage() {
        state = "MSG";
        const layer = document.getElementById("msg-layer");
        layer.style.display = "flex";
        setTimeout(() => layer.classList.add("visible"), 50);
        const box = document.getElementById("msg-box");
        let i = 0;
        let t = setInterval(() => {
            box.innerText = LETTER.substring(0, i) + "|"; box.scrollTop = box.scrollHeight;
            if(i >= LETTER.length) { clearInterval(t); box.innerText = LETTER; document.getElementById("next-btn").style.display = "block"; }
            i++;
        }, 50);
    }

    window.doTransition = function() {
        drones.forEach(d => { d.tx = w/2; d.ty = h/2; });
        const white = document.getElementById("white-flash");
        white.style.opacity = 1;
        setTimeout(() => { window.location.href = "https://nguyenbacson.io.vn/miss-you/i-love-you/"; }, 3000);
    }

    function formText(text, color, font) {
        const tmp = document.createElement('canvas'); const tCtx = tmp.getContext('2d');
        let fSize = Math.min(w / (text.length * 0.7), 100); if(w < 500) fSize = Math.min(w / (text.length * 0.6), 60);
        tCtx.font = `bold ${fSize}px "${font}"`; let measure = tCtx.measureText(text);
        tmp.width = measure.width + 20; tmp.height = fSize * 1.5;
        tCtx.font = `bold ${fSize}px "${font}"`; tCtx.fillStyle = '#000'; tCtx.textAlign = 'center'; tCtx.textBaseline = 'middle';
        tCtx.fillText(text, tmp.width/2, tmp.height/2); processPixels(tmp, color);
    }

    function formShape(type, color) {
        let points = [], cx = w/2, cy = h/2, size = Math.min(w, h) * 0.35;
        if(type === "HEART") {
            for(let i=0; i<800; i++) { 
                let t = (i/800) * Math.PI*2; let x = 16 * Math.pow(Math.sin(t), 3); let y = -(13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t));
                points.push({x: cx + x*(size/18), y: cy + y*(size/18)});
            }
        }
        updateDrones(points, color);
    }

    function processPixels(canvas, color) {
        const data = canvas.getContext('2d').getImageData(0,0, canvas.width, canvas.height).data;
        let points = []; let startX = (w - canvas.width)/2; let startY = (h - canvas.height)/2;
        for(let y=0; y<canvas.height; y+=DOT_GAP) {
            for(let x=0; x<canvas.width; x+=DOT_GAP) { if(data[(y*canvas.width + x)*4 + 3] > 128) points.push({x: startX + x, y: startY + y}); }
        }
        updateDrones(points, color);
    }

    function updateDrones(points, color) {
        if(drones.length > points.length) drones.splice(points.length).forEach(d => d.active = false);
        while(drones.length < points.length) drones.push(createDrone());
        drones.forEach((d, i) => {
            if(i < points.length) { d.tx = points[i].x; d.ty = points[i].y; d.color = color; d.active = true; } 
            else { d.tx = Math.random()*w; d.ty = h + 100; d.active = false; }
        });
    }

    // --- PH√ÅO HOA ƒê·ª¶ M√ÄU ---
    function launchFirework() {
        fireworks.push({
            x: Math.random() * w, y: h,
            vx: (Math.random() - 0.5) * 4, vy: -(Math.random() * 5 + 10),
            // Random m√†u t·ª´ 0 ƒë·∫øn 360 ƒë·ªô (Full Spectrum)
            color: `hsl(${Math.random() * 360}, 100%, 60%)`,
            exploded: false
        });
    }

    function loop() {
        ctx.clearRect(0, 0, w, h);
        for (let i = fireworks.length - 1; i >= 0; i--) {
            let f = fireworks[i];
            if (!f.exploded) {
                f.x += f.vx; f.y += f.vy; f.vy += 0.2;
                ctx.fillStyle = f.color; ctx.beginPath(); ctx.arc(f.x, f.y, 3, 0, Math.PI * 2); ctx.fill();
                if (f.vy >= 0) {
                    f.exploded = true;
                    for (let j = 0; j < 20; j++) particles.push({ x: f.x, y: f.y, vx: (Math.random() - 0.5) * 6, vy: (Math.random() - 0.5) * 6, life: 1, color: f.color });
                    fireworks.splice(i, 1);
                }
            }
        }
        for (let i = particles.length - 1; i >= 0; i--) {
            let p = particles[i]; p.x += p.vx; p.y += p.vy; p.life -= 0.03;
            if (p.life <= 0) particles.splice(i, 1); else { ctx.globalAlpha = p.life; ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(p.x, p.y, 2, 0, Math.PI * 2); ctx.fill(); ctx.globalAlpha = 1; }
        }
        if(state === "DRONE" || state === "MSG") {
            drones.forEach(d => {
                d.x += (d.tx - d.x) * 0.08; d.y += (d.ty - d.y) * 0.08;
                if(d.active || Math.abs(d.y - d.ty) > 1) { ctx.fillStyle = d.color; ctx.beginPath(); ctx.arc(d.x, d.y, 1.5, 0, Math.PI*2); ctx.fill(); }
            });
        }
        requestAnimationFrame(loop);
    }
    loop();
</script>
</body>
</html>
