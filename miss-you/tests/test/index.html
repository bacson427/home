<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>G·ª≠i D∆∞∆°ng - Tu·ªïi 19 R·ª±c R·ª°</title>
    <style>
        /* Import Font sang tr·ªçng */
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@900&family=Playball&family=Montserrat:wght@800&display=swap');
        
        body { margin: 0; overflow: hidden; background-color: #050505; font-family: 'Cinzel', serif; touch-action: none; }
        
        /* N·ªÅn v≈© tr·ª• s√¢u h∆°n */
        .galaxy-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #1b2735 0%, #090a0f 100%); z-index: 0;
        }
        
        canvas { display: block; position: absolute; top: 0; left: 0; z-index: 1; }

        /* Giao di·ªán ƒëi·ªÅu khi·ªÉn */
        #ui-layer {
            position: absolute; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            flex-direction: column; pointer-events: none; z-index: 100;
        }

        .btn {
            pointer-events: auto; background: rgba(255, 215, 0, 0.1);
            color: #d4af37; border: 1px solid rgba(212, 175, 55, 0.6);
            padding: 15px 40px; font-size: 16px; cursor: pointer; transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase; letter-spacing: 3px; font-family: 'Montserrat', sans-serif;
            font-weight: 800; margin-top: 30px; border-radius: 50px; 
            backdrop-filter: blur(10px); box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        
        .btn:hover { 
            background: rgba(255, 215, 0, 0.3); 
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
            color: #fff; transform: scale(1.05);
        }

        .hint { 
            font-family: 'Montserrat', sans-serif; font-size: 10px; 
            color: rgba(255, 255, 255, 0.5); margin-top: 20px; 
            letter-spacing: 2px; text-transform: uppercase; text-align: center; 
        }

        #loading-text { font-size: 14px; color: #d4af37; letter-spacing: 2px; }

        /* M√†n t√¢m th∆∞ - Tr√¨nh b√†y nh∆∞ m·ªôt b·ª©c thi·ªáp */
        #letter-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.92); 
            display: none; justify-content: center; align-items: center; 
            z-index: 200; opacity: 0; transition: opacity 2s ease;
        }
        
        #letter-card {
            width: 90%; max-width: 650px;
            padding: 40px;
            background: linear-gradient(145deg, rgba(20,20,20,0.9), rgba(30,30,30,0.9));
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.1);
            text-align: center;
        }

        #letter-content { 
            color: #fff; font-family: 'Montserrat', sans-serif;
            font-size: clamp(15px, 3vw, 18px); line-height: 1.8; 
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 30px;
            font-weight: 500;
        }
        
        #letter-signature { 
            font-family: 'Playball', cursive; 
            font-size: clamp(22px, 4vw, 30px); 
            color: #ffd700; margin-top: 20px;
        }

        .cursor { display: inline-block; width: 2px; height: 1em; background: #ffd700; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

    </style>
</head>
<body>
    <div class="galaxy-bg"></div>
    <canvas id="mainCanvas"></canvas>
    
    <div id="ui-layer">
        <div id="loading-text">KH·ªûI T·∫†O H·ªÜ TH·ªêNG...</div>
        <button id="start-btn" class="btn" style="display:none">Khai Ti·ªác</button>
        <div id="hint-text" class="hint" style="display:none">H√£y b·∫≠t √¢m l∆∞·ª£ng l√™n nh√©</div>
        <button id="next-btn" class="btn" style="display:none">B·∫Øt ƒë·∫ßu ƒê·∫øm Ng∆∞·ª£c</button>
    </div>

    <div id="letter-container">
        <div id="letter-card">
            <div id="letter-content"></div>
            <div id="letter-signature"></div>
        </div>
    </div>

    <audio id="bg-music" src="https://nguyenbacson.io.vn/miss-you-happy-birthday.mp3" loop crossorigin="anonymous"></audio>

<script>
    // --- C·∫§U H√åNH ---
    const CONFIG = {
        NAME: "Tr∆∞∆°ng Th·ªã D∆∞∆°ng",
        COLORS: {
            GOLD: { h: 45, s: 100, l: 55 },
            RED: { h: 350, s: 90, l: 60 },
            PINK: { h: 330, s: 100, l: 70 },
            BLUE: { h: 210, s: 100, l: 65 },
            WHITE: { h: 0, s: 0, l: 100 }
        }
    };

    // --- VARIABLES ---
    const isMobile = window.innerWidth < 768;
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d', { alpha: false }); // T·∫Øt alpha channel ƒë·ªÉ tƒÉng hi·ªáu nƒÉng v·∫Ω n·ªÅn
    let width, height;
    
    // Tinh ch·ªânh ƒë·ªô ƒë·∫≠m nh·∫°t v√† s·ªë l∆∞·ª£ng h·∫°t
    const PARTICLE_DENSITY = isMobile ? 5 : 3; // S·ªë c√†ng nh·ªè c√†ng d√†y h·∫°t (3 l√† r·∫•t d√†y cho PC)
    const DRONE_SIZE = isMobile ? 1.8 : 1.5;
    
    let state = "LOAD"; // LOAD, FIREWORKS, COUNTDOWN, TRANSITION, DRONE, LETTER
    let fireworks = [], particles = [], drones = [], shockwaves = [];
    let audioCtx, analyser, dataArray;
    let time = 0; // Global time for Perlin noise logic

    // --- UTILS ---
    function resize() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // H√†m random trong kho·∫£ng
    const rand = (min, max) => Math.random() * (max - min) + min;

    // --- AUDIO ---
    function initAudio() {
        if(audioCtx) return;
        try {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const el = document.getElementById('bg-music');
            const src = audioCtx.createMediaElementSource(el);
            analyser = audioCtx.createAnalyser();
            analyser.fftSize = 256;
            src.connect(analyser);
            analyser.connect(audioCtx.destination);
            dataArray = new Uint8Array(analyser.frequencyBinCount);
            el.play();
        } catch(e) { console.log("Audio init failed (interaction needed)"); }
    }

    function getBass() {
        if(!analyser) return 0;
        analyser.getByteFrequencyData(dataArray);
        let sum = 0; 
        // L·∫•y d·∫£i t·∫ßn s·ªë th·∫•p (Bass)
        for(let i=0; i<10; i++) sum += dataArray[i];
        return sum / 10; // 0 -> 255
    }

    // --- UI LOGIC ---
    window.onload = () => {
        document.getElementById('loading-text').style.display = 'none';
        const btn = document.getElementById('start-btn');
        btn.style.display = 'block';
        document.getElementById('hint-text').style.display = 'block';

        btn.onclick = () => {
            initAudio();
            btn.style.display = 'none';
            document.getElementById('hint-text').style.display = 'none';
            state = "FIREWORKS";
            launchOpeningFireworks();
        };

        document.getElementById('next-btn').onclick = () => {
            document.getElementById('next-btn').style.display = 'none';
            startCountdown();
        };
    };

    // --- PH·∫¶N 1: PH√ÅO HOA KHAI M·∫†C ---
    function launchOpeningFireworks() {
        let duration = 8000;
        let start = Date.now();
        
        let loop = setInterval(() => {
            if(Date.now() - start > duration) {
                clearInterval(loop);
                document.getElementById('next-btn').style.display = 'block';
                return;
            }
            // B·∫Øn ng·∫´u nhi√™n
            createRocket(rand(width*0.1, width*0.9), height, rand(width*0.1, width*0.9), rand(height*0.1, height*0.4));
        }, 500);
    }

    // --- PH·∫¶N 2: ƒê·∫æM NG∆Ø·ª¢C ---
    function startCountdown() {
        state = "COUNTDOWN";
        let count = 10;
        
        let cdInterval = setInterval(() => {
            createShockwave(width/2, height/2); // T·∫°o v√≤ng s√≥ng √¢m thanh
            count--;
            
            if(count % 2 === 0 && count > 0) {
                 createRocket(width/2, height, width/2, height*0.3, "HEART");
            }

            if(count < 0) {
                clearInterval(cdInterval);
                state = "TRANSITION";
                setTimeout(startDroneShow, 1000);
            }
        }, 1000);

        // Render s·ªë ƒë·∫øm ng∆∞·ª£c
        window.currentCountdown = 10;
        let numInterval = setInterval(() => {
            window.currentCountdown--;
            if(window.currentCountdown < 0) clearInterval(numInterval);
        }, 1000);
    }

    // --- PH·∫¶N 3: DRONE SHOW (TR·ªåNG T√ÇM) ---
    function startDroneShow() {
        state = "DRONE";
        
        // K·ªãch b·∫£n hi·ªÉn th·ªã
        const script = [
            { t: 0, text: "CH√öC M·ª™NG", color: CONFIG.COLORS.GOLD },
            { t: 7000, text: "NƒÇM M·ªöI 2026", color: CONFIG.COLORS.RED },
            { t: 14000, text: "XU√ÇN B√çNH NG·ªå", color: CONFIG.COLORS.GOLD },
            { t: 21000, text: "HAPPY VALENTINE", color: CONFIG.COLORS.PINK },
            { t: 28000, text: "QU·ªêC T·∫æ PH·ª§ N·ªÆ 8/3", color: CONFIG.COLORS.RED },
            { t: 35000, text: "SINH NH·∫¨T VUI V·∫∫", color: CONFIG.COLORS.GOLD },
            { t: 42000, text: "TU·ªîI 19 R·ª∞C R·ª†", color: CONFIG.COLORS.BLUE },
            { t: 49000, text: CONFIG.NAME.toUpperCase(), font: "Dancing Script", color: CONFIG.COLORS.PINK },
            // M√†n ƒë·∫∑c bi·ªát: B√°nh kem + Tim
            { t: 58000, type: "IMAGE", color: CONFIG.COLORS.GOLD }, 
            { t: 70000, action: "END" }
        ];

        let baseTime = Date.now();
        
        script.forEach(scene => {
            setTimeout(() => {
                if(scene.action === "END") {
                    showLetter();
                    return;
                }
                
                // Hi·ªáu ·ª©ng chuy·ªÉn c·∫£nh: B√πng n·ªï nh·∫π c√°c drone c≈©
                explodeDronesFormation();

                if(scene.type === "IMAGE") {
                    formImageShape();
                } else {
                    formText(scene.text, scene.color, scene.font || "Cinzel");
                }
                
                // B·∫Øn ph√°o hoa ph·ª• h·ªça khi ƒë·ªïi ch·ªØ
                createRocket(width*0.2, height, width*0.2, height*0.3, "STAR");
                createRocket(width*0.8, height, width*0.8, height*0.3, "STAR");

            }, scene.t);
        });
    }

    // --- H·ªÜ TH·ªêNG V·∫¨T L√ù & LOGIC ---

    // 1. Ph√°o hoa (Rocket & Spark)
    function createRocket(x, y, tx, ty, shape="CIRCLE") {
        fireworks.push({
            x: x, y: y, tx: tx, ty: ty,
            vx: (tx - x) * 0.02,
            vy: -rand(10, 15), // B·∫Øn l√™n m·∫°nh
            color: `hsl(${rand(0, 360)}, 100%, 60%)`,
            shape: shape,
            state: "FLY"
        });
    }

    function createExplosion(x, y, color, shape) {
        let count = isMobile ? 50 : 100;
        let bass = getBass();
        let power = 1 + (bass/255); // Bass c√†ng m·∫°nh n·ªï c√†ng to

        for(let i=0; i<count; i++) {
            let angle = rand(0, Math.PI*2);
            let speed = rand(1, 4) * power;
            let p = {
                x: x, y: y,
                vx: Math.cos(angle) * speed,
                vy: Math.sin(angle) * speed,
                color: color,
                alpha: 1,
                decay: rand(0.01, 0.03),
                gravity: 0.05
            };

            // Logic h√¨nh tr√°i tim / sao
            if(shape === "HEART") {
                let t = rand(0, Math.PI*2);
                p.vx = (16 * Math.pow(Math.sin(t), 3)) * 0.1 * power;
                p.vy = -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t)) * 0.1 * power;
            }

            particles.push(p);
        }
        // Th√™m shockwave
        createShockwave(x, y);
    }

    function createShockwave(x, y) {
        shockwaves.push({ x: x, y: y, r: 0, alpha: 1 });
    }

    // 2. Drone Logic (Ch√¨a kh√≥a c·ªßa s·ª± "T·ª± nhi√™n")
    function updateDrones() {
        let bass = getBass();
        let excite = bass / 255; // 0 -> 1

        drones.forEach(d => {
            // Bay v·ªÅ ƒë√≠ch (Easing) nh∆∞ng ch·∫≠m r√£i
            let dx = d.tx - d.x;
            let dy = d.ty - d.y;
            let dist = Math.sqrt(dx*dx + dy*dy);
            
            // N·∫øu c√≤n xa th√¨ bay nhanh, g·∫ßn th√¨ ch·∫≠m d·∫ßn (Arrive steering behavior)
            let speed = dist * 0.04; 
            if(speed > 5) speed = 5; // Max speed
            
            d.vx = dx * 0.03; 
            d.vy = dy * 0.03;

            // Th√™m nhi·ªÖu lo·∫°n (Noise) ƒë·ªÉ kh√¥ng bay th·∫≥ng tu·ªôt
            d.x += d.vx + Math.sin(time * 0.1 + d.offset) * 0.5;
            d.y += d.vy + Math.cos(time * 0.1 + d.offset) * 0.5;

            // Khi ƒë√£ v√†o v·ªã tr√≠ (Hover effect)
            if(dist < 5) {
                // Rung ƒë·ªông theo nh·∫°c (Bass m·∫°nh rung m·∫°nh)
                d.x += (Math.random()-0.5) * excite * 2;
                d.y += (Math.random()-0.5) * excite * 2;
            }

            // V·∫Ω Drone
            ctx.fillStyle = d.color || '#fff';
            // Hi·ªáu ·ª©ng l·∫•p l√°nh
            if(Math.random() > 0.95) ctx.fillStyle = '#fff'; 
            
            ctx.fillRect(d.x, d.y, d.size, d.size);
        });
    }

    // 3. X·ª≠ l√Ω t·∫°o h√¨nh (Text to Points)
    function formText(text, colorObj, fontName) {
        // Canvas ·∫©n ƒë·ªÉ qu√©t pixel
        const offCanvas = document.createElement('canvas');
        const offCtx = offCanvas.getContext('2d');
        
        // T√≠nh to√°n font size sao cho v·ª´a m√†n h√¨nh
        let fSize = 100;
        if(isMobile) fSize = 60;
        
        // Auto scale n·∫øu ch·ªØ qu√° d√†i
        if(text.length > 10) fSize = fSize * 0.7;

        offCtx.font = `900 ${fSize}px "${fontName}"`;
        let measure = offCtx.measureText(text);
        offCanvas.width = measure.width + 50;
        offCanvas.height = fSize * 2;
        
        // V·∫Ω ch·ªØ tr·∫Øng l√™n n·ªÅn ƒëen
        offCtx.font = `900 ${fSize}px "${fontName}"`;
        offCtx.fillStyle = '#fff';
        offCtx.textBaseline = 'middle';
        offCtx.textAlign = 'center';
        offCtx.fillText(text, offCanvas.width/2, offCanvas.height/2);

        scanPixelsAndAssign(offCanvas, colorObj);
    }

    function formImageShape() {
        const offCanvas = document.createElement('canvas');
        const offCtx = offCanvas.getContext('2d');
        let s = Math.min(width, height) * 0.6;
        offCanvas.width = s; offCanvas.height = s;
        
        offCtx.textAlign = 'center'; offCtx.textBaseline = 'middle';
        
        // V·∫Ω B√°nh kem v√† Tim b·∫±ng Emoji (ƒë∆°n gi·∫£n, hi·ªáu qu·∫£) ho·∫∑c Shape
        let fontSize = s * 0.4;
        offCtx.font = `${fontSize}px Arial`;
        offCtx.fillText("üéÇ", s*0.3, s/2);
        offCtx.fillText("‚ù§Ô∏è", s*0.7, s/2);

        scanPixelsAndAssign(offCanvas, CONFIG.COLORS.GOLD);
    }

    function scanPixelsAndAssign(sourceCanvas, colorObj) {
        let imgData = sourceCanvas.getContext('2d').getImageData(0,0, sourceCanvas.width, sourceCanvas.height).data;
        let points = [];
        
        // T√≠nh t·ªâ l·ªá ph√≥ng to ra m√†n h√¨nh ch√≠nh
        let scale = Math.min(width * 0.9 / sourceCanvas.width, height * 0.6 / sourceCanvas.height);
        let startX = (width - sourceCanvas.width * scale) / 2;
        let startY = (height - sourceCanvas.height * scale) / 2;

        for(let y=0; y<sourceCanvas.height; y+=PARTICLE_DENSITY) {
            for(let x=0; x<sourceCanvas.width; x+=PARTICLE_DENSITY) {
                // L·∫•y pixel c√≥ ƒë·ªô alpha > 128 (c√≥ ch·ªØ)
                if(imgData[(y*sourceCanvas.width + x)*4 + 3] > 128) {
                    points.push({
                        x: startX + x * scale,
                        y: startY + y * scale
                    });
                }
            }
        }

        // Qu·∫£n l√Ω s·ªë l∆∞·ª£ng Drone
        // 1. N·∫øu thi·∫øu -> T·∫°o th√™m
        if(drones.length < points.length) {
            let needed = points.length - drones.length;
            for(let i=0; i<needed; i++) {
                drones.push({
                    x: Math.random() * width, // Xu·∫•t hi·ªán ng·∫´u nhi√™n
                    y: height + 100, 
                    tx: width/2, ty: height/2, // T·∫°m
                    vx: 0, vy: 0,
                    size: DRONE_SIZE,
                    offset: Math.random() * 100 // Cho noise
                });
            }
        }

        // 2. G√°n m·ª•c ti√™u (Target)
        // Shuffle points ƒë·ªÉ drone kh√¥ng bay theo h√†ng l·ªëi (Tr√¥ng t·ª± nhi√™n h∆°n)
        points.sort(() => Math.random() - 0.5);

        drones.forEach((d, i) => {
            if(i < points.length) {
                d.tx = points[i].x;
                d.ty = points[i].y;
                // M√†u s·∫Øc gradient nh·∫π
                let h = colorObj.h + (d.tx / width) * 30; // Bi·∫øn thi√™n m√†u theo chi·ªÅu ngang
                d.color = `hsl(${h}, ${colorObj.s}%, ${colorObj.l}%)`;
            } else {
                // Drone th·ª´a th√¨ bay l∆° l·ª≠ng xung quanh ho·∫∑c ·∫©n ƒëi
                d.tx = width/2 + (Math.random()-0.5)*width;
                d.ty = height + 100;
                d.color = 'transparent';
            }
        });
    }

    function explodeDronesFormation() {
        // L√†m drone "gi·∫≠t m√¨nh" t·∫£n ra m·ªôt ch√∫t tr∆∞·ªõc khi x·∫øp h√¨nh m·ªõi
        drones.forEach(d => {
            d.vx += (Math.random()-0.5) * 20;
            d.vy += (Math.random()-0.5) * 20;
        });
    }

    // --- M√ÄN CU·ªêI: T√ÇM TH∆Ø ---
    function showLetter() {
        state = "LETTER";
        document.getElementById('letter-container').style.display = 'flex';
        // Fade in
        setTimeout(() => { document.getElementById('letter-container').style.opacity = 1; }, 100);

        const content = "D∆∞∆°ng ∆°i, h√¥m nay l√† ng√†y 01/03/2026, c·∫≠u c≈©ng tr√≤n 19 tu·ªïi. T·ªõ ch√∫c c·∫≠u ng√†y c√†ng xinh ƒë·∫πp, h·ªçc gi·ªèi, ƒë·∫°t ƒë∆∞·ª£c k·∫øt qu·∫£ cao trong h·ªçc t·∫≠p, s·ªõm ƒë·∫°t ƒë∆∞·ª£c nh·ªØng ∆∞·ªõc m∆° m√† c·∫≠u ƒë√£ t·ª´ng mong ∆∞·ªõc. T·ªõ c≈©ng xin l·ªói, th·ªùi gian v·ª´a qua ƒë√£ l√†m c·∫≠u ph·∫£i bu·ªìn, gi·∫≠n, ch√°n gh√©t t·ªõ. Th√¥i c≈©ng ƒë√£ qua nƒÉm m·ªõi t·ªõ mong r·∫±ng c·∫≠u c√≥ th·ªÉ kh√¥ng ƒë·ªÉ b·ª•ng ƒë·∫øn t√≠nh c√°ch \"tr·∫ª tr√¢u\" c·ªßa t·ªõ. T·ªõ c·∫£m ∆°n c·∫≠u!";
        const el = document.getElementById('letter-content');
        let idx = 0;
        
        // Hi·ªáu ·ª©ng g√µ m√°y ch·ªØ
        let typeInt = setInterval(() => {
            el.innerHTML = content.substring(0, idx) + '<span class="cursor"></span>';
            idx++;
            if(idx > content.length) {
                clearInterval(typeInt);
                el.innerHTML = content; // X√≥a cursor
                setTimeout(() => {
                    document.getElementById('letter-signature').innerText = "Ng∆∞·ªùi g·ª≠i: Nguy·ªÖn B·∫Øc S∆°n\n‚ù§Ô∏è";
                }, 1000);
            }
        }, 50);
    }

    // --- MAIN LOOP ---
    function animate() {
        requestAnimationFrame(animate);
        time++;

        // X√≥a m√†n h√¨nh v·ªõi hi·ªáu ·ª©ng m·ªù ƒëu√¥i (Trails)
        ctx.fillStyle = 'rgba(0, 0, 0, 0.2)'; // 0.2 t·∫°o ƒëu√¥i v·ª´a ph·∫£i
        ctx.fillRect(0, 0, width, height);

        // Ch·∫ø ƒë·ªô h√≤a tr·ªôn cho √°nh s√°ng ƒë·∫πp
        ctx.globalCompositeOperation = 'lighter';

        // 1. Render Ph√°o hoa
        for(let i = fireworks.length - 1; i >= 0; i--) {
            let fw = fireworks[i];
            if(fw.state === "FLY") {
                fw.x += fw.vx;
                fw.y += fw.vy;
                fw.vy += 0.2; // Gravity nh·∫π khi bay l√™n
                
                // V·∫Ω ƒëu√¥i
                ctx.beginPath(); ctx.arc(fw.x, fw.y, 2, 0, Math.PI*2); 
                ctx.fillStyle = fw.color; ctx.fill();

                if(fw.vy >= 0 || fw.y <= fw.ty) {
                    createExplosion(fw.x, fw.y, fw.color, fw.shape);
                    fireworks.splice(i, 1);
                }
            }
        }

        // 2. Render H·∫°t n·ªï
        for(let i = particles.length - 1; i >= 0; i--) {
            let p = particles[i];
            p.x += p.vx; p.y += p.vy;
            p.vy += p.gravity;
            p.vx *= 0.95; p.vy *= 0.95; // S·ª©c c·∫£n kh√¥ng kh√≠
            p.alpha -= p.decay;

            if(p.alpha <= 0) {
                particles.splice(i, 1);
            } else {
                ctx.globalAlpha = p.alpha;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, 2, 2);
            }
        }

        // 3. Render Shockwaves
        ctx.lineWidth = 2;
        for(let i = shockwaves.length - 1; i >= 0; i--) {
            let s = shockwaves[i];
            s.r += 5;
            s.alpha -= 0.03;
            if(s.alpha <= 0) {
                shockwaves.splice(i, 1);
            } else {
                ctx.beginPath();
                ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
                ctx.strokeStyle = `rgba(255, 255, 255, ${s.alpha})`;
                ctx.stroke();
            }
        }
        ctx.globalAlpha = 1;

        // 4. Render Countdown (N·∫øu c√≥)
        if(state === "COUNTDOWN") {
            ctx.fillStyle = "#fff";
            ctx.font = "bold 150px Cinzel";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(window.currentCountdown || "", width/2, height/2);
        }

        // 5. Render Drones
        if(state === "DRONE") {
            updateDrones();
        }

        ctx.globalCompositeOperation = 'source-over';
    }

    animate();

</script>
</body>
</html>