<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SON_V20_TREND_HEART</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Black+Ops+One&family=Dancing+Script:wght@700&display=swap');
        
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Share Tech Mono', monospace; }
        canvas { display: block; position: absolute; top: 0; left: 0; z-index: 1; }

        /* UI */
        #ui-layer {
            position: absolute; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            flex-direction: column; z-index: 999; pointer-events: none;
        }

        .cyber-btn {
            pointer-events: auto; background: #000; color: #FF1493; border: 2px solid #FF1493;
            padding: 20px 45px; font-size: 22px; cursor: pointer; 
            font-family: 'Black Ops One', cursive; letter-spacing: 2px;
            box-shadow: 0 0 15px #FF1493; transition: 0.3s;
            animation: pulse 2s infinite; border-radius: 10px;
        }
        .cyber-btn:hover { background: #FF1493; color: #FFF; box-shadow: 0 0 40px #FF1493; }

        /* 3D Cube */
        #cube-container { display: none; perspective: 800px; width: 150px; height: 150px; margin-bottom: 20px;}
        #cube { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; animation: spin 4s infinite linear; }
        .face {
            position: absolute; width: 146px; height: 146px;
            border: 2px solid #0F0; background: rgba(0, 255, 0, 0.05);
            color: #0F0; font-size: 80px; display: flex;
            justify-content: center; align-items: center;
            font-family: 'Black Ops One';
        }
        .front { transform: translateZ(75px); } .back { transform: rotateY(180deg) translateZ(75px); }
        .right { transform: rotateY(90deg) translateZ(75px); } .left { transform: rotateY(-90deg) translateZ(75px); }
        .top { transform: rotateX(90deg) translateZ(75px); } .bottom { transform: rotateX(-90deg) translateZ(75px); }
        
        @keyframes spin { from { transform: rotateX(0) rotateY(0); } to { transform: rotateX(360deg) rotateY(360deg); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* Message Layer */
        #msg-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); display: none; z-index: 3000;
            flex-direction: column; justify-content: center; align-items: center;
            padding: 20px; box-sizing: border-box;
        }
        #msg-content {
            color: #FF69B4; font-size: 16px; line-height: 1.6; font-family: 'Dancing Script', cursive; font-weight: bold;
            white-space: pre-wrap; max-width: 650px; text-shadow: 0 0 10px #FF69B4;
            border: 2px solid #FF69B4; padding: 20px; border-radius: 15px;
            background: radial-gradient(circle, rgba(50,0,20,0.8) 0%, rgba(0,0,0,0.8) 100%);
        }
        #skip-btn { margin-top: 30px; padding: 12px 30px; border: 1px solid #FFD700; background: transparent; color: #FFD700; display: none; pointer-events: auto; font-weight: bold; cursor: pointer; transition: 0.3s; border-radius: 20px; }
        #skip-btn:hover { background: #FFD700; color: #000; }

        /* Virus Glitch */
        .glitch-layer { position: absolute; top:0; left:0; width:100%; height:100%; z-index: 2000; display:none; pointer-events:none; mix-blend-mode: hard-light; }
        #virus-terminal { position: absolute; top:20%; left:5%; width:90%; color:#F00; font-family:'Share Tech Mono'; display:none; z-index:2001; text-shadow:0 0 5px #F00; background:rgba(0,0,0,0.8); padding:10px; border:1px solid #F00;}

    </style>
</head>
<body>
    <canvas id="c"></canvas>
    <div id="glitch-div" class="glitch-layer"></div>
    <div id="virus-terminal"></div>
    
    <div id="ui-layer">
        <button id="btn-start" class="cyber-btn">CH·∫†Y CODE TR√ÅI TIM</button>
        <div id="cube-container">
            <div id="cube">
                <div class="face front">10</div><div class="face back">10</div>
                <div class="face right">10</div><div class="face left">10</div>
                <div class="face top">10</div><div class="face bottom">10</div>
            </div>
        </div>
    </div>

    <div id="msg-layer">
        <div style="color: #FFD700; font-size: 24px; margin-bottom: 20px; font-family: 'Dancing Script';">üíå Th∆∞ g·ª≠i D∆∞∆°ng</div>
        <div id="msg-content"></div>
        <button id="skip-btn" onclick="startFinale()">TI·∫æP T·ª§C >></button>
    </div>

    <audio id="audio" src="https://nguyenbacson.io.vn/miss-you-happy-birthday.mp3" loop></audio>

<script>
    // --- N·ªòI DUNG ---
    const LETTER = `D∆∞∆°ng ∆°i, h√¥m nay 01/03/2026, c·∫≠u tr√≤n 19 tu·ªïi.

T·ªõ ch√∫c c·∫≠u tu·ªïi m·ªõi lu√¥n xinh ƒë·∫πp r·∫°ng ng·ªùi, h·ªçc t·∫≠p th·∫≠t gi·ªèi v√† s·ªõm ƒë·∫°t ƒë∆∞·ª£c m·ªçi ∆∞·ªõc m∆°.

C·∫£m ∆°n c·∫≠u ƒë√£ ƒë·∫øn v√† l√†m cho th·∫ø gi·ªõi c·ªßa t·ªõ th√™m ƒë·∫∑c bi·ªát. Xin l·ªói v√¨ nh·ªØng l√∫c tr·∫ª con ƒë√£ l√†m c·∫≠u bu·ªìn. Mong c·∫≠u lu√¥n gi·ªØ n·ª• c∆∞·ªùi tr√™n m√¥i nh√©!

Happy Birthday, my special girl! ‚ù§Ô∏è

-- Nguy·ªÖn B·∫Øc S∆°n --`;

    const HEART_TEXT = "Tr∆∞∆°ng Th·ªã\nD∆∞∆°ng"; // T√™n hi·ªán trong tim

    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');
    const isMobile = window.innerWidth < 768;
    let w, h;

    // Config Particles
    const PARTICLE_COUNT = isMobile ? 1200 : 2500; // S·ªë l∆∞·ª£ng h·∫°t cho tim
    const DRONE_SIZE = isMobile ? 2.5 : 2;

    let state = "IDLE"; 
    let particles = [], fireworks = [], sparkles = [];
    let countdown = 10;
    
    // Heart Points Cache
    let heartPoints = [];
    let textPoints = [];
    let scaleHeart = 0; // ƒê·ªÉ hi·ªáu ·ª©ng tim ƒë·∫≠p

    function resize() {
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // --- START ---
    document.getElementById('btn-start').onclick = function() {
        this.style.display = 'none';
        document.getElementById('audio').play().catch(()=>{});
        runCountdown();
    };

    // --- 1. COUNTDOWN ---
    function runCountdown() {
        state = "COUNTDOWN";
        document.getElementById('cube-container').style.display = 'block';
        const faces = document.querySelectorAll('.face');
        let tmr = setInterval(() => {
            countdown--;
            faces.forEach(f => f.innerText = countdown);
            if(countdown <= 0) {
                clearInterval(tmr);
                document.getElementById('cube-container').style.display = 'none';
                runVirus();
            }
        }, 1000);
    }

    // --- 2. VIRUS ---
    function runVirus() {
        state = "VIRUS";
        const term = document.getElementById('virus-terminal');
        const glitch = document.getElementById('glitch-div');
        term.style.display = 'block'; glitch.style.display = 'block';
        
        let logs = "";
        let count = 0;
        let t = setInterval(() => {
            logs += `> INJECTING LOVE_CODE.EXE... ${count}%\n`;
            term.innerText = logs; term.scrollTop = term.scrollHeight;
            count+=5;
            
            // Glitch effect
            canvas.style.transform = `translate(${Math.random()*10-5}px, ${Math.random()*10-5}px)`;

            if(count > 100) {
                clearInterval(t);
                term.style.display = 'none'; glitch.style.display = 'none';
                canvas.style.transform = "none";
                runHeartTrend(); // CHUY·ªÇN SANG CODE TR√ÅI TIM
            }
        }, 100);
    }

    // --- 3. TREND CODE TR√ÅI TIM (ALEXX.DEV STYLE) ---
    function runHeartTrend() {
        state = "HEART_TREND";
        
        // 1. T√≠nh to√°n ƒëi·ªÉm h√¨nh tr√°i tim
        heartPoints = getHeartOutlinePoints();
        // 2. T√≠nh to√°n ƒëi·ªÉm t√™n ng∆∞·ªùi (N·∫±m gi·ªØa tim)
        textPoints = getTextPoints(HEART_TEXT);
        
        // K·∫øt h·ª£p ƒëi·ªÉm l·∫°i
        let allTargets = [...heartPoints, ...textPoints];
        
        // T·∫°o h·∫°t b·∫Øt ƒë·∫ßu t·ª´ 2 g√≥c d∆∞·ªõi (M√¥ ph·ªèng 2 con m√®o b·∫Øn tim)
        particles = [];
        for(let i=0; i<allTargets.length; i++) {
            let startX = (i % 2 === 0) ? 0 : w; // Tr√°i ho·∫∑c Ph·∫£i
            let startY = h;
            
            particles.push({
                x: startX, y: startY,
                tx: allTargets[i].x, ty: allTargets[i].y, // Target
                vx: (Math.random()-0.5)*2, vy: (Math.random()-0.5)*2,
                c: (i < heartPoints.length) ? "#FF1493" : "#FFFFFF", // Tim h·ªìng, Ch·ªØ tr·∫Øng
                delay: Math.random() * 100 // Bay l·ªách nhau x√≠u cho t·ª± nhi√™n
            });
        }
        
        // Th√™m h·∫°t bay lung tung l√†m n·ªÅn
        for(let i=0; i<300; i++) {
            particles.push({
                x: Math.random()*w, y: h,
                tx: Math.random()*w, ty: Math.random()*h,
                vx: 0, vy: 0,
                c: "rgba(255, 105, 180, 0.3)",
                isBg: true
            });
        }

        // Chuy·ªÉn sang m√†n th∆∞ sau 15 gi√¢y ng·∫Øm tim
        setTimeout(runMessage, 15000);
    }

    // --- 4. MESSAGE ---
    function runMessage() {
        state = "MSG";
        document.getElementById('msg-layer').style.display = 'flex';
        const content = document.getElementById('msg-content');
        const btn = document.getElementById('skip-btn');
        
        let i = 0;
        let t = setInterval(() => {
            content.innerText = LETTER.substring(0, i) + "_";
            i++;
            if(i > LETTER.length) {
                clearInterval(t);
                content.innerText = LETTER;
                btn.style.display = 'block';
                setTimeout(() => { if(state==="MSG") startFinale(); }, 15000);
            }
        }, 40);
    }

    window.startFinale = function() {
        document.getElementById('msg-layer').style.display = 'none';
        state = "FINALE";
        
        // Chuy·ªÉn h·∫°t th√†nh B√°nh kem
        formCake();
        
        // B·∫Øn ph√°o hoa tim
        setInterval(() => {
            if(Math.random()>0.2) launchHeartFirework();
        }, 400);
    };

    // --- MATH HELPERS ---
    
    // H√†m t·∫°o ƒëi·ªÉm h√¨nh tr√°i tim chu·∫©n to√°n h·ªçc
    function getHeartOutlinePoints() {
        let pts = [];
        let r = Math.min(w, h) * (isMobile ? 0.015 : 0.012); // B√°n k√≠nh
        let count = isMobile ? 600 : 1000;
        
        for(let i=0; i<count; i++) {
            let t = (i/count) * Math.PI * 2;
            // C√¥ng th·ª©c tr√°i tim
            let x = 16 * Math.pow(Math.sin(t), 3);
            let y = -(13 * Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t));
            
            pts.push({
                x: w/2 + x * r,
                y: h/2 + y * r - (h*0.05) // D·ªãch l√™n t√≠ cho c√¢n
            });
        }
        return pts;
    }

    function getTextPoints(txt) {
        const tmp = document.createElement('canvas');
        const tCtx = tmp.getContext('2d');
        let fSize = isMobile ? 40 : 60;
        tCtx.font = `bold ${fSize}px "Dancing Script"`;
        
        let lines = txt.split('\n');
        let maxW = 0;
        lines.forEach(l => maxW = Math.max(maxW, tCtx.measureText(l).width));
        
        tmp.width = maxW + 20; tmp.height = lines.length * fSize * 1.5;
        tCtx.font = `bold ${fSize}px "Dancing Script"`;
        tCtx.fillStyle = '#fff'; tCtx.textAlign = 'center'; tCtx.textBaseline = 'middle';
        
        lines.forEach((l, i) => {
            tCtx.fillText(l, tmp.width/2, fSize + i*fSize);
        });

        let data = tCtx.getImageData(0,0,tmp.width,tmp.height).data;
        let pts = [];
        let gap = 3;
        
        for(let y=0; y<tmp.height; y+=gap) {
            for(let x=0; x<tmp.width; x+=gap) {
                if(data[(y*tmp.width+x)*4+3] > 128) {
                    pts.push({
                        x: w/2 - tmp.width/2 + x,
                        y: h/2 - tmp.height/2 + y
                    });
                }
            }
        }
        return pts;
    }

    function formCake() {
        // T√°i s·ª≠ d·ª•ng h·∫°t c≈© ƒë·ªÉ x·∫øp b√°nh
        particles.forEach(p => {
             p.c = "#FFD700"; // ƒê·ªïi m√†u v√†ng
        });
        
        const tmp = document.createElement('canvas');
        const tCtx = tmp.getContext('2d');
        let s = Math.min(w, h) * 0.6;
        tmp.width = tmp.height = s;
        tCtx.font = `${s/2}px serif`; tCtx.textAlign='center'; tCtx.textBaseline='middle';
        tCtx.fillStyle='#fff'; tCtx.fillText("üéÇ", s/2, s/2);
        
        let data = tCtx.getImageData(0,0,s,s).data;
        let targets = [];
        let gap = 4;
        
        for(let y=0; y<s; y+=gap) {
            for(let x=0; x<s; x+=gap) {
                if(data[(y*s+x)*4+3]>128) {
                    targets.push({x: w/2 - s/2 + x, y: h/2 - s/2 + y});
                }
            }
        }
        
        // G√°n target m·ªõi
        particles.forEach((p, i) => {
            if(i < targets.length) {
                p.tx = targets[i].x; p.ty = targets[i].y;
            } else {
                p.tx = Math.random()*w; p.ty = -100; p.c = "transparent";
            }
        });
    }

    // --- FIREWORKS ---
    function launchHeartFirework() {
        let x = Math.random() * w;
        let y = h;
        let ty = h*0.2 + Math.random()*h*0.3;
        fireworks.push({x:x, y:y, tx:x, ty:ty, vy:-12, c:`hsl(${Math.random()*60+330},100%,60%)`});
    }

    function explode(fw) {
        for(let i=0; i<40; i++) {
            let t = (i/40) * Math.PI * 2;
            let dx = 16 * Math.pow(Math.sin(t), 3);
            let dy = -(13 * Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t));
            let s = Math.random() * 0.1 + 0.05; 
            sparkles.push({
                x: fw.x, y: fw.y, vx: dx * s, vy: dy * s, 
                c: fw.c, l: 1.5, g: 0.05
            });
        }
    }

    // --- ANIMATION LOOP ---
    let time = 0;
    function loop() {
        requestAnimationFrame(loop);
        time++;

        // N·ªÅn t·ªëi
        ctx.fillStyle = "rgba(0,0,0,0.2)";
        ctx.fillRect(0,0,w,h);

        // Hi·ªáu ·ª©ng tim ƒë·∫≠p (Scale)
        let beat = 1;
        if(state === "HEART_TREND") {
            beat = 1 + Math.sin(time * 0.1) * 0.02; // Nh·ªãp tim nh·∫π
        }

        // Render Particles
        particles.forEach(p => {
            if(state === "HEART_TREND" || state === "FINALE") {
                // Di chuy·ªÉn v·ªÅ ƒë√≠ch (Easing)
                let dx = p.tx - p.x;
                let dy = p.ty - p.y;
                
                if(p.isBg) {
                    p.y -= 2;
                    if(p.y < 0) p.y = h;
                } else {
                    p.x += dx * 0.05; // Bay t·ª´ t·ª´
                    p.y += dy * 0.05;
                }
                
                // V·∫Ω c√≥ t√¢m (Scale from center)
                let finalX = p.x; 
                let finalY = p.y;
                
                if(!p.isBg && state === "HEART_TREND") {
                     // √Åp d·ª•ng nh·ªãp tim
                     let cx = w/2; let cy = h/2;
                     finalX = cx + (p.x - cx) * beat;
                     finalY = cy + (p.y - cy) * beat;
                }

                ctx.fillStyle = p.c;
                ctx.fillRect(finalX, finalY, DRONE_SIZE, DRONE_SIZE);
            }
        });

        // Render Fireworks
        for(let i=fireworks.length-1; i>=0; i--) {
            let f = fireworks[i];
            f.y += f.vy; f.vy += 0.2;
            ctx.fillStyle = f.c; ctx.fillRect(f.x, f.y, 3, 3);
            if(f.vy >= 0) { explode(f); fireworks.splice(i, 1); }
        }

        // Render Sparkles
        for(let i=sparkles.length-1; i>=0; i--) {
            let s = sparkles[i];
            s.x += s.vx; s.y += s.vy; s.vy += s.g; s.l -= 0.02;
            if(s.l <= 0) sparkles.splice(i, 1);
            else { ctx.globalAlpha = Math.min(s.l, 1); ctx.fillStyle = s.c; ctx.fillRect(s.x, s.y, 2, 2); ctx.globalAlpha=1; }
        }
    }
    loop();

</script>
</body>
</html>
