<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SON_V19_ULTIMATE_PARTY</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Share+Tech+Mono&family=Black+Ops+One&display=swap');
    
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Share Tech Mono', monospace; }
        canvas { display: block; position: absolute; top: 0; left: 0; z-index: 1; }

        /* UI */
        #ui-layer {
            position: absolute; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            flex-direction: column; z-index: 999; pointer-events: none;
        }
        .cyber-btn {
            pointer-events: auto; background: #000; color: #FF69B4; border: 2px solid #FF69B4;
            padding: 20px 45px; font-size: 22px; cursor: pointer; 
            font-family: 'Black Ops One', cursive; letter-spacing: 2px;
            box-shadow: 0 0 15px #FF69B4; transition: 0.3s;
            animation: pulse 2s infinite;
        }
        .cyber-btn:hover { background: #FF69B4; color: #000; box-shadow: 0 0 40px #FF69B4; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* --- HI·ªÜU ·ª®NG M·ªöI: CH·ªÆ CH·∫†Y THEO TIM --- */
        #path-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; justify-content: center; align-items: center;
            z-index: 800; pointer-events: none;
        }
        /* ƒê∆∞·ªùng d·∫´n h√¨nh tr√°i tim SVG (·∫®n) */
        #heart-path {
            position: absolute; width: 0; height: 0;
        }
        /* Ch·ªØ ch·∫°y tr√™n ƒë∆∞·ªùng d·∫´n */
        #moving-text {
            font-family: 'Dancing Script', cursive;
            font-size: 24px; fill: #FF1493; /* M√†u h·ªìng ƒë·∫≠m */
            text-shadow: 0 0 5px #FF69B4, 0 0 10px #FF69B4;
            letter-spacing: 3px; font-weight: bold;
        }
        /* Hi·ªáu ·ª©ng h·∫°t bay n·ªÅn cho m√†n h√¨nh tim */
        .floating-particle {
            position: absolute; width: 3px; height: 3px;
            background: #FF69B4; border-radius: 50%;
            animation: floatUp linear infinite; opacity: 0;
        }
        @keyframes floatUp {
            0% { transform: translateY(100vh) scale(0.5); opacity: 0; }
            20% { opacity: 0.8; }
            100% { transform: translateY(-10vh) scale(1); opacity: 0; }
        }

        /* Message Layer */
        #msg-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.92); display: none; z-index: 3000;
            flex-direction: column; justify-content: center; align-items: center;
            padding: 20px; box-sizing: border-box;
        }
        #msg-content {
            color: #FF69B4; font-size: 16px; line-height: 1.6; font-family: 'Dancing Script', cursive; font-weight: bold;
            white-space: pre-wrap; max-width: 650px; text-shadow: 0 0 10px #FF69B4;
            border-left: 4px solid #FF69B4; padding-left: 20px; background: rgba(20, 0, 10, 0.5);
        }
        #skip-btn { margin-top: 30px; padding: 12px 30px; border: 1px solid #FFD700; background: transparent; color: #FFD700; display: none; pointer-events: auto; font-weight: bold; cursor: pointer; transition: 0.3s; }
        #skip-btn:hover { background: #FFD700; color: #000; }

    </style>
</head>
<body>
    <canvas id="c"></canvas>
    
    <div id="path-container">
        <div id="particles-bg"></div>
        
        <svg width="600" height="500" viewBox="0 0 600 500" style="overflow: visible;">
            <defs>
                <path id="heartPath" d="M290,120 C160,-20 -20,180 290,460 C600,180 420,-20 290,120" fill="none" />
            </defs>
            
            <text dy="-5">
                <textPath href="#heartPath" id="moving-text" startOffset="0%">
                    G·ª¨I ƒê·∫æN: TR∆Ø∆†NG TH·ªä D∆Ø∆†NG  ‚ù§Ô∏è  HAPPY BIRTHDAY 19 TU·ªîI  ‚ù§Ô∏è
                </textPath>
            </text>
        </svg>
    </div>

    <div id="ui-layer">
        <button id="btn-start" class="cyber-btn">B·∫ÆT ƒê·∫¶U BU·ªîI TI·ªÜC</button>
    </div>

    <div id="msg-layer">
        <div style="color: #FFD700; font-size: 20px; margin-bottom: 20px;">üíå T√ÇM TH∆Ø G·ª¨I D∆Ø∆†NG</div>
        <div id="msg-content"></div>
        <button id="skip-btn" onclick="startFinale()">TI·∫æP T·ª§C >></button>
    </div>

    <audio id="audio" src="https://nguyenbacson.io.vn/miss-you-happy-birthday.mp3" loop></audio>

<script>
    // --- T√ÇM TH∆Ø ---
    const LETTER = `D∆∞∆°ng ∆°i, h√¥m nay 01/03/2026, c·∫≠u tr√≤n 19 tu·ªïi.

T·ªõ ch√∫c c·∫≠u tu·ªïi m·ªõi lu√¥n xinh ƒë·∫πp r·∫°ng ng·ªùi, h·ªçc t·∫≠p th·∫≠t gi·ªèi v√† s·ªõm ƒë·∫°t ƒë∆∞·ª£c m·ªçi ∆∞·ªõc m∆°.

C·∫£m ∆°n c·∫≠u ƒë√£ ƒë·∫øn v√† l√†m cho th·∫ø gi·ªõi c·ªßa t·ªõ th√™m ƒë·∫∑c bi·ªát. Xin l·ªói v√¨ nh·ªØng l√∫c tr·∫ª con ƒë√£ l√†m c·∫≠u bu·ªìn. Mong c·∫≠u lu√¥n gi·ªØ n·ª• c∆∞·ªùi tr√™n m√¥i nh√©!

Happy Birthday, my special girl! ‚ù§Ô∏è

-- Nguy·ªÖn B·∫Øc S∆°n --`;

    // --- K·ªäCH B·∫¢N T·ªîNG TH·ªÇ ---
    const SCRIPT = [
        // M√†n 3: Drone Show
        { t: "CH√öC M·ª™NG\nNƒÇM M·ªöI 2026", c: "#FFD700" },
        { t: "XU√ÇN B√çNH NG·ªå\nM√É ƒê√ÅO TH√ÄNH C√îNG", c: "#00FFFF" },
        { t: "HAPPY VALENTINE\n14/02 NG·ªåT NG√ÄO", c: "#FF0055" },
        { t: "QU·ªêC T·∫æ PH·ª§ N·ªÆ\n8/3 VUI V·∫∫", c: "#FFF" },
        { t: "HAPPY BIRTHDAY\nSINH NH·∫¨T TU·ªîI 19", c: "#FFD700" },
        // M√†n 4: T√¢m th∆∞
        { action: "MSG" } 
    ];

    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');
    const isMobile = window.innerWidth < 768;
    let w, h;

    // C·∫§U H√åNH DRONE (Neon)
    const DOT_GAP = isMobile ? 4 : 3; 
    const DOT_SIZE = isMobile ? 3 : 2.5; 

    let state = "IDLE"; 
    let drones = [], fireworks = [], particles = [], hearts = [];
    let scriptIdx = 0;
    let pathOffset = 100; // Cho ch·ªØ ch·∫°y t·ª´ 100% v·ªÅ 0

    function resize() {
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // --- START ---
    document.getElementById('btn-start').onclick = function() {
        this.style.display = 'none';
        document.getElementById('audio').play().catch(()=>{});
        // M√†n 1: Khai ti·ªác Ph√°o hoa
        runOpening();
    };

    // --- M√ÄN 1: OPENING FIREWORKS ---
    function runOpening() {
        state = "OPENING";
        // B·∫Øn ph√°o hoa li√™n t·ª•c trong 8 gi√¢y
        let fwInterval = setInterval(() => {
            if(Math.random()>0.3) launchFirework();
        }, 400);

        setTimeout(() => {
            clearInterval(fwInterval);
            runPathText(); // Chuy·ªÉn sang m√†n 2
        }, 8000);
    }

    // --- M√ÄN 2: CH·ªÆ CH·∫†Y THEO TIM (HI·ªÜU ·ª®NG M·ªöI) ---
    function runPathText() {
        state = "PATH_TEXT";
        const container = document.getElementById('path-container');
        const textPath = document.getElementById('moving-text');
        container.style.display = 'flex';
        
        // T·∫°o h·∫°t n·ªÅn bay l√™n
        createFloatingParticles();

        // Animation ch·ªØ ch·∫°y
        // D√πng JS interval ƒë·ªÉ control m∆∞·ª£t h∆°n tr√™n mobile
        let pathAnim = setInterval(() => {
            pathOffset -= 0.3; // T·ªëc ƒë·ªô ch·∫°y
            if(pathOffset < -50) pathOffset = 100; // Loop l·∫°i
            textPath.setAttribute('startOffset', pathOffset + "%");
        }, 20);

        // Ch·∫°y trong 14 gi√¢y r·ªìi chuy·ªÉn m√†n
        setTimeout(() => {
            clearInterval(pathAnim);
            container.style.display = 'none';
            // X√≥a h·∫°t n·ªÅn
            document.getElementById('particles-bg').innerHTML = '';
            runDroneShow(); // Chuy·ªÉn sang m√†n 3
        }, 14000);
    }

    function createFloatingParticles() {
        const bg = document.getElementById('particles-bg');
        for(let i=0; i<40; i++) {
            let p = document.createElement('div');
            p.className = 'floating-particle';
            p.style.left = Math.random()*100 + "%";
            p.style.animationDuration = (Math.random()*5 + 5) + "s";
            p.style.animationDelay = Math.random()*5 + "s";
            bg.appendChild(p);
        }
    }

    // --- M√ÄN 3: DRONE SHOW ---
    function runDroneShow() {
        state = "SHOW";
        nextScene();
    }

    function nextScene() {
        if(scriptIdx >= SCRIPT.length) return;
        let s = SCRIPT[scriptIdx++];
        
        if(s.action === "MSG") {
            setTimeout(runMessage, 1500);
            return;
        }

        formText(s.t, s.c);
        setTimeout(nextScene, 9000); 
    }

    // --- M√ÄN 4: MESSAGE ---
    function runMessage() {
        state = "MSG";
        const layer = document.getElementById('msg-layer');
        const content = document.getElementById('msg-content');
        const btn = document.getElementById('skip-btn');
        layer.style.display = 'flex';
        
        // Drone bay l√†m n·ªÅn h·ªìng
        drones.forEach(d => {
            d.tx = Math.random() * w; d.ty = Math.random() * h;
            d.c = "rgba(255, 105, 180, 0.2)";
        });

        let i = 0;
        let tmr = setInterval(() => {
            content.innerText = LETTER.substring(0, i) + "_";
            i++;
            if(i > LETTER.length) {
                clearInterval(tmr);
                content.innerText = LETTER;
                btn.style.display = 'block';
                // T·ª± ƒë·ªông chuy·ªÉn sau 20s
                setTimeout(() => { if(state==="MSG") startFinale(); }, 20000);
            }
        }, 45);
    }

    // --- M√ÄN 5: FINALE ---
    window.startFinale = function() {
        document.getElementById('msg-layer').style.display = 'none';
        state = "FINALE";
        
        formCake();
        
        // Ph√°o hoa tim d·ªìn d·∫≠p
        setInterval(() => {
            if(Math.random()>0.2) launchHeartFirework();
        }, 350);
    };

    // --- LOGIC V·∫º DRONE ---
    function formText(txt, color) {
        const lines = txt.split('\n');
        const tmp = document.createElement('canvas');
        const tCtx = tmp.getContext('2d');
        let fSize = isMobile ? 80 : 140;
        tCtx.font = `900 ${fSize}px "Arial Black"`;
        let maxW = 0;
        lines.forEach(l => {
            let m = tCtx.measureText(l);
            if(m.width > maxW) maxW = m.width;
        });
        tmp.width = maxW + 20;
        tmp.height = lines.length * fSize * 1.3;
        tCtx.font = `900 ${fSize}px "Arial Black"`;
        tCtx.fillStyle = '#fff';
        tCtx.textAlign = 'center'; tCtx.textBaseline = 'middle';
        lines.forEach((l, i) => {
            tCtx.fillText(l, tmp.width/2, fSize*0.8 + i*fSize);
        });
        getPoints(tmp, color);
    }

    function formCake() {
        const tmp = document.createElement('canvas');
        const tCtx = tmp.getContext('2d');
        let s = Math.min(w, h) * 0.8;
        tmp.width = tmp.height = s;
        tCtx.font = `${s/2}px serif`;
        tCtx.textAlign = 'center'; tCtx.textBaseline = 'middle';
        tCtx.fillStyle = '#fff';
        tCtx.fillText("üéÇ", s/2, s/2);
        getPoints(tmp, "#FFD700");
    }

    function getPoints(tmp, color) {
        const data = tmp.getContext('2d').getImageData(0,0, tmp.width, tmp.height).data;
        let points = [];
        let scale = Math.min(w*0.9/tmp.width, h*0.65/tmp.height);
        let sx = (w - tmp.width*scale)/2;
        let sy = (h - tmp.height*scale)/2;
        for(let y=0; y<tmp.height; y+=DOT_GAP) {
            for(let x=0; x<tmp.width; x+=DOT_GAP) {
                if(data[(y*tmp.width + x)*4 + 3] > 128) {
                    points.push({x: sx + x*scale, y: sy + y*scale});
                }
            }
        }
        // Limit max drones
        if(points.length > 4000) {
            points.sort(() => Math.random() - 0.5);
            points = points.slice(0, 4000);
        }
        updateDrones(points, color);
    }

    function updateDrones(pts, color) {
        pts.sort(() => Math.random() - 0.5);
        if(drones.length < pts.length) {
            let add = pts.length - drones.length;
            for(let i=0; i<add; i++) {
                drones.push({
                    x: Math.random()*w, y: Math.random()*h, tx: w/2, ty: h/2, c: color
                });
            }
        }
        drones.forEach((d, i) => {
            if(i < pts.length) {
                d.tx = pts[i].x; d.ty = pts[i].y; d.c = color;
            } else {
                d.tx = Math.random()*w; d.ty = -100; d.c = "transparent";
            }
        });
    }

    // --- EFFECTS ---
    function launchFirework() {
        fireworks.push({
            x: Math.random()*w, y: h, tx: Math.random()*w, ty: Math.random()*h*0.5,
            vy: -15, c: `hsl(${Math.random()*360},100%,60%)`, type: 'NORMAL'
        });
    }
    function launchHeartFirework() {
        fireworks.push({
            x: Math.random()*w, y: h, tx: Math.random()*w, ty: h*0.2 + Math.random()*h*0.3,
            vy: -12, c: `hsl(${Math.random()*60 + 330}, 100%, 60%)`, type: 'HEART'
        });
    }

    function explode(fw) {
        if(fw.type === 'NORMAL') {
            for(let j=0; j<25; j++) {
                let a=Math.random()*Math.PI*2, s=Math.random()*6;
                particles.push({x:fw.x, y:fw.y, vx:Math.cos(a)*s, vy:Math.sin(a)*s, c:fw.c, l:1, g:0.1});
            }
        } else {
            for(let i=0; i<40; i++) {
                let t=(i/40)*Math.PI*2, s=Math.random()*0.1+0.05;
                let dx=16*Math.pow(Math.sin(t),3), dy=-(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
                particles.push({x:fw.x, y:fw.y, vx:dx*s, vy:dy*s, c:fw.c, l:1.5, g:0.05});
            }
        }
    }

    // --- LOOP ---
    function loop() {
        requestAnimationFrame(loop);

        // X√≥a n·ªÅn (M·ªù ƒë·ªÉ t·∫°o ƒëu√¥i)
        ctx.fillStyle = "rgba(0,0,0,0.2)";
        ctx.fillRect(0,0,w,h);

        // Drones
        if(state !== "PATH_TEXT") {
            drones.forEach(d => {
                d.x += (d.tx - d.x) * 0.1;
                d.y += (d.ty - d.y) * 0.1;
                ctx.fillStyle = d.c;
                ctx.fillRect(d.x, d.y, DOT_SIZE, DOT_SIZE);
            });
        }

        // Fireworks
        for(let i=fireworks.length-1; i>=0; i--) {
            let f = fireworks[i];
            f.y += f.vy; f.vy += 0.2;
            ctx.fillStyle = f.c; ctx.fillRect(f.x, f.y, 3, 3);
            if(f.vy >= 0) {
                explode(f);
                fireworks.splice(i, 1);
            }
        }
        
        // Particles
        for(let i=particles.length-1; i>=0; i--) {
            let p = particles[i];
            p.x += p.vx; p.y += p.vy; p.vy += p.g; p.l -= 0.02;
            if(p.l <= 0) particles.splice(i, 1);
            else {
                ctx.globalAlpha = Math.min(p.l, 1);
                ctx.fillStyle = p.c;
                ctx.fillRect(p.x, p.y, 2, 2);
                ctx.globalAlpha = 1;
            }
        }
        
        // Hearts Rain in Finale
        if(state === "FINALE") {
             for(let i=hearts.length-1; i>=0; i--) {
                let he = hearts[i]; he.y += he.vy;
                ctx.font = `${he.sz}px serif`; ctx.fillText("‚ù§Ô∏è", he.x, he.y);
                if(he.y>h) hearts.splice(i,1);
             }
             if(Math.random()>0.8) hearts.push({x:Math.random()*w, y:-20, vy:Math.random()*3+2, sz:Math.random()*20+15});
        }
    }
    loop();

</script>
</body>
</html>
