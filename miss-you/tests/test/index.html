<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HPBD_DUONG_19 | GALAXY EDITION</title>
    <style>
        /* --- IMPORT FONTS --- */
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Black+Ops+One&family=Dancing+Script:wght@700&display=swap');
        
        /* --- C·∫§U H√åNH C∆† B·∫¢N --- */
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Share Tech Mono', monospace; }
        canvas { display: block; position: absolute; top: 0; left: 0; z-index: 1; }

        /* --- UI LAYER (N√∫t b·∫•m & Cube) --- */
        #ui-layer {
            position: absolute; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            flex-direction: column; z-index: 999; pointer-events: none;
        }

        .cyber-btn {
            pointer-events: auto; background: rgba(0,0,0,0.8); color: #0F0; border: 2px solid #0F0;
            padding: 15px 30px; font-size: 18px; cursor: pointer; 
            font-family: 'Black Ops One', cursive; letter-spacing: 2px;
            box-shadow: 0 0 15px #0F0, inset 0 0 10px #0F0; transition: 0.3s;
            animation: pulse 2s infinite; border-radius: 5px;
            text-shadow: 0 0 5px #0F0; text-transform: uppercase;
        }
        .cyber-btn:hover { background: #0F0; color: #000; box-shadow: 0 0 40px #0F0; }

        /* --- 3D CUBE COUNTDOWN --- */
        #cube-container { display: none; perspective: 800px; width: 150px; height: 150px; margin-bottom: 20px;}
        #cube { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; animation: spin 4s infinite linear; }
        .face {
            position: absolute; width: 146px; height: 146px;
            border: 2px solid #0F0; background: rgba(0, 255, 0, 0.15);
            color: #0F0; font-size: 80px; display: flex;
            justify-content: center; align-items: center;
            font-family: 'Black Ops One'; box-shadow: 0 0 15px #0F0;
            backface-visibility: visible;
        }
        .front { transform: translateZ(75px); } .back { transform: rotateY(180deg) translateZ(75px); }
        .right { transform: rotateY(90deg) translateZ(75px); } .left { transform: rotateY(-90deg) translateZ(75px); }
        .top { transform: rotateX(90deg) translateZ(75px); } .bottom { transform: rotateX(-90deg) translateZ(75px); }

        /* --- MESSAGE LAYER (Th∆∞ ch√∫c m·ª´ng) --- */
        #msg-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, rgba(20, 0, 10, 0.95) 0%, rgba(0, 0, 0, 0.98) 100%); 
            display: none; z-index: 3000; opacity: 0;
            flex-direction: column; justify-content: center; align-items: center;
            padding: 20px; box-sizing: border-box; transition: opacity 1.5s ease-in-out;
        }
        #msg-layer.visible { opacity: 1; }

        #msg-content {
            color: #FF69B4; font-size: clamp(17px, 5vw, 22px); 
            line-height: 1.6; font-family: 'Dancing Script', cursive; font-weight: bold;
            white-space: pre-wrap; word-wrap: break-word; /* Fix l·ªói xu·ªëng d√≤ng mobile */
            width: 90%; max-width: 600px; max-height: 60vh; overflow-y: auto;
            text-shadow: 0 0 5px #FF69B4; border-left: 3px solid #FF69B4; padding: 20px; 
            background: rgba(30, 0, 15, 0.7); border-radius: 10px; border: 1px solid rgba(255,105,180,0.3);
            box-shadow: 0 0 20px rgba(255, 20, 147, 0.2);
        }
        
        #skip-btn { 
            margin-top: 25px; padding: 12px 35px; border: 1px solid #FFD700; 
            background: transparent; color: #FFD700; display: none; pointer-events: auto; 
            font-weight: bold; cursor: pointer; transition: 0.3s; border-radius: 50px;
            font-family: 'Share Tech Mono'; letter-spacing: 1px;
            animation: pulse 2s infinite;
        }
        #skip-btn:hover { background: #FFD700; color: #000; box-shadow: 0 0 20px #FFD700; }

        /* --- HACKER TERMINAL --- */
        #virus-terminal { 
            position: absolute; top:0; left:0; width:100%; height:100%; color:#0F0; 
            font-family:'Share Tech Mono'; font-size:14px; display:none; z-index:2001; 
            background: rgba(0,0,0,0.95); padding:40px 20px; box-sizing:border-box; 
            line-height: 1.4; text-shadow: 0 0 5px #0F0;
            overflow-y: auto; white-space: pre-wrap;
        }
        #virus-terminal::-webkit-scrollbar { width: 5px; }
        #virus-terminal::-webkit-scrollbar-thumb { background: #0F0; }

        /* --- TRANSITION OVERLAY (M√†n h√¨nh chuy·ªÉn trang) --- */
        #transition-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #FFF; z-index: 9999; display: none; opacity: 0;
            flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 2s ease-in-out; pointer-events: none;
        }
        #transition-overlay.active { opacity: 1; pointer-events: auto; }

        .heart-loader { font-size: 60px; animation: heartbeat 1s infinite; margin-bottom: 20px;}
        .final-text { color: #FF1493; font-family: 'Dancing Script', cursive; font-size: 26px; font-weight: bold; }

        @keyframes spin { from { transform: rotateX(0) rotateY(0); } to { transform: rotateX(360deg) rotateY(360deg); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        @keyframes heartbeat { 0% { transform: scale(1); } 25% { transform: scale(1.3); } 50% { transform: scale(1); } 75% { transform: scale(1.3); } 100% { transform: scale(1); } }
    </style>
</head>
<body>
    <canvas id="c"></canvas>
    <div id="virus-terminal"></div>
    
    <div id="ui-layer">
        <button id="btn-start" class="cyber-btn">K√çCH HO·∫†T H·ªÜ TH·ªêNG</button>
        <div id="cube-container">
            <div id="cube">
                <div class="face front">10</div><div class="face back">10</div>
                <div class="face right">10</div><div class="face left">10</div>
                <div class="face top">10</div><div class="face bottom">10</div>
            </div>
        </div>
    </div>

    <div id="msg-layer">
        <div style="color: #FFD700; font-size: clamp(28px, 8vw, 40px); margin-bottom: 20px; font-family: 'Dancing Script'; text-align:center; text-shadow: 0 0 10px #FFD700;">üíå G·ª≠i D∆∞∆°ng</div>
        <div id="msg-content"></div>
        <button id="skip-btn" onclick="startFinale()">TI·∫æP T·ª§C >></button>
    </div>

    <div id="transition-overlay">
        <div class="heart-loader">‚ù§Ô∏è</div>
        <div class="final-text">ƒê·ª£i t·ªõ m·ªôt ch√∫t...</div>
    </div>

    <audio id="audio" src="https://nguyenbacson.io.vn/miss-you-happy-birthday.mp3" loop></audio>

<script>
    // --- N·ªòI DUNG TH∆Ø ---
    const LETTER = `Ch√∫c m·ª´ng sinh nh·∫≠t tu·ªïi 19, c√¥ g√°i H√† Nam xinh ƒë·∫πp! üéÇ

Ch√∫c c√¥ sinh vi√™n ƒê·∫°i h·ªçc Ph∆∞∆°ng ƒê√¥ng sang tu·ªïi m·ªõi h·ªçc t·∫≠p th·∫≠t t·ªët, lu√¥n vui v·∫ª v√† b·ªõt suy nghƒ© linh tinh nh√©.

D√π c√≥ b·∫≠n deadline th√¨ c≈©ng nh·ªõ ƒÉn u·ªëng ƒë·∫ßy ƒë·ªß (ƒë·∫∑c bi·ªát l√† ƒëi ƒÉn nem n∆∞·ªõng cho ƒë·ª° th√®m nha). üç¢

Mong r·∫±ng m·ªçi ƒëi·ªÅu t·ªët ƒë·∫πp nh·∫•t s·∫Ω ƒë·∫øn v·ªõi c·∫≠u. Happy Birthday, my special girl! ‚ù§Ô∏è

-- Nguy·ªÖn B·∫Øc S∆°n --`;

    const SCRIPT = [
        { t: "K·∫æT N·ªêI V·ªÜ TINH\nQU√âT D·ªÆ LI·ªÜU...", c: "#0FF" },
        { t: "T√åM TH·∫§Y M·ª§C TI√äU\nTR∆Ø∆†NG TH·ªä D∆Ø∆†NG", c: "#0F0" },
        { t: "CH√ÄO C√î G√ÅI\nƒêH PH∆Ø∆†NG ƒê√îNG", c: "#FF69B4" },
        { t: "HAPPY BIRTHDAY\nSINH NH·∫¨T TU·ªîI 19", c: "#FFD700" },
        { action: "HEART_TREND" } 
    ];

    const TERMINAL_LOGS = [
        "> INITIALIZING_SYSTEM_KERNEL...",
        "> ACCESSING_GLOBAL_DATABASE... [SUCCESS]",
        "> SEARCH_QUERY: 'TRUONG_THI_DUONG'",
        "> DOB_DETECTED: 01/03/2007",
        "> ORIGIN_POINT: HA_NAM",
        "> CURRENT_STATUS: STUDENT @ PHUONG_DONG_UNI",
        "> ANALYZING_FAVORITES...",
        "> DETECTED_FOOD: 'NEM_NUONG' (MATCH 100%)",
        "> [..........................] 0%",
        "> [|||||||...................] 30%",
        "> [||||||||||||||||..........] 65%",
        "> [||||||||||||||||||||||||||] 100%",
        "> DATA_LOADED: CUTE_LEVEL = INFINITY",
        "> DECRYPTING_GIFT_FILE: 'LOVE_FOR_DUONG.EXE'",
        "> ACTIVATING_STARDUST_PROTOCOL...",
        "> SYNCING_MUSIC_BEATS...",
        "> SYSTEM_READY.",
        "> COUNTDOWN_TO_PARTY...",
        "> 3...",
        "> 2...",
        "> 1...",
        "> EXECUTE_BIRTHDAY_SHOW_NOW!"
    ];

    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');
    const isMobile = window.innerWidth < 768;
    let w, h;

    const DOT_GAP = isMobile ? 4 : 3; 
    const DOT_SIZE = isMobile ? 1.5 : 1.2; 
    let state = "IDLE"; 
    
    let particles = [], fireworks = [], sparkles = [], spotlights = [], bgStars = [], shootingStars = [];
    let scriptIdx = 0, countdown = 10;

    function resize() {
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
        
        spotlights = [];
        let spotCount = isMobile ? 4 : 6;
        for(let i=0; i<spotCount; i++) {
            spotlights.push({
                x: (w / (spotCount-1)) * i,
                angle: -Math.PI/2,
                baseAngle: -Math.PI/2 + (Math.random()-0.5) * 0.4,
                speed: 0.005 + Math.random() * 0.01,
                width: 0.01, 
                range: 0.15, 
                color: `hsla(${Math.random()*40 + 200}, 100%, 80%, 0.05)` 
            });
        }

        bgStars = [];
        let starCount = isMobile ? 80 : 200;
        for(let i=0; i<starCount; i++) {
            bgStars.push({
                x: Math.random() * w,
                y: Math.random() * h,
                size: Math.random() * 1.5,
                opacity: Math.random(),
                blinkSpeed: 0.005 + Math.random() * 0.02
            });
        }
    }
    window.addEventListener('resize', resize);
    resize();

    // --- CLASS SAO BƒÇNG ---
    class ShootingStar {
        constructor() {
            this.angle = Math.PI / 4; 
            this.size = Math.random() * 1 + 1.5;
            this.speed = Math.random() * 2 + 4; 
            this.len = Math.random() * 80 + 100; 
            this.active = true;
            if (Math.random() < 0.5) {
                this.x = Math.random() * w; this.y = -this.len;
            } else {
                this.x = -this.len; this.y = Math.random() * h * 0.5;
            }
        }
        update() {
            this.x += this.speed * Math.cos(this.angle);
            this.y += this.speed * Math.sin(this.angle);
            if (this.x > w + this.len || this.y > h + this.len) this.active = false;
        }
        draw() {
            let tailX = this.x - this.len * Math.cos(this.angle);
            let tailY = this.y - this.len * Math.sin(this.angle);
            let grad = ctx.createLinearGradient(this.x, this.y, tailX, tailY);
            grad.addColorStop(0, "white"); grad.addColorStop(1, "transparent");
            ctx.beginPath(); ctx.strokeStyle = grad; ctx.lineWidth = 2; ctx.moveTo(this.x, this.y); ctx.lineTo(tailX, tailY); ctx.stroke();
            ctx.beginPath(); ctx.fillStyle = "white"; ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill();
        }
    }

    // --- BUTTON START ---
    document.getElementById('btn-start').onclick = function() {
        this.style.display = 'none';
        document.getElementById('audio').play().catch(()=>{});
        state = "COUNTDOWN";
        document.getElementById('cube-container').style.display = 'block';
        const faces = document.querySelectorAll('.face');
        let tmr = setInterval(() => {
            countdown--;
            faces.forEach(f => f.innerText = countdown);
            if(countdown <= 0) {
                clearInterval(tmr);
                document.getElementById('cube-container').style.display = 'none';
                runVirus();
            }
        }, 1000);
    };

    function runVirus() {
        state = "VIRUS";
        const term = document.getElementById('virus-terminal');
        term.style.display = 'block';
        let lineIdx = 0, charIdx = 0, currentText = "";
        
        function typeLine() {
            if(lineIdx >= TERMINAL_LOGS.length) {
                setTimeout(() => {
                    term.style.display = 'none';
                    state = "SHOW";
                    nextScene();
                }, 1000);
                return;
            }
            let line = TERMINAL_LOGS[lineIdx];
            term.innerHTML = currentText + line.substring(0, charIdx) + "<span style='color:#fff; animation:blink 0.5s infinite'>_</span>";
            if(charIdx < line.length) {
                charIdx++; setTimeout(typeLine, Math.random() * 20 + 5); 
            } else {
                currentText += line + "<br>"; lineIdx++; charIdx = 0; term.scrollTop = term.scrollHeight;
                setTimeout(typeLine, line.includes('[') ? 100 : 300); 
            }
        }
        typeLine();
    }

    function nextScene() {
        if(scriptIdx >= SCRIPT.length) return;
        let s = SCRIPT[scriptIdx++];
        if(s.action === "HEART_TREND") { runHeartTrend(); return; }
        formText(s.t, s.c);
        setTimeout(nextScene, 6000); 
    }

    function formText(txt, color) {
        const lines = txt.split('\n');
        const tmp = document.createElement('canvas');
        const tCtx = tmp.getContext('2d');
        let fSize = isMobile ? 50 : 80;
        tCtx.font = `bold ${fSize}px Arial`;
        let maxW = 0;
        lines.forEach(l => maxW = Math.max(maxW, tCtx.measureText(l).width));
        tmp.width = maxW + 40; tmp.height = lines.length * fSize * 1.5;
        tCtx.font = `bold ${fSize}px Arial`; tCtx.fillStyle = 'white'; tCtx.textAlign = 'center'; tCtx.textBaseline = 'middle';
        lines.forEach((l, i) => tCtx.fillText(l, tmp.width/2, fSize + i * fSize * 1.2));
        
        const data = tCtx.getImageData(0,0, tmp.width, tmp.height).data;
        let pts = [];
        for(let y=0; y<tmp.height; y+=DOT_GAP) {
            for(let x=0; x<tmp.width; x+=DOT_GAP) {
                if(data[(y*tmp.width + x)*4 + 3] > 128) pts.push({x: (w - tmp.width)/2 + x, y: (h - tmp.height)/2 + y});
            }
        }
        while(particles.length < pts.length) particles.push({x: Math.random()*w, y: Math.random()*h, tx: Math.random()*w, ty: Math.random()*h, c: color, active: true});
        particles.forEach((p, i) => {
            if(i < pts.length) { p.tx = pts[i].x; p.ty = pts[i].y; p.c = color; p.active = true; } 
            else { p.active = false; p.tx = Math.random()*w; p.ty = Math.random()*h; }
        });
    }

    function drawDynamicBackground() {
        bgStars.forEach(s => {
            s.opacity += s.blinkSpeed;
            if(s.opacity > 1 || s.opacity < 0.2) s.blinkSpeed *= -1;
            ctx.fillStyle = `rgba(255, 255, 255, ${s.opacity})`;
            ctx.beginPath(); ctx.arc(s.x, s.y, s.size, 0, Math.PI*2); ctx.fill();
        });
        if(Math.random() < 0.02) shootingStars.push(new ShootingStar());
        for(let i = shootingStars.length - 1; i >= 0; i--) {
            let s = shootingStars[i]; s.update(); s.draw();
            if(!s.active) shootingStars.splice(i, 1);
        }
    }

    function runHeartTrend() {
        state = "HEART_TREND";
        let heartPts = [];
        let r = isMobile ? 12 : 18;
        for(let t=0; t<Math.PI*2; t+=0.04) {
            heartPts.push({
                x: w/2 + r * 16 * Math.pow(Math.sin(t), 3),
                y: h/2 - r * (13 * Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t))
            });
        }
        particles.forEach((p, i) => {
            if(i < heartPts.length) { p.tx = heartPts[i].x; p.ty = heartPts[i].y; p.c = "#FF1493"; p.active = true; } 
            else { p.active = false; }
        });
        setTimeout(runMessage, 8000);
    }

    function runMessage() {
        state = "MSG";
        const layer = document.getElementById('msg-layer');
        layer.style.display = 'flex';
        setTimeout(() => layer.classList.add('visible'), 50);
        let i = 0;
        let t = setInterval(() => {
            document.getElementById('msg-content').innerText = LETTER.substring(0, i) + "_";
            if(++i > LETTER.length) { 
                clearInterval(t); 
                document.getElementById('skip-btn').style.display = 'block'; 
                document.getElementById('msg-content').innerText = LETTER; // X√≥a d·∫•u _ cu·ªëi c√πng
            }
        }, 40);
    }

    // --- FINALE & TRANSITION LOGIC ---
    window.startFinale = function() {
        state = "FINALE";
        document.getElementById('msg-layer').style.display = 'none';
        
        let fireworkInterval = setInterval(() => { if(fireworks.length < 8) launchFirework(); }, 500);
        formText("TU·ªîI 19\nR·ª∞C R·ª† NH√â!", "#FFD700");

        // Sau 5 gi√¢y b·∫Øn ph√°o hoa th√¨ chuy·ªÉn trang
        setTimeout(() => {
            clearInterval(fireworkInterval);
            goToConfession();
        }, 5000); 
    }

    function goToConfession() {
        // H√∫t c√°c h·∫°t v·ªÅ t√¢m
        particles.forEach(p => { p.tx = w/2; p.ty = h/2; });

        // Hi·ªán overlay chuy·ªÉn c·∫£nh
        const overlay = document.getElementById('transition-overlay');
        overlay.style.display = 'flex';
        
        setTimeout(() => {
            overlay.classList.add('active'); // Fade-in m√†u tr·∫Øng
        }, 100);

        // Chuy·ªÉn link sau 2.5 gi√¢y
        setTimeout(() => {
            window.location.href = "https://nguyenbacson.io.vn/miss-you/i-love-you/";
        }, 2500);
    }

    function launchFirework() {
        fireworks.push({x: Math.random()*w, y: h, ty: Math.random()*h*0.5, vy: -8 - Math.random()*5, c: `hsl(${Math.random()*360},100%,75%)`});
    }

    function loop() {
        ctx.fillStyle = "rgba(0, 5, 15, 0.2)"; 
        ctx.fillRect(0,0,w,h);
        drawDynamicBackground();

        if(state !== "MSG" && state !== "FINALE") {
            ctx.save(); ctx.globalCompositeOperation = 'lighter';
            spotlights.forEach(s => {
                s.angle = s.baseAngle + Math.sin(Date.now() * 0.0005 * 50) * s.range;
                let len = h * 1.5; let ex = s.x + Math.cos(s.angle) * len; let ey = h + Math.sin(s.angle) * len;
                let g = ctx.createLinearGradient(s.x, h, ex, ey); g.addColorStop(0, s.color); g.addColorStop(0.25, "transparent"); 
                ctx.fillStyle = g; ctx.beginPath(); ctx.moveTo(s.x, h); ctx.lineTo(ex - len * s.width, ey); ctx.lineTo(ex + len * s.width, ey); ctx.fill();
            });
            ctx.restore();
        }

        particles.forEach(p => {
            p.x += (p.tx - p.x) * 0.08; p.y += (p.ty - p.y) * 0.08;
            if(p.active || state === "HEART_TREND") {
                ctx.fillStyle = p.c; ctx.beginPath(); ctx.arc(p.x, p.y, DOT_SIZE, 0, Math.PI*2); ctx.fill();
            }
        });

        for(let i=fireworks.length-1; i>=0; i--) {
            let f = fireworks[i]; f.y += f.vy; f.vy += 0.15;
            ctx.fillStyle = f.c; ctx.fillRect(f.x, f.y, 3, 3);
            if(f.vy >= 0) {
                for(let j=0; j<40; j++) sparkles.push({x: f.x, y: f.y, vx: (Math.random()-0.5)*6, vy: (Math.random()-0.5)*6, c: f.c, l: 1});
                fireworks.splice(i,1);
            }
        }

        for(let i=sparkles.length-1; i>=0; i--) {
            let s = sparkles[i]; s.x += s.vx; s.y += s.vy; s.l -= 0.02;
            if(s.l <= 0) sparkles.splice(i,1);
            else { ctx.fillStyle = s.c; ctx.globalAlpha = s.l; ctx.fillRect(s.x, s.y, 2, 2); ctx.globalAlpha = 1; }
        }
        requestAnimationFrame(loop);
    }
    loop();
</script>
</body>
</html>
