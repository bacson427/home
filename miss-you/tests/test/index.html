<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SYSTEM_OVERRIDE_V11</title>
    <style>
        /* Font ch·ªØ Hacker */
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
        
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Share Tech Mono', monospace; }
        
        canvas { display: block; position: absolute; top: 0; left: 0; z-index: 1; }

        /* UI Layer - Lu√¥n n·∫±m tr√™n c√πng */
        #ui-layer {
            position: absolute; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            flex-direction: column; z-index: 999; 
            pointer-events: none; /* ƒê·ªÉ click xuy√™n qua n·∫øu c·∫ßn */
        }

        /* N√∫t b·∫•m */
        .cyber-btn {
            pointer-events: auto; background: #000; 
            color: #0F0; border: 2px solid #0F0;
            padding: 20px 50px; font-size: 20px; cursor: pointer; 
            font-family: 'Share Tech Mono', monospace; letter-spacing: 2px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.4);
            transition: 0.3s; z-index: 1000;
        }
        .cyber-btn:hover { background: #0F0; color: #000; box-shadow: 0 0 50px #0F0; }

        /* M√†n h√¨nh Boot (Loading Bar) */
        #boot-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; display: none; 
            flex-direction: column; justify-content: center; align-items: center;
            z-index: 900;
        }
        
        #progress-container {
            width: 80%; max-width: 400px; height: 30px;
            border: 2px solid #0F0; padding: 3px;
            box-shadow: 0 0 15px #0F0; margin-top: 20px;
        }
        
        #progress-bar {
            width: 0%; height: 100%; background: #0F0;
            transition: width 0.1s linear;
        }

        #boot-text { color: #0F0; font-size: 18px; text-shadow: 0 0 5px #0F0; }
        #hex-code { color: rgba(0, 255, 0, 0.5); font-size: 12px; margin-top: 10px; height: 20px; }

        /* M√†n t√¢m th∆∞ */
        #letter-box {
            position: absolute; width: 85%; max-width: 600px;
            background: rgba(0, 10, 0, 0.95); border: 1px solid #0F0;
            padding: 20px; display: none; 
            box-shadow: 0 0 30px #0F0; z-index: 800;
        }
        #letter-content { color: #0F0; font-size: 16px; line-height: 1.6; text-align: justify; }

    </style>
</head>
<body>
    <canvas id="mainCanvas"></canvas>
    
    <div id="ui-layer">
        <button id="start-btn" class="cyber-btn">K√çCH HO·∫†T H·ªÜ TH·ªêNG</button>
        
        <div id="letter-box">
            <div id="letter-content"></div>
        </div>
    </div>

    <div id="boot-screen">
        <div id="boot-text">INITIALIZING... 0%</div>
        <div id="progress-container">
            <div id="progress-bar"></div>
        </div>
        <div id="hex-code">0x0000</div>
    </div>

    <audio id="bg-music" src="https://nguyenbacson.io.vn/miss-you-happy-birthday.mp3" loop crossorigin="anonymous"></audio>

<script>
    // --- C·∫§U H√åNH ---
    const CONFIG = {
        SCENE_DURATION: 12000, // 12 gi√¢y m·ªói c·∫£nh
        BOOT_TIME: 10000 // 10 gi√¢y n·∫°p (Phase 1)
    };

    // K·ªãch b·∫£n hi·ªÉn th·ªã
    const SCRIPT = [
        { text: "ƒê·ªêI T∆Ø·ª¢NG:\nTR∆Ø∆†NG TH·ªä D∆Ø∆†NG", color: "#0F0" }, 
        { text: "NHI·ªÜM V·ª§:\nCH√öC M·ª™NG 2026", color: "#FFD700" }, 
        { text: "M√É L·ªÜNH:\nXU√ÇN B√çNH NG·ªå üê¥", color: "#00FFFF" }, 
        { text: "S·ª∞ KI·ªÜN 1:\nHAPPY VALENTINE", color: "#FF0055" }, 
        { text: "S·ª∞ KI·ªÜN 2:\nQU·ªêC T·∫æ PH·ª§ N·ªÆ", color: "#FFF" }, 
        { text: "S·ª∞ KI·ªÜN CH√çNH:\nSINH NH·∫¨T TU·ªîI 19", color: "#FFD700" },
        { text: "TR·∫†NG TH√ÅI:\nXINH ƒê·∫∏P R·∫†NG NG·ªúI", color: "#00FFFF" },
        { action: "LETTER" }
    ];

    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    let width, height;

    // Matrix Variables (Latin + Greek + Katakana mix)
    const CHARS = "ABCDEFGHIJKLMNOPQRSTUVWXYZŒ©Œ£ŒîŒ®Œ¶ŒûŒõŒ†ŒìŒò0123456789";
    let columns = [];
    let fontSize = 16;

    // State
    let state = "IDLE"; // IDLE, BOOT, SHOW, LETTER
    let drones = [];
    let scriptIdx = 0;

    function resize() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
        let cols = width / fontSize;
        columns = [];
        for(let i=0; i<cols; i++) columns[i] = 1;
    }
    window.addEventListener('resize', resize);
    resize();

    // --- KH·ªûI ƒê·ªòNG (S·ª¨A L·ªñI LOGIC) ---
    document.getElementById('start-btn').onclick = function() {
        this.style.display = 'none'; // ·∫®n n√∫t ngay l·∫≠p t·ª©c
        
        // Th·ª≠ ph√°t nh·∫°c (n·∫øu l·ªói th√¨ b·ªè qua, code v·∫´n ch·∫°y ti·∫øp)
        const audio = document.getElementById('bg-music');
        audio.play().catch(e => console.log("Audio autoplay blocked by browser"));
        
        // Ch·∫°y Phase 1 ngay l·∫≠p t·ª©c
        runBootSequence();
    };

    // --- PHASE 1: LOADING BAR ---
    function runBootSequence() {
        state = "BOOT";
        const bootScreen = document.getElementById('boot-screen');
        const bar = document.getElementById('progress-bar');
        const txt = document.getElementById('boot-text');
        const hex = document.getElementById('hex-code');
        
        bootScreen.style.display = 'flex';
        
        let progress = 0;
        let interval = setInterval(() => {
            progress += 1; // TƒÉng d·∫ßn 1%
            
            // C·∫≠p nh·∫≠t giao di·ªán
            bar.style.width = progress + "%";
            txt.innerText = `SYSTEM LOADING... ${progress}%`;
            
            // Hi·ªáu ·ª©ng m√£ Hex nh√°y lo·∫°n x·∫°
            hex.innerText = "0x" + Math.floor(Math.random()*16777215).toString(16).toUpperCase();

            if (progress >= 100) {
                clearInterval(interval);
                // K·∫øt th√∫c boot, v√†o show
                setTimeout(() => {
                    bootScreen.style.display = 'none';
                    startShow();
                }, 500);
            }
        }, CONFIG.BOOT_TIME / 100); // Chia th·ªùi gian ra 100 b∆∞·ªõc
    }

    // --- PHASE 2: SHOW ---
    function startShow() {
        state = "SHOW";
        nextScene();
    }

    function nextScene() {
        if(scriptIdx >= SCRIPT.length) return;
        
        let scene = SCRIPT[scriptIdx];
        scriptIdx++;

        if(scene.action === "LETTER") {
            setTimeout(showLetter, 1000);
            return;
        }

        formText(scene.text, scene.color);
        setTimeout(nextScene, CONFIG.SCENE_DURATION);
    }

    // --- TEXT TO DRONE LOGIC ---
    function formText(text, color) {
        const lines = text.split('\n');
        const offCv = document.createElement('canvas');
        const offCtx = offCv.getContext('2d');
        
        let fSize = width < 768 ? 50 : 100; // Font size v·ª´a ph·∫£i
        offCtx.font = `900 ${fSize}px "Share Tech Mono"`; 
        
        let maxW = 0;
        lines.forEach(l => {
            let m = offCtx.measureText(l);
            if(m.width > maxW) maxW = m.width;
        });
        
        offCv.width = maxW + 40;
        offCv.height = lines.length * fSize * 1.5;

        offCtx.font = `900 ${fSize}px "Share Tech Mono"`;
        offCtx.fillStyle = '#fff';
        offCtx.textAlign = 'center';
        offCtx.textBaseline = 'middle';
        
        let startY = fSize;
        lines.forEach((l, i) => {
            offCtx.fillText(l, offCv.width/2, startY + i * (fSize * 1.1));
        });

        // Scan pixels
        let points = [];
        let data = offCtx.getImageData(0,0, offCv.width, offCv.height).data;
        let step = width < 768 ? 4 : 3;
        
        // Scale to fit screen
        let scale = Math.min((width * 0.95) / offCv.width, (height * 0.6) / offCv.height);
        let startX = (width - offCv.width * scale) / 2;
        let startY = (height - offCv.height * scale) / 2;

        for(let y=0; y<offCv.height; y+=step) {
            for(let x=0; x<offCv.width; x+=step) {
                if(data[(y*offCv.width + x)*4 + 3] > 128) {
                    points.push({
                        x: startX + x * scale,
                        y: startY + y * scale
                    });
                }
            }
        }
        updateDrones(points, color);
    }

    function updateDrones(points, color) {
        points.sort(() => Math.random() - 0.5);

        if(drones.length < points.length) {
            let add = points.length - drones.length;
            for(let i=0; i<add; i++) {
                drones.push({
                    x: Math.random() * width, 
                    y: Math.random() * height, // Bay t·ª´ v·ªã tr√≠ ng·∫´u nhi√™n
                    tx: width/2, ty: height/2,
                    color: color, 
                    size: 2
                });
            }
        }

        drones.forEach((d, i) => {
            if(i < points.length) {
                d.tx = points[i].x;
                d.ty = points[i].y;
                d.color = color;
            } else {
                // Drone th·ª´a bay lo·∫°n x·∫° ki·ªÉu Matrix glitch
                d.tx = Math.random() * width;
                d.ty = Math.random() * height;
                d.color = "rgba(0, 255, 0, 0)"; // ·∫®n ƒëi
            }
        });
    }

    // --- MATRIX RAIN RENDER ---
    function drawMatrix() {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.05)'; // T·∫°o v·ªát m·ªù
        ctx.fillRect(0, 0, width, height);

        ctx.fillStyle = '#0F0';
        ctx.font = fontSize + 'px monospace';

        for(let i=0; i<columns.length; i++) {
            let char = CHARS[Math.floor(Math.random()*CHARS.length)];
            ctx.fillText(char, i*fontSize, columns[i]*fontSize);

            if(columns[i]*fontSize > height && Math.random() > 0.975) {
                columns[i] = 0;
            }
            columns[i]++;
        }
    }

    // --- T√ÇM TH∆Ø ---
    function showLetter() {
        state = "LETTER";
        const box = document.getElementById('letter-box');
        const content = document.getElementById('letter-content');
        box.style.display = 'block';
        
        let text = "G·ª¨I: TR∆Ø∆†NG TH·ªä D∆Ø∆†NG\n\n[SYSTEM MESSAGE]: Ch√∫c m·ª´ng sinh nh·∫≠t tu·ªïi 19! Ch√∫c c·∫≠u m·ªôt nƒÉm m·ªõi b√πng n·ªï, lu√¥n xinh ƒë·∫πp v√† th√†nh c√¥ng. C·∫£m ∆°n v√¨ ƒë√£ lu√¥n ·ªü b√™n c·∫°nh t·ªõ.\n\n[END OF TRANSMISSION]\n\nK√Ω t√™n: Nguy·ªÖn B·∫Øc S∆°n";
        
        let i = 0;
        let t = setInterval(() => {
            content.innerText = text.substring(0, i) + "_";
            i++;
            if(i > text.length) clearInterval(t);
        }, 50);
    }

    // --- ANIMATION LOOP ---
    function animate() {
        requestAnimationFrame(animate);

        // N·∫øu ƒëang boot th√¨ kh√¥ng v·∫Ω g√¨ tr√™n canvas (ƒë·ªÉ html lo)
        if(state === "BOOT") return;

        // V·∫Ω n·ªÅn Matrix
        drawMatrix();

        // V·∫Ω Drone (Ch·ªØ)
        if(state === "SHOW" || state === "LETTER") {
            drones.forEach(d => {
                // Di chuy·ªÉn m∆∞·ª£t
                d.x += (d.tx - d.x) * 0.08;
                d.y += (d.ty - d.y) * 0.08;
                
                ctx.fillStyle = d.color;
                ctx.fillRect(d.x, d.y, d.size, d.size);
            });
        }
    }
    
    animate();

</script>
</body>
</html>
