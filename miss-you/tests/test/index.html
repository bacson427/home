<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SON_V27_ULTIMATE_SMOOTH</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500&family=Dancing+Script:wght@700&family=Share+Tech+Mono&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: #000; overflow: hidden; 
            font-family: 'Share Tech Mono', monospace;
        }

        canvas { display: block; position: absolute; top: 0; left: 0; z-index: 1; }

        /* UI Layer */
        #ui-layer {
            position: absolute; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            z-index: 100; pointer-events: none;
        }

        /* N√∫t b·∫•m phong c√°ch Cyberpunk Neon */
        .neon-btn {
            pointer-events: auto;
            background: rgba(0, 20, 0, 0.6);
            color: #0F0;
            border: 1px solid #0F0;
            padding: 18px 40px;
            font-size: 18px;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 2px;
            text-transform: uppercase;
            cursor: pointer;
            border-radius: 4px;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(5px);
        }

        .neon-btn::before {
            content: ''; position: absolute; top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 0, 0.2), transparent);
            transition: 0.5s;
        }

        .neon-btn:hover {
            background: #0F0; color: #000;
            box-shadow: 0 0 30px #0F0, 0 0 60px #0F0;
            transform: scale(1.05);
        }
        .neon-btn:hover::before { left: 100%; }

        /* Cube 3D */
        #cube-container { 
            display: none; width: 120px; height: 120px; 
            perspective: 800px; margin-bottom: 30px; 
        }
        #cube {
            width: 100%; height: 100%; position: relative;
            transform-style: preserve-3d;
            animation: rotateCube 5s infinite linear;
        }
        .face {
            position: absolute; width: 116px; height: 116px;
            border: 1px solid rgba(0, 255, 0, 0.8);
            background: rgba(0, 255, 0, 0.05);
            color: #0F0; font-size: 60px;
            display: flex; justify-content: center; align-items: center;
            font-family: 'Orbitron';
            box-shadow: inset 0 0 20px rgba(0, 255, 0, 0.2);
            backface-visibility: visible;
        }
        .f-front { transform: translateZ(60px); }
        .f-back { transform: rotateY(180deg) translateZ(60px); }
        .f-right { transform: rotateY(90deg) translateZ(60px); }
        .f-left { transform: rotateY(-90deg) translateZ(60px); }
        .f-top { transform: rotateX(90deg) translateZ(60px); }
        .f-bottom { transform: rotateX(-90deg) translateZ(60px); }

        @keyframes rotateCube {
            0% { transform: rotateX(0deg) rotateY(0deg); }
            100% { transform: rotateX(360deg) rotateY(360deg); }
        }

        /* Message Box Effect */
        #msg-layer {
            position: absolute; inset: 0;
            background: radial-gradient(circle, rgba(10,0,5,0.9) 0%, rgba(0,0,0,0.98) 100%);
            display: none; z-index: 200;
            flex-direction: column; justify-content: center; align-items: center;
            opacity: 0; transition: opacity 1.5s ease;
        }
        #msg-layer.show { opacity: 1; }

        #msg-box {
            width: 85%; max-width: 550px;
            padding: 30px;
            background: rgba(20, 20, 20, 0.6);
            border: 1px solid rgba(255, 105, 180, 0.3);
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(255, 20, 147, 0.15);
            backdrop-filter: blur(10px);
            transform: translateY(20px);
            transition: transform 1s ease;
        }
        #msg-layer.show #msg-box { transform: translateY(0); }

        #letter-content {
            color: #FFB7C5; font-family: 'Dancing Script', cursive;
            font-size: clamp(18px, 5vw, 24px); line-height: 1.6;
            text-shadow: 0 0 5px rgba(255, 105, 180, 0.5);
            white-space: pre-wrap;
            min-height: 100px;
        }

        #skip-btn {
            margin-top: 25px; padding: 10px 30px;
            background: transparent; border: 1px solid #FFD700;
            color: #FFD700; border-radius: 25px;
            font-family: 'Share Tech Mono'; font-weight: bold;
            cursor: pointer; opacity: 0; transition: 0.5s;
            pointer-events: none;
        }
        #skip-btn.active { opacity: 1; pointer-events: auto; }
        #skip-btn:hover { background: rgba(255, 215, 0, 0.1); box-shadow: 0 0 15px #FFD700; }

        /* Virus Terminal */
        #terminal {
            position: absolute; inset: 0; background: #000;
            color: #F00; font-family: 'Share Tech Mono'; padding: 20px;
            font-size: 14px; z-index: 50; display: none;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>

    <div id="terminal"></div>

    <div id="ui-layer">
        <div id="cube-container">
            <div id="cube">
                <div class="face f-front">10</div><div class="face f-back">10</div>
                <div class="face f-right">10</div><div class="face f-left">10</div>
                <div class="face f-top">10</div><div class="face f-bottom">10</div>
            </div>
        </div>
        <button id="start-btn" class="neon-btn">KH·ªûI ƒê·ªòNG H·ªÜ TH·ªêNG</button>
    </div>

    <div id="msg-layer">
        <div id="msg-box">
            <div style="text-align:center; color: #FFD700; font-family: 'Dancing Script'; font-size: 32px; margin-bottom: 15px;">üíå G·ª≠i D∆∞∆°ng</div>
            <div id="letter-content"></div>
        </div>
        <button id="skip-btn" onclick="endMessage()">TI·∫æP T·ª§C >></button>
    </div>

    <audio id="bg-music" src="https://nguyenbacson.io.vn/miss-you-happy-birthday.mp3" loop></audio>

<script>
    /* --- CONFIGURATION --- */
    const CONFIG = {
        particleCount: window.innerWidth < 768 ? 900 : 2500, // T·ª± ƒë·ªông gi·∫£m h·∫°t tr√™n mobile
        particleSpeed: 0.08, // T·ªëc ƒë·ªô bay v·ªÅ (Physics damping)
        colors: {
            primary: '#0F0',
            gold: '#FFD700',
            heart: '#FF1493',
            blue: '#00FFFF'
        }
    };

    const LETTER_TEXT = `D∆∞∆°ng ∆°i, h√¥m nay 01/03/2026, c·∫≠u tr√≤n 19 tu·ªïi.

T·ªõ ch√∫c c·∫≠u tu·ªïi m·ªõi lu√¥n xinh ƒë·∫πp r·∫°ng ng·ªùi, h·ªçc t·∫≠p th·∫≠t gi·ªèi v√† s·ªõm ƒë·∫°t ƒë∆∞·ª£c m·ªçi ∆∞·ªõc m∆°.

C·∫£m ∆°n c·∫≠u ƒë√£ ƒë·∫øn v√† l√†m cho th·∫ø gi·ªõi c·ªßa t·ªõ th√™m ƒë·∫∑c bi·ªát. Xin l·ªói v√¨ nh·ªØng l√∫c tr·∫ª con ƒë√£ l√†m c·∫≠u bu·ªìn. Mong c·∫≠u lu√¥n gi·ªØ n·ª• c∆∞·ªùi tr√™n m√¥i nh√©!

Happy Birthday, my special girl! ‚ù§Ô∏è

-- Nguy·ªÖn B·∫Øc S∆°n --`;

    const SCENES = [
        { text: "G·ª¨I ƒê·∫æN\nTR∆Ø∆†NG TH·ªä D∆Ø∆†NG", color: "#0F0", time: 6000 },
        { text: "CH√öC M·ª™NG\nNƒÇM M·ªöI 2026", color: "#FFD700", time: 6000 },
        { text: "TU·ªîI 19\nR·ª∞C R·ª† NH√â", color: "#00FFFF", time: 6000 },
        { mode: "HEART" }
    ];

    /* --- INIT --- */
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let width, height;
    
    let particles = [];
    let fireworks = [];
    let sparkles = [];
    let spotlights = [];
    let state = "IDLE"; // IDLE, COUNTDOWN, VIRUS, SCENE, HEART, MSG, FINALE
    let sceneIndex = 0;
    let countdownVal = 10;

    // Resize handling
    function resize() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
        initSpotlights();
    }
    window.addEventListener('resize', resize);
    resize();

    /* --- SPOTLIGHTS (ATMOSPHERIC) --- */
    function initSpotlights() {
        spotlights = [];
        const count = window.innerWidth < 768 ? 4 : 7;
        for (let i = 0; i < count; i++) {
            spotlights.push({
                x: (width / count) * i + (width/count)/2,
                angle: -Math.PI / 2,
                targetAngle: -Math.PI / 2 + (Math.random() - 0.5),
                width: 0.1 + Math.random() * 0.1,
                speed: 0.002 + Math.random() * 0.003,
                color: `hsla(${200 + Math.random()*50}, 80%, 60%, 0.08)`
            });
        }
    }

    function drawSpotlights() {
        ctx.globalCompositeOperation = 'lighter'; // Key for beauty
        spotlights.forEach(s => {
            // Smooth movement
            s.angle += Math.sin(Date.now() * s.speed) * 0.002;
            
            const len = height * 1.2;
            const ex = s.x + Math.cos(s.angle) * len;
            const ey = height + Math.sin(s.angle) * len;

            const grad = ctx.createLinearGradient(s.x, height, ex, ey);
            grad.addColorStop(0, s.color);
            grad.addColorStop(0.5, s.color.replace('0.08', '0.02'));
            grad.addColorStop(1, 'transparent');

            ctx.fillStyle = grad;
            ctx.beginPath();
            ctx.moveTo(s.x, height);
            ctx.lineTo(ex - len * s.width, ey);
            ctx.lineTo(ex + len * s.width, ey);
            ctx.fill();
        });
        ctx.globalCompositeOperation = 'source-over';
    }

    /* --- PARTICLE ENGINE --- */
    class Particle {
        constructor(x, y) {
            this.x = Math.random() * width;
            this.y = Math.random() * height;
            this.tx = x; // Target X
            this.ty = y; // Target Y
            this.vx = 0; // Velocity
            this.vy = 0;
            this.color = '#FFF';
            this.size = Math.random() * 2 + 1;
            this.friction = 0.94; // Smooth stop
            this.ease = 0.05 + Math.random() * 0.05; // Random responsiveness
            this.drift = Math.random() * 0.5; // Idle floating
            this.alpha = 1;
        }

        update(isHeartMode) {
            // Physics based movement to target
            const dx = this.tx - this.x;
            const dy = this.ty - this.y;
            
            this.vx += dx * this.ease * 0.1;
            this.vy += dy * this.ease * 0.1;
            
            // Apply friction
            this.vx *= this.friction;
            this.vy *= this.friction;

            // Add organic drift (floating effect)
            if (Math.abs(dx) < 1 && Math.abs(dy) < 1) {
                this.x += Math.sin(Date.now() * 0.002 + this.drift) * 0.3;
                this.y += Math.cos(Date.now() * 0.003 + this.drift) * 0.3;
            } else {
                this.x += this.vx;
                this.y += this.vy;
            }

            // Heart beat effect
            if (isHeartMode) {
                const beat = 1 + Math.sin(Date.now() * 0.01) * 0.05;
                const cx = width/2;
                const cy = height/2;
                this.x = cx + (this.x - cx) * beat;
                this.y = cy + (this.y - cy) * beat;
            }
        }

        draw() {
            ctx.globalAlpha = this.alpha;
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fill();
        }
    }

    /* --- TEXT & SHAPE GENERATION --- */
    function getPointsFromText(text, color) {
        const offCanvas = document.createElement('canvas');
        const offCtx = offCanvas.getContext('2d');
        offCanvas.width = width;
        offCanvas.height = height;
        
        const fontSize = window.innerWidth < 768 ? 50 : 100;
        offCtx.font = `900 ${fontSize}px 'Arial'`;
        offCtx.fillStyle = '#FFF';
        offCtx.textAlign = 'center';
        offCtx.textBaseline = 'middle';
        
        const lines = text.split('\n');
        const lineHeight = fontSize * 1.2;
        const totalHeight = lines.length * lineHeight;
        const startY = (height - totalHeight) / 2 + lineHeight/2;

        lines.forEach((line, i) => {
            offCtx.fillText(line, width / 2, startY + i * lineHeight);
        });

        const data = offCtx.getImageData(0, 0, width, height).data;
        const points = [];
        const gap = window.innerWidth < 768 ? 4 : 5; // ƒê·ªô ph√¢n gi·∫£i ƒëi·ªÉm

        for (let y = 0; y < height; y += gap) {
            for (let x = 0; x < width; x += gap) {
                if (data[(y * width + x) * 4 + 3] > 128) {
                    points.push({x, y, c: color});
                }
            }
        }
        return points;
    }

    function getHeartPoints() {
        const points = [];
        const r = Math.min(width, height) * 0.025; // Scale heart
        const totalPoints = CONFIG.particleCount * 0.6;
        
        for (let i = 0; i < totalPoints; i++) {
            const t = (i / totalPoints) * Math.PI * 2;
            const x = 16 * Math.pow(Math.sin(t), 3);
            const y = -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t));
            
            // Random fill inside heart
            const scale = Math.random() > 0.3 ? 1 : Math.random(); 
            
            points.push({
                x: width / 2 + (x * r * scale),
                y: height / 2 + (y * r * scale),
                c: CONFIG.colors.heart
            });
        }
        return points;
    }

    function morphTo(points) {
        // Shuffle particles for cool effect
        particles.sort(() => Math.random() - 0.5);
        points.sort(() => Math.random() - 0.5);

        // Add or remove particles
        if (particles.length < points.length) {
            const needed = points.length - particles.length;
            for(let i=0; i<needed; i++) particles.push(new Particle(width/2, height/2));
        } else {
            particles.splice(points.length);
        }

        // Assign targets
        particles.forEach((p, i) => {
            p.tx = points[i].x;
            p.ty = points[i].y;
            p.color = points[i].c;
        });
    }

    /* --- GAME LOOP CONTROL --- */
    document.getElementById('start-btn').onclick = () => {
        document.getElementById('start-btn').style.display = 'none';
        document.getElementById('bg-music').play().catch(()=>{});
        state = "COUNTDOWN";
        document.getElementById('cube-container').style.display = 'block';
        runCountdown();
    };

    function runCountdown() {
        const faces = document.querySelectorAll('.face');
        const timer = setInterval(() => {
            countdownVal--;
            faces.forEach(f => f.innerText = countdownVal);
            if (countdownVal <= 0) {
                clearInterval(timer);
                document.getElementById('cube-container').style.display = 'none';
                runVirus();
            }
        }, 1000);
    }

    function runVirus() {
        state = "VIRUS";
        const term = document.getElementById('terminal');
        term.style.display = 'block';
        let log = "";
        let p = 0;
        const vTimer = setInterval(() => {
            log += `> SYSTEM OVERRIDE... ${p}%\n`;
            if (Math.random() > 0.7) log += `> BYPASSING FIREWALL... SUCCESS\n`;
            term.innerText = log;
            term.scrollTop = term.scrollHeight;
            p += 2;
            if (p > 100) {
                clearInterval(vTimer);
                term.style.display = 'none';
                state = "SCENE";
                nextScene();
            }
        }, 50);
    }

    function nextScene() {
        if (sceneIndex >= SCENES.length) return;
        
        const scene = SCENES[sceneIndex];
        if (scene.mode === "HEART") {
            state = "HEART";
            morphTo(getHeartPoints());
            setTimeout(showMessage, 8000);
        } else {
            morphTo(getPointsFromText(scene.text, scene.color));
            setTimeout(nextScene, scene.time);
            sceneIndex++;
        }
    }

    function showMessage() {
        state = "MSG";
        const layer = document.getElementById('msg-layer');
        layer.style.display = 'flex';
        // Force reflow
        void layer.offsetWidth;
        layer.classList.add('show');

        // Typewriter effect
        const content = document.getElementById('letter-content');
        let i = 0;
        const typeTimer = setInterval(() => {
            content.innerText = LETTER_TEXT.substring(0, i) + "|";
            i++;
            if (i > LETTER_TEXT.length) {
                clearInterval(typeTimer);
                content.innerText = LETTER_TEXT;
                document.getElementById('skip-btn').classList.add('active');
            }
        }, 30);
    }

    window.endMessage = function() {
        document.getElementById('msg-layer').classList.remove('show');
        setTimeout(() => {
            document.getElementById('msg-layer').style.display = 'none';
            startFinale();
        }, 1000);
    }

    function startFinale() {
        state = "FINALE";
        morphTo(getPointsFromText("HAPPY\nBIRTHDAY", "#FFD700"));
        
        setInterval(() => {
            // Fireworks loop
            fireworks.push({
                x: Math.random() * width,
                y: height,
                vx: (Math.random() - 0.5) * 4,
                vy: -(Math.random() * 5 + 10),
                color: `hsl(${Math.random()*360}, 100%, 70%)`,
                exploded: false
            });
        }, 800);
    }

    /* --- ANIMATION LOOP --- */
    function loop() {
        // Clear screen with trail effect (smoothness)
        ctx.fillStyle = "rgba(0, 0, 0, 0.15)";
        ctx.fillRect(0, 0, width, height);

        if (state === "SCENE" || state === "HEART" || state === "FINALE") {
            drawSpotlights();
            
            // Set blending for glow effect
            ctx.globalCompositeOperation = 'lighter';
            particles.forEach(p => {
                p.update(state === "HEART");
                p.draw();
            });
            ctx.globalCompositeOperation = 'source-over';
        }

        if (state === "FINALE") {
            updateFireworks();
        }

        requestAnimationFrame(loop);
    }

    function updateFireworks() {
        for (let i = fireworks.length - 1; i >= 0; i--) {
            let f = fireworks[i];
            if (!f.exploded) {
                f.x += f.vx;
                f.y += f.vy;
                f.vy += 0.2; // Gravity
                
                ctx.fillStyle = f.color;
                ctx.fillRect(f.x, f.y, 3, 3);

                if (f.vy >= 0) {
                    f.exploded = true;
                    // Explosion
                    for (let j = 0; j < 40; j++) {
                        sparkles.push({
                            x: f.x, y: f.y,
                            vx: Math.cos(j/20 * Math.PI) * Math.random() * 6,
                            vy: Math.sin(j/20 * Math.PI) * Math.random() * 6,
                            color: f.color,
                            alpha: 1
                        });
                    }
                }
            } else {
                fireworks.splice(i, 1);
            }
        }

        for (let i = sparkles.length - 1; i >= 0; i--) {
            let s = sparkles[i];
            s.x += s.vx;
            s.y += s.vy;
            s.vy += 0.1;
            s.alpha -= 0.02;
            
            ctx.globalAlpha = s.alpha;
            ctx.fillStyle = s.color;
            ctx.fillRect(s.x, s.y, 2, 2);
            ctx.globalAlpha = 1;

            if (s.alpha <= 0) sparkles.splice(i, 1);
        }
    }

    loop();
</script>
</body>
</html>
