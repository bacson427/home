<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Màn Trình Diễn Dành Tặng Cậu</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #050510; }
        canvas { display: block; }
        #message {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: #ff4d6d;
            font-family: 'Arial', sans-serif;
            font-size: 2em;
            opacity: 0;
            transition: opacity 2s;
            text-align: center;
            pointer-events: none; /* Để không che canvas */
        }
        .show-message { opacity: 1 !important; }
    </style>
</head>
<body>
    <canvas id="droneCanvas"></canvas>
    <div id="message">
        <div>Kỷ niệm của chúng ta...</div>
        <div style="font-size: 0.6em; color: #fff;">(Nhìn lên bầu trời này nhé)</div>
    </div>

    <script>
        const canvas = document.getElementById('droneCanvas');
        const ctx = canvas.getContext('2d');
        const msgDiv = document.getElementById('message');

        let width, height;
        let drones = [];
        const numDrones = 400; // Số lượng "drone"
        let targetShape = 'chaos'; // Trạng thái hiện tại
        let animationSpeed = 0.05; // Tốc độ di chuyển về vị trí

        // Cấu hình "Drone"
        class Drone {
            constructor() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.targetX = this.x;
                this.targetY = this.y;
                this.color = `hsl(${Math.random() * 60 + 180}, 100%, 70%)`; // Màu xanh/tím
                this.size = Math.random() * 2 + 1;
            }

            update() {
                // Thuật toán di chuyển mượt mà về đích (Easing)
                const dx = this.targetX - this.x;
                const dy = this.targetY - this.y;
                this.x += dx * animationSpeed;
                this.y += dy * animationSpeed;
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                // Hiệu ứng phát sáng nhẹ
                ctx.shadowBlur = 10;
                ctx.shadowColor = this.color;
            }
        }

        function init() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            drones = [];
            for (let i = 0; i < numDrones; i++) {
                drones.push(new Drone());
            }
            
            // Bắt đầu kịch bản
            setTimeout(() => { formShape('starbucks'); }, 3000); // Sau 3s xếp hình cốc
            setTimeout(() => { formShape('heart'); }, 10000); // Sau 10s xếp hình tim
            setTimeout(() => { msgDiv.classList.add('show-message'); }, 12000); // Hiện thông báo
        }

        // --- ĐỊNH NGHĨA CÁC HÌNH DẠNG (TỌA ĐỘ) ---
        function getShapeCoordinates(shapeType) {
            let coords = [];
            const centerX = width / 2;
            const centerY = height / 2;
            
            if (shapeType === 'chaos') {
                for (let i = 0; i < numDrones; i++) {
                    coords.push({x: Math.random() * width, y: Math.random() * height});
                }
            } 
            // --- HÌNH TRÁI TIM ---
            else if (shapeType === 'heart') {
                 for (let i = 0; i < numDrones; i++) {
                    let t = (i / numDrones) * Math.PI * 2;
                    let r = Math.min(width, height) * 0.015; // Bán kính nền
                    // Công thức toán học hình trái tim
                    let x = 16 * Math.pow(Math.sin(t), 3);
                    let y = -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
                    coords.push({
                        x: centerX + x * r * 15 + (Math.random()-0.5)*20, // Thêm chút ngẫu nhiên cho tự nhiên
                        y: centerY + y * r * 15 + (Math.random()-0.5)*20,
                        color: '#ff4d6d' // Đổi màu sang hồng
                    });
                }
            }
            // --- GIẢ LẬP HÌNH CỐC STARBUCKS (Đơn giản hóa) ---
            else if (shapeType === 'starbucks') {
                const scale = Math.min(width, height) * 0.002;
                for (let i = 0; i < numDrones; i++) {
                    let x, y, color;
                    // Tạo hình thang làm thân cốc (khoảng 70% số drone)
                    if (i < numDrones * 0.7) {
                        let p = i / (numDrones * 0.7); // Tiến trình từ 0 -> 1
                        let cupHeight = 200 * scale;
                        let topWidth = 150 * scale;
                        let bottomWidth = 100 * scale;
                        
                        y = centerY - cupHeight/2 + p * cupHeight;
                        // Chiều rộng tại độ cao y hiện tại (nội suy tuyến tính)
                        let currentWidth = topWidth - (p * (topWidth - bottomWidth));
                        // Phân bố hạt sang 2 bên cạnh cốc
                        x = centerX + (Math.random() > 0.5 ? 1 : -1) * (currentWidth/2 - Math.random()*5);
                        color = '#00704A'; // Màu xanh Starbucks
                    } 
                    // Tạo nắp và ống hút (30% còn lại)
                    else {
                         x = centerX + (Math.random() - 0.5) * 160 * scale;
                         y = centerY - 110 * scale + (Math.random() * 20 * scale);
                         color = '#ffffff'; // Màu trắng nắp
                         if (i > numDrones * 0.95) { // Ống hút
                             x = centerX + 30 * scale;
                             y = centerY - 150 * scale - Math.random() * 50;
                             color = 'orange';
                         }
                    }

                    coords.push({
                        x: x + (Math.random()-0.5)*10, 
                        y: y + (Math.random()-0.5)*10,
                        color: color
                    });
                }
            }
            return coords;
        }

        // Hàm điều phối việc chuyển hình
        function formShape(shape) {
            targetShape = shape;
            const targets = getShapeCoordinates(shape);
            
            // Gán mục tiêu mới cho từng drone
            for (let i = 0; i < numDrones; i++) {
                if (targets[i]) {
                    drones[i].targetX = targets[i].x;
                    drones[i].targetY = targets[i].y;
                    if (targets[i].color) drones[i].color = targets[i].color;
                }
            }
        }

        function animate() {
            ctx.fillStyle = 'rgba(5, 5, 16, 0.2)'; // Tạo hiệu ứng đuôi mờ (motion trail)
            ctx.fillRect(0, 0, width, height);

            drones.forEach(drone => {
                drone.update();
                drone.draw();
            });

            requestAnimationFrame(animate);
        }

        window.addEventListener('resize', () => {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            formShape(targetShape); // Giữ nguyên hình dạng khi resize
        });

        init();
        animate();
    </script>
</body>
</html>
