<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chuc Mung Sinh Nhat Duong</title>
    <style>
        /* --- CẤU HÌNH GIAO DIỆN CHUNG --- */
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Arial', sans-serif;
            color: white;
        }

        /* Nền tối luân chuyển màu (Dynamic Dark Background) */
        .dynamic-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #020024, #090979, #1c0021, #000000);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            z-index: -2;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Canvas cho hiệu ứng */
        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        /* Container chứa nội dung tương tác */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            pointer-events: none; /* Để click xuyên qua canvas khi cần */
        }

        /* Các nút bấm (Interactive Buttons) */
        .btn {
            pointer-events: auto;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #00f2ff;
            color: #00f2ff;
            padding: 15px 40px;
            font-size: 20px;
            border-radius: 30px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.3s;
            box-shadow: 0 0 15px #00f2ff;
            backdrop-filter: blur(5px);
            display: none; /* Mặc định ẩn */
            animation: pulse 2s infinite;
        }

        .btn:hover {
            background: #00f2ff;
            color: #000;
            transform: scale(1.1);
        }

        /* Đồng hồ đếm ngược */
        #countdown {
            font-size: 80px;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 20px #ff00de;
            display: none;
            z-index: 20;
        }

        /* Youtube Ẩn */
        #hidden-player {
            position: absolute;
            width: 1px;
            height: 1px;
            opacity: 0;
            top: -1000px;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 242, 255, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(0, 242, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 242, 255, 0); }
        }
        
        /* Loading text */
        .info-text {
            margin-top: 20px;
            font-size: 14px;
            color: #aaa;
            opacity: 0;
            transition: opacity 1s;
        }
    </style>
</head>
<body>

    <div class="dynamic-bg"></div>
    
    <canvas id="canvas"></canvas>

    <div id="ui-layer">
        <div id="countdown"></div>
        
        <button id="btn-start" class="btn" style="display: block;">Khởi động hệ thống</button>
        
        <button id="btn-phase2" class="btn">Kết nối vệ tinh</button>
        
        <button id="btn-phase3" class="btn">Kích hoạt sự kiện</button>

        <div id="status-text" class="info-text">Đang tải dữ liệu...</div>
    </div>

    <div id="hidden-player">
        <iframe id="youtube-frame" width="560" height="315" src="https://www.youtube.com/embed/Og25tNifNSs?enablejsapi=1" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
    </div>

    <script>
        /* --- CẤU HÌNH --- */
        const TARGET_NAME = "Trương Thị Dương";
        const BIRTHDAY_DATE = "01/03/2007";
        
        /* --- KHỞI TẠO CANVAS --- */
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let particles = [];
        let fireworks = [];
        let texts = [];
        let animationId;
        let timer = 0;
        let stage = 0; // 0: Start, 1: Fireworks, 2: Wait/Connect, 3: Countdown, 4: Drone Show

        // Xử lý resize
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        /* --- LỚP PHÁO HOA (FIREWORKS) --- */
        class Firework {
            constructor(x, y, targetX, targetY, color) {
                this.x = x;
                this.y = y;
                this.targetX = targetX;
                this.targetY = targetY;
                this.color = color;
                this.speed = 3;
                this.angle = Math.atan2(targetY - y, targetX - x);
                this.velocity = {
                    x: Math.cos(this.angle) * this.speed,
                    y: Math.sin(this.angle) * this.speed
                };
                this.explode = false;
                this.particles = [];
            }

            update() {
                if (!this.explode) {
                    this.x += this.velocity.x;
                    this.y += this.velocity.y;
                    
                    // Kiểm tra khoảng cách để nổ
                    const dist = Math.hypot(this.x - this.targetX, this.y - this.targetY);
                    if (dist < 10) {
                        this.explode = true;
                        this.createParticles();
                    }
                } else {
                    this.particles.forEach((p, index) => {
                        p.update();
                        if (p.alpha <= 0) this.particles.splice(index, 1);
                    });
                }
            }

            draw() {
                if (!this.explode) {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    ctx.fill();
                } else {
                    this.particles.forEach(p => p.draw());
                }
            }

            createParticles() {
                // Tạo hình trái tim hoặc tròn ngẫu nhiên
                const isHeart = Math.random() > 0.5;
                for (let i = 0; i < 50; i++) {
                    const p = new Particle(this.targetX, this.targetY, this.color, isHeart);
                    this.particles.push(p);
                }
            }
        }

        class Particle {
            constructor(x, y, color, isHeart) {
                this.x = x;
                this.y = y;
                this.color = color;
                const angle = Math.random() * Math.PI * 2;
                const velocity = Math.random() * 3;
                this.velocity = {
                    x: Math.cos(angle) * velocity,
                    y: Math.sin(angle) * velocity
                };
                if(isHeart) {
                    // Logic đơn giản hóa cho hình trái tim (chỉ mang tính tương đối)
                    // Để code ngắn gọn, ta dùng vật lý nổ tròn cơ bản nhưng chỉnh gravity
                }
                this.alpha = 1;
                this.friction = 0.98;
                this.gravity = 0.05;
            }

            update() {
                this.velocity.x *= this.friction;
                this.velocity.y *= this.friction;
                this.velocity.y += this.gravity;
                this.x += this.velocity.x;
                this.y += this.velocity.y;
                this.alpha -= 0.01;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.restore();
            }
        }

        /* --- LỚP DRONE (TEXT PARTICLES) --- */
        class Drone {
            constructor(effect, x, y, color) {
                this.effect = effect;
                // Vị trí bắt đầu (dưới đáy màn hình bay lên)
                this.x = Math.random() * canvas.width;
                this.y = canvas.height + Math.random() * 100;
                // Vị trí đích (tạo thành chữ)
                this.originX = x;
                this.originY = y;
                this.color = color;
                this.size = 2;
                this.dx = 0;
                this.dy = 0;
                this.vx = 0;
                this.vy = 0;
                this.force = 0;
                this.angle = 0;
                this.distance = 0;
                this.friction = 0.90; // Độ hãm
                this.ease = 0.08; // Độ mượt khi bay về vị trí
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }

            update() {
                this.dx = this.originX - this.x;
                this.dy = this.originY - this.y;
                this.distance = this.dx * this.dx + this.dy * this.dy;
                this.force = -this.distance / 10000; // Lực hút về đích

                if (this.distance < 1) {
                    // Đã về đích, rung nhẹ như drone
                    this.x += (Math.random() - 0.5) * 1; 
                    this.y += (Math.random() - 0.5) * 1;
                } else {
                    this.x += (this.dx * this.ease);
                    this.y += (this.dy * this.ease);
                }
            }
        }

        class Effect {
            constructor(width, height) {
                this.width = width;
                this.height = height;
                this.particles = [];
                this.gap = 4; // Độ phân giải của chữ (càng nhỏ càng nét nhưng nặng)
            }

            wrapText(text, x, y, maxWidth, lineHeight, color) {
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0.3, 'cyan');
                gradient.addColorStop(0.5, 'white');
                gradient.addColorStop(0.7, 'pink');
                
                ctx.font = 'bold 50px Arial';
                ctx.fillStyle = 'white';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                // Vẽ chữ lên canvas ẩn để lấy dữ liệu pixel
                ctx.fillText(text, x, y);
            }
            
            // Quét pixel và tạo drone
            init(line1, line2, line3) {
                this.particles = [];
                ctx.clearRect(0,0, this.width, this.height);
                
                // Vẽ cả 3 dòng chữ
                ctx.font = 'bold 40px Arial';
                ctx.fillStyle = 'white';
                ctx.textAlign = 'center';
                ctx.fillText(line1, this.width/2, this.height/2 - 60);
                ctx.fillText(line2, this.width/2, this.height/2);
                ctx.font = 'bold 50px Arial'; // Tên to hơn
                ctx.fillStyle = '#ff00de';
                ctx.fillText(line3, this.width/2, this.height/2 + 70);

                const pixels = ctx.getImageData(0, 0, this.width, this.height).data;
                
                // Xóa canvas sau khi quét
                ctx.clearRect(0,0, this.width, this.height);

                for (let y = 0; y < this.height; y += this.gap) {
                    for (let x = 0; x < this.width; x += this.gap) {
                        const index = (y * this.width + x) * 4;
                        const alpha = pixels[index + 3];
                        if (alpha > 0) {
                            // Màu dựa trên vị trí y để tạo gradient
                            const red = pixels[index];
                            const green = pixels[index + 1];
                            const blue = pixels[index + 2];
                            const color = `rgb(${red},${green},${blue})`;
                            
                            this.particles.push(new Drone(this, x, y, color));
                        }
                    }
                }
            }

            render() {
                this.particles.forEach(particle => {
                    particle.update();
                    particle.draw();
                });
            }
        }

        const droneEffect = new Effect(canvas.width, canvas.height);

        /* --- XỬ LÝ SỰ KIỆN NÚT BẤM (LOGIC CHÍNH) --- */
        const btnStart = document.getElementById('btn-start');
        const btnPhase2 = document.getElementById('btn-phase2');
        const btnPhase3 = document.getElementById('btn-phase3');
        const statusText = document.getElementById('status-text');
        const countdownEl = document.getElementById('countdown');
        const youtubeFrame = document.getElementById('youtube-frame');

        // BƯỚC 1: START
        btnStart.addEventListener('click', () => {
            btnStart.style.display = 'none';
            statusText.style.opacity = 1;
            statusText.innerText = "Đang kích hoạt hệ thống âm thanh & pháo hoa...";
            
            // Hack để chạy iframe Youtube (thêm ?autoplay=1 vào src)
            youtubeFrame.src += "&autoplay=1";
            
            stage = 1; // Bắt đầu bắn pháo hoa
            
            // Sau 10 giây hiện nút tiếp theo
            setTimeout(() => {
                statusText.innerText = "Hệ thống đã sẵn sàng kết nối.";
                btnPhase2.style.display = 'block';
            }, 10000);
        });

        // BƯỚC 2: CHUYỂN GIAO
        btnPhase2.addEventListener('click', () => {
            btnPhase2.style.display = 'none';
            statusText.innerText = "Đang quét không gian 3D...";
            
            // Giả lập loading 2 giây cho cảm giác nguy hiểm
            setTimeout(() => {
                statusText.innerText = "Xác nhận đối tượng: " + TARGET_NAME;
                btnPhase3.style.display = 'block';
            }, 2000);
        });

        // BƯỚC 3: ĐẾM NGƯỢC
        btnPhase3.addEventListener('click', () => {
            btnPhase3.style.display = 'none';
            statusText.style.display = 'none';
            stage = 3; // Chuyển sang mode đếm ngược
            
            let count = 10;
            countdownEl.style.display = 'block';
            countdownEl.innerText = count;
            
            const countInterval = setInterval(() => {
                count--;
                countdownEl.innerText = count;
                // Tạo hiệu ứng nổ nhẹ mỗi giây
                fireworks.push(new Firework(Math.random()*canvas.width, canvas.height, canvas.width/2, canvas.height/2, `hsl(${Math.random()*360}, 50%, 50%)`));
                
                if(count < 0) {
                    clearInterval(countInterval);
                    countdownEl.style.display = 'none';
                    stage = 4; // CHUYỂN SANG DRONE SHOW
                    droneEffect.init("CHÚC MỪNG NĂM MỚI", "CHÚC MỪNG SINH NHẬT", TARGET_NAME);
                }
            }, 1000);
        });


        /* --- VÒNG LẶP ANIMATION --- */
        function animate() {
            // Hiệu ứng mờ dần để tạo vệt đuôi (trail effect) cho pháo hoa
            if (stage === 4) {
                // Ở chế độ Drone thì xóa sạch để chữ nét
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            } else {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }

            // Xử lý Pháo hoa (Giai đoạn 1 & 3)
            if (stage === 1 || stage === 3) {
                if (Math.random() < 0.05) { // Tần suất bắn
                    const x = Math.random() * canvas.width;
                    const targetX = Math.random() * canvas.width;
                    const targetY = Math.random() * (canvas.height / 2);
                    const color = `hsl(${Math.random() * 360}, 50%, 50%)`;
                    fireworks.push(new Firework(x, canvas.height, targetX, targetY, color));
                }
            }
            
            // Vẽ pháo hoa
            fireworks.forEach((fw, index) => {
                fw.update();
                fw.draw();
                if (fw.explode && fw.particles.length === 0) {
                    fireworks.splice(index, 1);
                }
            });

            // Xử lý Drone Show (Giai đoạn 4)
            if (stage === 4) {
                droneEffect.render();
                
                // Thêm hoa rơi/tim rơi nhẹ nền
                if(Math.random() < 0.1) {
                   // Code logic hoa rơi đơn giản ở đây nếu cần, 
                   // nhưng hiện tại Drone show đã khá nặng nên giữ đơn giản
                }
            }

            requestAnimationFrame(animate);
        }

        animate();

    </script>
</body>
</html>
