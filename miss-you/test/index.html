<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chúc Mừng Sinh Nhật & Năm Mới</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Montserrat:wght@400;800&display=swap');

        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Montserrat', sans-serif;
            color: white;
        }

        /* Hiệu ứng nền tối luân chuyển */
        .dynamic-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #050505, #1a0b1a, #0b0f1a, #000000);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            z-index: -1;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
        }

        /* Giao diện UI */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            pointer-events: none; /* Để click xuyên qua canvas */
            z-index: 10;
        }

        .btn {
            pointer-events: auto;
            background: transparent;
            color: #fff;
            border: 2px solid #fff;
            padding: 15px 40px;
            font-size: 20px;
            text-transform: uppercase;
            cursor: pointer;
            border-radius: 50px;
            transition: 0.3s;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
            font-family: 'Montserrat', sans-serif;
            letter-spacing: 2px;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            margin-top: 20px;
            display: none; /* Ẩn mặc định */
        }

        .btn:hover {
            background: #fff;
            color: #000;
            box-shadow: 0 0 30px #fff, 0 0 60px #ff00de;
            border-color: transparent;
        }

        #start-btn { display: block; } /* Hiện nút Start đầu tiên */

        #countdown-display {
            font-size: 120px;
            font-weight: 800;
            text-shadow: 0 0 20px #ff00de;
            display: none;
            animation: zoomPulse 1s infinite;
        }

        @keyframes zoomPulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* YouTube ẩn */
        #hidden-youtube {
            position: absolute;
            width: 1px;
            height: 1px;
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <div class="dynamic-bg"></div>
    <canvas id="fireworksCanvas"></canvas>
    
    <div id="ui-layer">
        <button id="start-btn" class="btn">BẮT ĐẦU BUỔI TIỆC</button>
        <div id="countdown-display">10</div>
        <button id="next-phase-btn" class="btn">TIẾP TỤC KHÁM PHÁ</button>
        <button id="final-btn" class="btn">KÍCH HOẠT DRONE SHOW</button>
    </div>

    <div id="hidden-youtube">
        <div id="player"></div>
    </div>

    <script>
        // --- CẤU HÌNH ---
        const NAME = "Trương Thị Dương";
        const BIRTHDAY = "01/03/2007";
        
        // --- YOUTUBE API ---
        var player;
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '315',
                width: '560',
                videoId: 'Og25tNifNSs', // ID video của bạn
                playerVars: {
                    'playsinline': 1,
                    'controls': 0,
                    'loop': 1
                },
                events: {
                    'onReady': onPlayerReady
                }
            });
        }
        function onPlayerReady(event) {
            // Video sẵn sàng
        }
        // Load YouTube Script
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        // --- CORE LOGIC ---
        const canvas = document.getElementById('fireworksCanvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        
        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // State Machine
        let state = "IDLE"; // IDLE, FIREWORKS, WAITING_1, COUNTDOWN, WAITING_2, DRONE_SHOW
        let particles = [];
        let droneParticles = [];
        
        // UI Elements
        const startBtn = document.getElementById('start-btn');
        const nextBtn = document.getElementById('next-phase-btn');
        const finalBtn = document.getElementById('final-btn');
        const countdownDisplay = document.getElementById('countdown-display');

        // --- BUTTON EVENTS ---
        startBtn.addEventListener('click', () => {
            startBtn.style.display = 'none';
            if(player) player.playVideo();
            startFireworks();
        });

        nextBtn.addEventListener('click', () => {
            nextBtn.style.display = 'none';
            startCountdown();
        });

        finalBtn.addEventListener('click', () => {
            finalBtn.style.display = 'none';
            startDroneShow();
        });

        // --- PHASE 1: FIREWORKS ---
        function startFireworks() {
            state = "FIREWORKS";
            let startTime = Date.now();
            
            // Loop pháo hoa
            const fwLoop = setInterval(() => {
                if (Date.now() - startTime > 10000) { // 10 giây
                    clearInterval(fwLoop);
                    state = "WAITING_1";
                    nextBtn.style.display = 'block'; // Hiện nút tiếp tục
                }
                createFirework();
            }, 800);
        }

        // --- PHASE 2: COUNTDOWN ---
        function startCountdown() {
            state = "COUNTDOWN";
            let count = 10;
            countdownDisplay.style.display = 'block';
            countdownDisplay.innerText = count;

            const timer = setInterval(() => {
                count--;
                createPolygonalFirework(); // Bắn pháo hoa hình thù trong lúc đếm
                if (count > 0) {
                    countdownDisplay.innerText = count;
                } else {
                    clearInterval(timer);
                    countdownDisplay.style.display = 'none';
                    state = "WAITING_2";
                    finalBtn.style.display = 'block'; // Hiện nút kích hoạt Drone
                }
            }, 1000);
        }

        // --- PHASE 3: DRONE SHOW (PARTICLE TEXT) ---
        function startDroneShow() {
            state = "DRONE_SHOW";
            initDrones(); // Tạo các hạt drone
            
            // Kịch bản Drone
            setTimeout(() => formText("CHÚC MỪNG"), 1000);
            setTimeout(() => formText("NĂM MỚI 2026"), 5000); // 4s sau
            setTimeout(() => formShape("HEART"), 10000);
            setTimeout(() => formText("CHÚC MỪNG"), 15000);
            setTimeout(() => formText("SINH NHẬT"), 19000);
            setTimeout(() => formText(BIRTHDAY), 23000);
            setTimeout(() => formShape("STAR"), 28000);
            setTimeout(() => formText(NAME), 33000); // Tên nhân vật chính
            
            // Sau khi hiện tên, cho flycam bay tự do đẹp mắt
            setTimeout(() => { 
                state = "FREESTYLE"; 
            }, 45000);
        }

        // --- GRAPHICS & PHYSICS ---

        class Firework {
            constructor(x, y, color, type = "normal") {
                this.x = x;
                this.y = height;
                this.targetY = y;
                this.color = color;
                this.speed = 8; // Tăng tốc độ bay lên
                this.exploded = false;
                this.particles = [];
                this.type = type; // normal, heart, circle
            }

            update() {
                if (!this.exploded) {
                    this.y -= this.speed;
                    if (this.y <= this.targetY) {
                        this.explode();
                    }
                } else {
                    this.particles.forEach((p, i) => {
                        p.update();
                        if (p.alpha <= 0) this.particles.splice(i, 1);
                    });
                }
            }

            draw() {
                if (!this.exploded) {
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
                    ctx.fill();
                } else {
                    this.particles.forEach(p => p.draw());
                }
            }

            explode() {
                this.exploded = true;
                let count = 100;
                if(this.type === "heart") count = 150;
                
                for (let i = 0; i < count; i++) {
                    let angle, speed;
                    if (this.type === "normal") {
                        angle = Math.random() * Math.PI * 2;
                        speed = Math.random() * 5 + 1;
                        this.particles.push(new Particle(this.x, this.y, this.color, angle, speed));
                    } else if (this.type === "circle") {
                         angle = (Math.PI * 2 / count) * i;
                         speed = 4;
                         this.particles.push(new Particle(this.x, this.y, this.color, angle, speed));
                    } else if (this.type === "heart") {
                        // Công thức trái tim
                        let a = (Math.PI * 2 / count) * i;
                        let r = 3; 
                        // x = 16sin^3(t), y = 13cos(t) - 5cos(2t) - 2cos(3t) - cos(4t)
                        let dx = 16 * Math.pow(Math.sin(a), 3);
                        let dy = -(13 * Math.cos(a) - 5 * Math.cos(2 * a) - 2 * Math.cos(3 * a) - Math.cos(4 * a));
                        
                        // Chuẩn hóa vector velocity
                        let mag = Math.sqrt(dx*dx + dy*dy);
                        let vx = (dx/mag) * 3; // Tốc độ nổ
                        let vy = (dy/mag) * 3;
                        
                        this.particles.push(new Particle(this.x, this.y, this.color, 0, 0, vx, vy));
                    }
                }
            }
        }

        class Particle {
            constructor(x, y, color, angle, speed, vx = null, vy = null) {
                this.x = x;
                this.y = y;
                this.color = color;
                if (vx !== null) {
                    this.vx = vx;
                    this.vy = vy;
                } else {
                    this.vx = Math.cos(angle) * speed;
                    this.vy = Math.sin(angle) * speed;
                }
                this.alpha = 1;
                this.gravity = 0.05;
                this.decay = 0.015;
            }

            update() {
                this.vx *= 0.96; // Air resistance
                this.vy *= 0.96;
                this.vy += this.gravity;
                this.x += this.vx;
                this.y += this.vy;
                this.alpha -= this.decay;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }

        // --- DRONE PARTICLE SYSTEM ---
        class Drone {
            constructor() {
                this.x = Math.random() * width;
                this.y = height + Math.random() * 200; // Bắt đầu từ dưới màn hình
                this.tx = Math.random() * width; // Target X
                this.ty = Math.random() * height; // Target Y
                this.color = `hsl(${Math.random()*360}, 100%, 50%)`;
                this.size = 2;
                this.speed = Math.random() * 0.05 + 0.02; // Tốc độ di chuyển (lerp factor)
            }

            update() {
                // Di chuyển mượt mà tới đích (Linear Interpolation)
                this.x += (this.tx - this.x) * this.speed;
                this.y += (this.ty - this.y) * this.speed;
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.shadowBlur = 10;
                ctx.shadowColor = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI*2);
                ctx.fill();
                ctx.shadowBlur = 0;
            }
        }

        function initDrones() {
            // Tạo 1500 drone
            for(let i=0; i<1500; i++) {
                droneParticles.push(new Drone());
            }
        }

        // Hàm tạo chữ/hình từ Drone
        function formText(text) {
            // Dùng 1 canvas ẩn để vẽ chữ, sau đó lấy toạ độ pixel
            const offCanvas = document.createElement('canvas');
            offCanvas.width = width;
            offCanvas.height = height;
            const offCtx = offCanvas.getContext('2d');
            
            offCtx.fillStyle = '#fff';
            offCtx.font = 'bold 80px Montserrat';
            offCtx.textAlign = 'center';
            offCtx.textBaseline = 'middle';
            offCtx.fillText(text, width/2, height/2);

            let imageData = offCtx.getImageData(0, 0, width, height).data;
            let pixels = [];
            
            // Lấy mẫu pixel (bước nhảy 4 hoặc 5 để giảm tải)
            for(let y=0; y<height; y+=6) {
                for(let x=0; x<width; x+=6) {
                    let index = (y * width + x) * 4;
                    if(imageData[index+3] > 128) { // Nếu pixel có màu (độ trong suốt > 50%)
                        pixels.push({x: x, y: y});
                    }
                }
            }

            // Gán mục tiêu cho các drone
            droneParticles.forEach((d, i) => {
                if (i < pixels.length) {
                    d.tx = pixels[i].x;
                    d.ty = pixels[i].y;
                    d.color = `hsl(${Math.random()*60 + 30}, 100%, 60%)`; // Màu vàng/cam ấm áp
                    d.speed = 0.03 + Math.random()*0.02; // Random tốc độ để trông tự nhiên
                } else {
                    // Drone thừa thì bay xung quanh trang trí
                    d.tx = Math.random() * width;
                    d.ty = Math.random() * height;
                    d.color = '#333'; // Làm tối đi
                }
            });
        }

        function formShape(shape) {
             droneParticles.forEach((d, i) => {
                 let angle, r;
                 if (shape === "HEART") {
                    // Hình trái tim
                    let t = (i / droneParticles.length) * Math.PI * 2;
                    let scale = 15;
                    // Công thức tim
                    let x = 16 * Math.pow(Math.sin(t), 3);
                    let y = -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
                    d.tx = width/2 + x * scale;
                    d.ty = height/2 + y * scale;
                    d.color = '#ff0055';
                 } else if (shape === "STAR") {
                    // Hình sao đơn giản
                     // Code đơn giản hoá: cho về vòng tròn xoay
                     let t = (i / droneParticles.length) * Math.PI * 2 * 5; // 5 cánh
                     let r = 200 * Math.cos(2*t); // Hoa văn
                     d.tx = width/2 + Math.cos(t) * (r+100);
                     d.ty = height/2 + Math.sin(t) * (r+100);
                     d.color = '#00ffff';
                 }
                 d.speed = 0.04;
             });
        }


        // --- HELPERS ---
        function createFirework() {
            let x = Math.random() * width;
            let y = Math.random() * (height/2);
            let colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00de'];
            let color = colors[Math.floor(Math.random() * colors.length)];
            particles.push(new Firework(x, y, color));
        }

        function createPolygonalFirework() {
            let x = Math.random() * width;
            let y = Math.random() * (height/2);
            let types = ["circle", "heart"];
            let type = types[Math.floor(Math.random() * types.length)];
            let color = type === "heart" ? "#ff0055" : "#00ffff";
            particles.push(new Firework(x, y, color, type));
        }

        // --- MAIN LOOP ---
        function animate() {
            requestAnimationFrame(animate);
            
            // Xóa canvas với hiệu ứng mờ (trail effect)
            ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
            ctx.fillRect(0, 0, width, height);

            // Xử lý Pháo hoa
            if (state === "FIREWORKS" || state === "COUNTDOWN" || state === "WAITING_1") {
                particles.forEach((p, i) => {
                    p.update();
                    p.draw();
                    if (p.exploded && p.particles.length === 0) {
                        particles.splice(i, 1);
                    }
                });
            }

            // Xử lý Drone Show
            if (state === "DRONE_SHOW" || state === "FREESTYLE") {
                 // Hiệu ứng xoay nhẹ camera 3D giả lập
                 if(state === "DRONE_SHOW") {
                     // Có thể thêm code xoay toàn bộ context nếu muốn
                 }
                 
                 droneParticles.forEach(d => {
                     // Nếu chế độ Freestyle, drone bay lượn lờ
                     if (state === "FREESTYLE") {
                         d.tx += (Math.random() - 0.5) * 10;
                         d.ty += (Math.random() - 0.5) * 10;
                     }
                     d.update();
                     d.draw();
                 });
            }
        }
        
        animate();

    </script>
</body>
</html>
