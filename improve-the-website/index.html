<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang Ý Kiến Người Dùng - Bảo Vệ Dữ Liệu</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css">
    <style>
        /* CSS sẽ được thêm ở phần 2 */
    </style>
</head>
<body>
<div class="last-updated">
        <strong>Lần cập nhật cuối cùng:</strong> 02h03, ngày 24 tháng 10 năm 2025, GMT+7
    </div>
    <div class="container">
        <header>
            <div class="privacy-badge">
                <i class="fas fa-shield-alt"></i> Bảo vệ dữ liệu
            </div>
            <h1>Trang Ý Kiến Người Dùng</h1>
            <p class="subtitle">Chia sẻ ý kiến, đánh giá và góp ý của bạn về website. Dữ liệu của bạn được bảo vệ an toàn. Để đảm bảo cho dữ liệu của người góp ý, đánh giá,... chúng tôi sẽ xoá dữ liệu, thông tin góp ý của bạn trong 1 khoảng thời gian ( thời gian không cố định ). Bảo mật của bạn đặt nên hàng đầu.</p>
        </header>
        
        <div class="content">
            <section class="form-section">
                <h2><i class="fas fa-pen"></i> Thêm Ý Kiến Của Bạn</h2>
                <form id="commentForm">
                    <div class="form-group">
                        <label for="name">Họ và tên:</label>
                        <input type="text" id="name" placeholder="Nhập họ tên của bạn" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" placeholder="Nhập email của bạn" required>
                    </div>

                    <div class="form-group">
                        <label for="phone">Số điện thoại (có mã vùng tự động):</label>
                        <input type="tel" id="phone" placeholder="Nhập số điện thoại của bạn">
                        <span id="valid-msg" class="hide">✓ Hợp lệ</span>
                        <span id="error-msg" class="hide"></span>
                        <div class="phone-info">
                            <small>Mã vùng sẽ tự động thay đổi theo quốc gia bạn chọn</small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="country">Quốc gia:</label>
                        <select id="country" required>
                            <option value="">Chọn quốc gia</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="state">Tỉnh/Thành phố:</label>
                        <select id="state" required>
                            <option value="">Chọn tỉnh/thành phố</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="category">Danh mục ý kiến:</label>
                        <select id="category" required>
                            <option value="">Chọn danh mục</option>
                            <option value="gop-y">Góp ý</option>
                            <option value="danh-gia">Đánh giá</option>
                            <option value="hoi-dap">Hỏi đáp</option>
                            <option value="khac">Khác</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="comment">Ý kiến của bạn:</label>
                        <textarea id="comment" placeholder="Chia sẻ ý kiến, đánh giá hoặc góp ý của bạn..." required></textarea>
                    </div>
                    
                    <div class="privacy-notice">
                        <h3><i class="fas fa-lock"></i> Cam kết bảo vệ dữ liệu</h3>
                        <p>Thông tin cá nhân của bạn sẽ được bảo vệ và chỉ sử dụng cho mục đích quản lý ý kiến. Chúng tôi không chia sẻ thông tin với bên thứ ba.</p>
                    </div>
                    
                    <button type="submit" class="btn">
                        <i class="fas fa-paper-plane"></i> Gửi Ý Kiến
                    </button>
                </form>
            </section>
            
            <section class="comments-section">
                <h2><i class="fas fa-comments"></i> Ý Kiến Từ Người Dùng</h2>
                
                <div class="comment-stats">
                    <div class="stat-box">
                        <div class="stat-number" id="totalComments">0</div>
                        <div class="stat-label">Tổng số ý kiến</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="todayComments">0</div>
                        <div class="stat-label">Ý kiến hôm nay</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="countryCount">0</div>
                        <div class="stat-label">Quốc gia</div>
                    </div>
                </div>
                
                <div class="filter-controls">
                    <select id="filterCategory">
                        <option value="">Tất cả danh mục</option>
                        <option value="gop-y">Góp ý</option>
                        <option value="danh-gia">Đánh giá</option>
                        <option value="hoi-dap">Hỏi đáp</option>
                        <option value="khac">Khác</option>
                    </select>
                    
                    <select id="filterCountry">
                        <option value="">Tất cả quốc gia</option>
                    </select>

                    <select id="sortComments">
                        <option value="newest">Mới nhất</option>
                        <option value="oldest">Cũ nhất</option>
                    </select>
                </div>
                
                <div id="commentsList">
                    <div class="no-comments">
                        <i class="fas fa-comment-slash"></i><br>
                        Chưa có ý kiến nào. Hãy là người đầu tiên chia sẻ!
                    </div>
                </div>
            </section>
        </div>
        
        <section class="admin-section">
            <h2><i class="fas fa-user-shield"></i> Khu vực Quản trị</h2>
            
            <div class="password-protected">
                <p><i class="fas fa-lock"></i> Khu vực này được bảo vệ bằng mật khẩu. Chỉ quản trị viên mới có thể truy cập.</p>
                <div class="form-group">
                    <label for="adminPassword">Mật khẩu quản trị:</label>
                    <input type="password" id="adminPassword" placeholder="Nhập mật khẩu quản trị">
                </div>
                <button id="adminLogin" class="btn">
                    <i class="fas fa-sign-in-alt"></i> Đăng nhập quản trị
                </button>
            </div>
            
            <div id="adminPanel" style="display: none;">
                <div class="admin-controls">
                    <button id="exportComments" class="btn btn-secondary">
                        <i class="fas fa-download"></i> Xuất dữ liệu
                    </button>
                    <button id="deleteAllComments" class="btn btn-danger">
                        <i class="fas fa-trash"></i> Xóa tất cả
                    </button>
                </div>
                
                <div class="admin-stats">
                    <h3>Thống kê dữ liệu</h3>
                    <div id="adminStats"></div>
                </div>
            </div>
        </section>
        
        <footer>
            <p><i class="fas fa-shield-alt"></i> © 2023 Trang Ý Kiến Người Dùng. Tất cả dữ liệu được bảo vệ theo chính sách riêng tư.</p>
        </footer>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
    <script>
        // JavaScript sẽ được thêm ở phần tiếp theo
    </script>
<!-- Footer -->
<div class="footer">
    Bản quyền © 2025 thuộc về Nguyen Bac Son. | 
    <a href="https://nguyenbacson.io.vn/privacy-policy.html">Chính sách bảo mật</a>
</div>
</body>
</html>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
    background-color: #f5f7fa;
    color: #333;
    line-height: 1.6;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

header {
    text-align: center;
    padding: 30px 0;
    background: linear-gradient(135deg, #1a6b3a 0%, #2c9c5c 100%);
    color: white;
    border-radius: 10px;
    margin-bottom: 30px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    position: relative;
    overflow: hidden;
}

.privacy-badge {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(255, 255, 255, 0.2);
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 0.8rem;
    display: flex;
    align-items: center;
    gap: 5px;
}

h1 {
    font-size: 2.5rem;
    margin-bottom: 10px;
}

.subtitle {
    font-size: 1.2rem;
    opacity: 0.9;
    max-width: 600px;
    margin: 0 auto;
}

.content {
    display: flex;
    flex-wrap: wrap;
    gap: 30px;
}

.form-section {
    flex: 1;
    min-width: 300px;
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
}

.comments-section {
    flex: 2;
    min-width: 300px;
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
}

.admin-section {
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    margin-top: 30px;
    border-left: 4px solid #e74c3c;
}

h2 {
    color: #2c3e50;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid #f0f0f0;
    display: flex;
    align-items: center;
    gap: 10px;
}

h2 i {
    color: #1a6b3a;
}

.form-group {
    margin-bottom: 20px;
    position: relative;
}

label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #2c3e50;
}

input, textarea, select {
    width: 100%;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 16px;
    transition: border 0.3s;
}

input:focus, textarea:focus, select:focus {
    border-color: #3498db;
    outline: none;
    box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
}

textarea {
    min-height: 150px;
    resize: vertical;
}

.btn {
    background: linear-gradient(135deg, #1a6b3a 0%, #2c9c5c 100%);
    color: white;
    border: none;
    padding: 12px 25px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    transition: all 0.3s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.btn-secondary {
    background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
}

.btn-danger {
    background: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%);
}

.comment {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    border-left: 4px solid #3498db;
    transition: transform 0.3s;
    position: relative;
}

.comment:hover {
    transform: translateX(5px);
}

.comment-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    flex-wrap: wrap;
    gap: 10px;
}

.comment-author {
    font-weight: bold;
    color: #2c3e50;
}

.comment-date {
    color: #7f8c8d;
    font-size: 0.9rem;
}

.comment-content {
    color: #34495e;
    margin-bottom: 10px;
}

.comment-category {
    display: inline-block;
    background: #eaf2f8;
    color: #3498db;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 0.8rem;
    margin-top: 5px;
}

.comment-location {
    display: inline-block;
    background: #e8f6f3;
    color: #27ae60;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 0.8rem;
    margin-top: 5px;
    margin-left: 5px;
}

.no-comments {
    text-align: center;
    color: #7f8c8d;
    padding: 30px;
    font-style: italic;
}

.privacy-notice {
    background: #eaf7ff;
    border-left: 4px solid #3498db;
    padding: 15px;
    border-radius: 4px;
    margin-top: 20px;
    font-size: 0.9rem;
}

.privacy-notice h3 {
    color: #2c3e50;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.filter-controls {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.filter-controls select, .filter-controls input {
    flex: 1;
    min-width: 150px;
}

.admin-controls {
    display: flex;
    gap: 10px;
    margin-top: 15px;
    flex-wrap: wrap;
}

.comment-stats {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.stat-box {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    flex: 1;
    min-width: 120px;
    text-align: center;
    border-top: 4px solid #3498db;
}

.stat-number {
    font-size: 1.8rem;
    font-weight: bold;
    color: #2c3e50;
}

.stat-label {
    font-size: 0.9rem;
    color: #7f8c8d;
}

footer {
    text-align: center;
    margin-top: 40px;
    padding: 20px;
    color: #7f8c8d;
    border-top: 1px solid #eee;
}

.password-protected {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    padding: 15px;
    border-radius: 6px;
    margin-bottom: 20px;
}

/* International Telephone Input Styles */
.iti {
    width: 100%;
    margin-bottom: 5px;
}

.iti__flag {
    background-image: url("https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/img/flags.png");
}

@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    .iti__flag {
        background-image: url("https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/img/flags@2x.png");
    }
}

.iti__selected-flag {
    background-color: #f8f9fa;
    border-radius: 6px 0 0 6px;
    padding: 0 8px;
}

.iti__country-list {
    border-radius: 6px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.hide {
    display: none;
}

#valid-msg {
    color: #27ae60;
    position: absolute;
    right: 10px;
    top: 38px;
    font-size: 0.9rem;
    font-weight: 600;
}

#error-msg {
    color: #e74c3c;
    position: absolute;
    right: 10px;
    top: 38px;
    font-size: 0.9rem;
    font-weight: 600;
}

.phone-info {
    margin-top: 5px;
}

.phone-info small {
    color: #7f8c8d;
    font-style: italic;
}

.comment-stats-detailed {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
}

.comment-stats-detailed h3 {
    color: #2c3e50;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.stat-category {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px;
    margin-bottom: 8px;
    background: white;
    border-radius: 6px;
    border-left: 4px solid #3498db;
}

.category-name {
    font-weight: 600;
    color: #2c3e50;
}

.category-count {
    color: #1a6b3a;
    font-weight: bold;
}

.total-filtered {
    background: #eaf7ff;
    padding: 10px;
    border-radius: 6px;
    margin-bottom: 15px;
    text-align: center;
}

.country-stat {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    margin-bottom: 5px;
    background: white;
    border-radius: 4px;
}

.phone-preview {
    background: #e8f6f3;
    padding: 8px 12px;
    border-radius: 4px;
    margin-top: 5px;
    font-size: 0.9rem;
    color: #27ae60;
}

@media (max-width: 768px) {
    .content {
        flex-direction: column;
    }
    
    h1 {
        font-size: 2rem;
    }
    
    .filter-controls, .admin-controls {
        flex-direction: column;
    }
    
    .comment-stats {
        flex-direction: column;
    }
    
    .stat-box {
        min-width: auto;
    }
    
    .iti {
        font-size: 14px;
    }
}
.footer {
    background-color: #f8f9fa;
    padding: 15px 20px;
    border-top: 1px solid #e9ecef;
    text-align: center;
    font-size: 14px;
    color: #6c757d;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    width: 100%;
    z-index: 1000;
}

.footer a {
    color: #007bff;
    text-decoration: none;
    margin: 0 10px;
}

.footer a:hover {
    text-decoration: underline;
}

body {
    margin-bottom: 70px;
}
</style>
<script>
// Dữ liệu quốc gia cơ bản
const allCountries = [
    { code: 'VN', name: 'Việt Nam', states: ['Hà Nội', 'Hồ Chí Minh', 'Đà Nẵng', 'Hải Phòng', 'Cần Thơ', 'An Giang', 'Bà Rịa - Vũng Tàu', 'Bắc Giang', 'Bắc Kạn', 'Bạc Liêu', 'Bắc Ninh', 'Bến Tre', 'Bình Định', 'Bình Dương', 'Bình Phước', 'Bình Thuận', 'Cà Mau', 'Cao Bằng', 'Đắk Lắk', 'Đắk Nông', 'Điện Biên', 'Đồng Nai', 'Đồng Tháp', 'Gia Lai', 'Hà Giang', 'Hà Nam', 'Hà Tĩnh', 'Hải Dương', 'Hậu Giang', 'Hòa Bình', 'Hưng Yên', 'Khánh Hòa', 'Kiên Giang', 'Kon Tum', 'Lai Châu', 'Lâm Đồng', 'Lạng Sơn', 'Lào Cai', 'Long An', 'Nam Định', 'Nghệ An', 'Ninh Bình', 'Ninh Thuận', 'Phú Thọ', 'Phú Yên', 'Quảng Bình', 'Quảng Nam', 'Quảng Ngãi', 'Quảng Ninh', 'Quảng Trị', 'Sóc Trăng', 'Sơn La', 'Tây Ninh', 'Thái Bình', 'Thái Nguyên', 'Thanh Hóa', 'Thừa Thiên Huế', 'Tiền Giang', 'Trà Vinh', 'Tuyên Quang', 'Vĩnh Long', 'Vĩnh Phúc', 'Yên Bái'] },
    { code: 'US', name: 'United States', states: ['Alabama', 'Alaska', 'Arizona', 'Arkansas', 'California', 'Colorado', 'Connecticut', 'Delaware', 'Florida', 'Georgia', 'Hawaii', 'Idaho', 'Illinois', 'Indiana', 'Iowa', 'Kansas', 'Kentucky', 'Louisiana', 'Maine', 'Maryland', 'Massachusetts', 'Michigan', 'Minnesota', 'Mississippi', 'Missouri', 'Montana', 'Nebraska', 'Nevada', 'New Hampshire', 'New Jersey', 'New Mexico', 'New York', 'North Carolina', 'North Dakota', 'Ohio', 'Oklahoma', 'Oregon', 'Pennsylvania', 'Rhode Island', 'South Carolina', 'South Dakota', 'Tennessee', 'Texas', 'Utah', 'Vermont', 'Virginia', 'Washington', 'West Virginia', 'Wisconsin', 'Wyoming'] },
    { code: 'CN', name: 'China', states: ['Beijing', 'Shanghai', 'Tianjin', 'Chongqing', 'Guangdong', 'Zhejiang', 'Jiangsu', 'Shandong', 'Henan', 'Hubei', 'Hunan', 'Sichuan', 'Anhui', 'Fujian', 'Heilongjiang', 'Jilin', 'Liaoning', 'Shaanxi', 'Shanxi', 'Hebei'] },
    { code: 'JP', name: 'Japan', states: ['Tokyo', 'Osaka', 'Kyoto', 'Hokkaido', 'Aichi', 'Chiba', 'Fukuoka', 'Hyogo', 'Kanagawa', 'Saitama'] },
    { code: 'KR', name: 'South Korea', states: ['Seoul', 'Busan', 'Incheon', 'Daegu', 'Daejeon', 'Gwangju', 'Ulsan', 'Gyeonggi', 'Gangwon', 'Chungcheong'] },
    { code: 'SG', name: 'Singapore', states: ['Singapore'] },
    { code: 'TH', name: 'Thailand', states: ['Bangkok', 'Chiang Mai', 'Phuket', 'Pattaya', 'Krabi', 'Samui', 'Hua Hin', 'Chiang Rai'] },
    { code: 'MY', name: 'Malaysia', states: ['Kuala Lumpur', 'Penang', 'Johor Bahru', 'Malacca', 'Ipoh', 'Kuching', 'Kota Kinabalu'] },
    { code: 'ID', name: 'Indonesia', states: ['Jakarta', 'Bali', 'Surabaya', 'Bandung', 'Medan', 'Makassar', 'Semarang'] },
    { code: 'PH', name: 'Philippines', states: ['Manila', 'Cebu', 'Davao', 'Quezon City', 'Makati', 'Cagayan de Oro', 'Bacolod'] },
    { code: 'GB', name: 'United Kingdom', states: ['London', 'Manchester', 'Birmingham', 'Liverpool', 'Edinburgh', 'Glasgow', 'Bristol', 'Leeds'] },
    { code: 'FR', name: 'France', states: ['Paris', 'Marseille', 'Lyon', 'Toulouse', 'Nice', 'Nantes', 'Strasbourg', 'Montpellier'] },
    { code: 'DE', name: 'Germany', states: ['Berlin', 'Munich', 'Hamburg', 'Cologne', 'Frankfurt', 'Stuttgart', 'Düsseldorf', 'Dortmund'] },
    { code: 'IT', name: 'Italy', states: ['Rome', 'Milan', 'Naples', 'Turin', 'Palermo', 'Genoa', 'Bologna', 'Florence'] },
    { code: 'ES', name: 'Spain', states: ['Madrid', 'Barcelona', 'Valencia', 'Seville', 'Zaragoza', 'Malaga', 'Murcia', 'Palma'] },
    { code: 'CA', name: 'Canada', states: ['Toronto', 'Vancouver', 'Montreal', 'Calgary', 'Edmonton', 'Ottawa', 'Winnipeg', 'Quebec City'] },
    { code: 'AU', name: 'Australia', states: ['Sydney', 'Melbourne', 'Brisbane', 'Perth', 'Adelaide', 'Gold Coast', 'Canberra', 'Newcastle'] }
];

document.addEventListener('DOMContentLoaded', function() {
    const commentForm = document.getElementById('commentForm');
    const commentsList = document.getElementById('commentsList');
    const filterCategory = document.getElementById('filterCategory');
    const filterCountry = document.getElementById('filterCountry');
    const sortComments = document.getElementById('sortComments');
    const adminLogin = document.getElementById('adminLogin');
    const adminPanel = document.getElementById('adminPanel');
    const exportComments = document.getElementById('exportComments');
    const deleteAllComments = document.getElementById('deleteAllComments');
    const countrySelect = document.getElementById('country');
    const stateSelect = document.getElementById('state');
    const phoneInputField = document.getElementById('phone');
    
    // Khởi tạo International Telephone Input
    const phoneInput = window.intlTelInput(phoneInputField, {
        utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
        separateDialCode: true,
        preferredCountries: ['vn', 'us', 'gb', 'ca', 'au', 'jp', 'kr', 'sg'],
        initialCountry: "auto",
        geoIpLookup: function(callback) {
            fetch('https://ipapi.co/json/')
                .then(res => res.json())
                .then(data => callback(data.country_code))
                .catch(() => callback('vn'));
        }
    });

    // Các biến để validate số điện thoại
    const validMsg = document.getElementById("valid-msg");
    const errorMsg = document.getElementById("error-msg");

    // Validate số điện thoại real-time
    function validatePhoneNumber() {
        if (phoneInput.isValidNumber()) {
            validMsg.classList.remove("hide");
            errorMsg.classList.add("hide");
            return true;
        } else {
            validMsg.classList.add("hide");
            errorMsg.classList.remove("hide");
            errorMsg.textContent = "";
            return false;
        }
    }

    // Event listeners cho số điện thoại
    phoneInputField.addEventListener('input', validatePhoneNumber);
    phoneInputField.addEventListener('blur', validatePhoneNumber);
    phoneInputField.addEventListener('countrychange', validatePhoneNumber);

    // Cơ chế đánh lừa mật khẩu
    function getRealPassword() {
        const part1 = String.fromCharCode(64); // @
        const part2 = "Son";
        const part3 = "20";
        const part4 = "07";
        return part1 + part2 + part3 + part4;
    }

    function validatePassword(input) {
        const realPassword = getRealPassword();
        return input === realPassword;
    }

    // Khởi tạo danh sách quốc gia
    function initializeCountries() {
        allCountries.forEach(country => {
            const option = document.createElement('option');
            option.value = country.code;
            option.textContent = country.name;
            countrySelect.appendChild(option);

            const filterOption = document.createElement('option');
            filterOption.value = country.code;
            filterOption.textContent = country.name;
            filterCountry.appendChild(filterOption);
        });
    }

    // Cập nhật danh sách tỉnh/thành phố khi chọn quốc gia
    countrySelect.addEventListener('change', function() {
        const selectedCountry = allCountries.find(c => c.code === this.value);
        stateSelect.innerHTML = '<option value="">Chọn tỉnh/thành phố</option>';
        
        if (selectedCountry) {
            selectedCountry.states.forEach(state => {
                const option = document.createElement('option');
                option.value = state;
                option.textContent = state;
                stateSelect.appendChild(option);
            });
            
            // Tự động cập nhật mã vùng điện thoại khi chọn quốc gia
            phoneInput.setCountry(selectedCountry.code);
            validatePhoneNumber();
        }
    });

    // Tải các ý kiến từ localStorage khi trang được tải
    initializeCountries();
    loadComments();
    updateStats();

    // Xử lý sự kiện gửi form
    commentForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Validate số điện thoại
        if (!validatePhoneNumber()) {
            alert('Vui lòng nhập số điện thoại hợp lệ!');
            phoneInputField.focus();
            return;
        }

        // Lấy dữ liệu từ form
        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const phone = phoneInput.getNumber();
        const country = countrySelect.options[countrySelect.selectedIndex].text;
        const countryCode = countrySelect.value;
        const state = stateSelect.value;
        const category = document.getElementById('category').value;
        const comment = document.getElementById('comment').value;
        
        // Tạo đối tượng ý kiến mới
        const newComment = {
            id: Date.now(),
            name: name,
            email: email,
            phone: phone,
            country: country,
            countryCode: countryCode,
            state: state,
            category: category,
            comment: comment,
            date: new Date().toLocaleString('vi-VN'),
            dateObj: new Date()
        };
        
        // Lưu ý kiến mới
        saveComment(newComment);
        
        // Reset form
        commentForm.reset();
        phoneInput.setNumber("");
        stateSelect.innerHTML = '<option value="">Chọn tỉnh/thành phố</option>';
        validMsg.classList.add("hide");
        errorMsg.classList.add("hide");
        
        // Cập nhật thống kê
        updateStats();
        
        // Hiển thị thông báo
        alert('Cảm ơn bạn đã gửi ý kiến! Ý kiến của bạn đã được lưu an toàn.');
    });

    // Xử lý bộ lọc và tìm kiếm
    filterCategory.addEventListener('change', filterAndSortComments);
    filterCountry.addEventListener('change', filterAndSortComments);
    sortComments.addEventListener('change', filterAndSortComments);

    // Xử lý đăng nhập quản trị
    adminLogin.addEventListener('click', function() {
        const password = document.getElementById('adminPassword').value;
        if (validatePassword(password)) {
            adminPanel.style.display = 'block';
            document.querySelector('.password-protected').style.display = 'none';
            updateAdminStats();
        } else {
            alert('Mật khẩu không đúng!');
        }
    });

    // Xuất dữ liệu
    exportComments.addEventListener('click', function() {
        const comments = JSON.parse(localStorage.getItem('userComments')) || [];
        if (comments.length === 0) {
            alert('Không có dữ liệu để xuất!');
            return;
        }
        
        // Tạo nội dung file CSV
        let csvContent = "Tên,Email,Số điện thoại,Quốc gia,Tỉnh/Thành phố,Danh mục,Ý kiến,Ngày gửi\n";
        comments.forEach(comment => {
            csvContent += `"${comment.name}","${comment.email}","${comment.phone}","${comment.country}","${comment.state}","${getCategoryName(comment.category)}","${comment.comment.replace(/"/g, '""')}","${comment.date}"\n`;
        });
        
        // Tạo file và tải về
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.setAttribute("href", url);
        link.setAttribute("download", "y_kien_nguoi_dung.csv");
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    });

    // Xóa tất cả ý kiến
    deleteAllComments.addEventListener('click', function() {
        if (confirm('Bạn có chắc chắn muốn xóa TẤT CẢ ý kiến? Hành động này không thể hoàn tác!')) {
            localStorage.removeItem('userComments');
            commentsList.innerHTML = '<div class="no-comments"><i class="fas fa-comment-slash"></i><br>Chưa có ý kiến nào. Hãy là người đầu tiên chia sẻ!</div>';
            updateStats();
            updateAdminStats();
            alert('Đã xóa tất cả ý kiến!');
        }
    });
    // Hàm lưu ý kiến vào localStorage
    function saveComment(comment) {
        let comments = JSON.parse(localStorage.getItem('userComments')) || [];
        comments.push(comment);
        localStorage.setItem('userComments', JSON.stringify(comments));
    }

    // Hàm tải các ý kiến từ localStorage
    function loadComments() {
        const comments = JSON.parse(localStorage.getItem('userComments')) || [];
        
        if (comments.length === 0) {
            commentsList.innerHTML = '<div class="no-comments"><i class="fas fa-comment-slash"></i><br>Chưa có ý kiến nào. Hãy là người đầu tiên chia sẻ!</div>';
            return;
        }
        
        // Hiển thị thống kê thay vì danh sách ý kiến
        displayCommentStats();
    }

    // Hàm hiển thị thống kê ý kiến
    function displayCommentStats() {
        const comments = JSON.parse(localStorage.getItem('userComments')) || [];
        
        if (comments.length === 0) {
            commentsList.innerHTML = '<div class="no-comments"><i class="fas fa-comment-slash"></i><br>Chưa có ý kiến nào. Hãy là người đầu tiên chia sẻ!</div>';
            return;
        }
        
        // Thống kê theo danh mục
        const statsByCategory = {};
        const statsByCountry = {};
        
        comments.forEach(comment => {
            // Thống kê danh mục
            if (!statsByCategory[comment.category]) {
                statsByCategory[comment.category] = 0;
            }
            statsByCategory[comment.category]++;
            
            // Thống kê quốc gia
            if (!statsByCountry[comment.country]) {
                statsByCountry[comment.country] = 0;
            }
            statsByCountry[comment.country]++;
        });
        
        // Tạo HTML hiển thị thống kê
        let statsHTML = '<div class="comment-stats-detailed">';
        statsHTML += '<h3><i class="fas fa-chart-bar"></i> Thống kê ý kiến</h3>';
        
        // Hiển thị thống kê theo danh mục
        statsHTML += '<h4><i class="fas fa-tags"></i> Theo danh mục:</h4>';
        for (const category in statsByCategory) {
            statsHTML += `
                <div class="stat-category">
                    <span class="category-name">${getCategoryName(category)}</span>
                    <span class="category-count">${statsByCategory[category]} ý kiến</span>
                </div>
            `;
        }
        
        // Hiển thị thống kê theo quốc gia
        statsHTML += '<h4 style="margin-top: 20px;"><i class="fas fa-globe"></i> Theo quốc gia:</h4>';
        for (const country in statsByCountry) {
            statsHTML += `
                <div class="country-stat">
                    <span class="category-name">${country}</span>
                    <span class="category-count">${statsByCountry[country]} ý kiến</span>
                </div>
            `;
        }
        
        statsHTML += '</div>';
        commentsList.innerHTML = statsHTML;
    }

    // Hàm lọc và sắp xếp ý kiến
    function filterAndSortComments() {
        const comments = JSON.parse(localStorage.getItem('userComments')) || [];
        const categoryFilter = filterCategory.value;
        const countryFilter = filterCountry.value;
        const sortOrder = sortComments.value;
        
        // Lọc theo danh mục
        let filteredComments = comments;
        if (categoryFilter) {
            filteredComments = filteredComments.filter(comment => comment.category === categoryFilter);
        }
        
        // Lọc theo quốc gia
        if (countryFilter) {
            filteredComments = filteredComments.filter(comment => comment.countryCode === countryFilter);
        }
        
        // Sắp xếp
        if (sortOrder === 'newest') {
            filteredComments.sort((a, b) => b.dateObj - a.dateObj);
        } else {
            filteredComments.sort((a, b) => a.dateObj - b.dateObj);
        }
        
        // Hiển thị thống kê sau khi lọc
        displayFilteredStats(filteredComments);
    }

    // Hàm hiển thị thống kê sau khi lọc
    function displayFilteredStats(comments) {
        if (comments.length === 0) {
            commentsList.innerHTML = '<div class="no-comments"><i class="fas fa-search"></i><br>Không tìm thấy ý kiến nào phù hợp với bộ lọc.</div>';
            return;
        }
        
        // Thống kê theo danh mục
        const statsByCategory = {};
        const statsByCountry = {};
        
        comments.forEach(comment => {
            // Thống kê danh mục
            if (!statsByCategory[comment.category]) {
                statsByCategory[comment.category] = 0;
            }
            statsByCategory[comment.category]++;
            
            // Thống kê quốc gia
            if (!statsByCountry[comment.country]) {
                statsByCountry[comment.country] = 0;
            }
            statsByCountry[comment.country]++;
        });
        
        // Tạo HTML hiển thị thống kê
        let statsHTML = '<div class="comment-stats-detailed">';
        statsHTML += '<h3><i class="fas fa-chart-bar"></i> Thống kê ý kiến</h3>';
        statsHTML += `<p class="total-filtered">Tìm thấy <strong>${comments.length}</strong> ý kiến phù hợp</p>`;
        
        // Hiển thị thống kê theo danh mục
        statsHTML += '<h4><i class="fas fa-tags"></i> Theo danh mục:</h4>';
        for (const category in statsByCategory) {
            statsHTML += `
                <div class="stat-category">
                    <span class="category-name">${getCategoryName(category)}</span>
                    <span class="category-count">${statsByCategory[category]} ý kiến</span>
                </div>
            `;
        }
        
        // Hiển thị thống kê theo quốc gia
        statsHTML += '<h4 style="margin-top: 20px;"><i class="fas fa-globe"></i> Theo quốc gia:</h4>';
        for (const country in statsByCountry) {
            statsHTML += `
                <div class="country-stat">
                    <span class="category-name">${country}</span>
                    <span class="category-count">${statsByCountry[country]} ý kiến</span>
                </div>
            `;
        }
        
        statsHTML += '</div>';
        commentsList.innerHTML = statsHTML;
    }

    // Hàm cập nhật thống kê tổng quan
    function updateStats() {
        const comments = JSON.parse(localStorage.getItem('userComments')) || [];
        const today = new Date().toDateString();
        const todayComments = comments.filter(comment => 
            new Date(comment.dateObj).toDateString() === today
        ).length;
        
        // Đếm số quốc gia duy nhất
        const uniqueCountries = [...new Set(comments.map(comment => comment.country))];
        
        document.getElementById('totalComments').textContent = comments.length;
        document.getElementById('todayComments').textContent = todayComments;
        document.getElementById('countryCount').textContent = uniqueCountries.length;
        
        // Cập nhật hiển thị thống kê chi tiết
        displayCommentStats();
    }

    // Hàm cập nhật thống kê quản trị
    function updateAdminStats() {
        const comments = JSON.parse(localStorage.getItem('userComments')) || [];
        const stats = {
            total: comments.length,
            byCategory: {},
            byCountry: {},
            byPhoneCode: {}
        };
        
        comments.forEach(comment => {
            // Thống kê danh mục
            if (!stats.byCategory[comment.category]) {
                stats.byCategory[comment.category] = 0;
            }
            stats.byCategory[comment.category]++;
            
            // Thống kê quốc gia
            if (!stats.byCountry[comment.country]) {
                stats.byCountry[comment.country] = 0;
            }
            stats.byCountry[comment.country]++;
        });
        
        let statsHTML = `<p>Tổng số ý kiến: <strong>${stats.total}</strong></p>`;
        statsHTML += '<p>Phân bổ theo danh mục:</p><ul>';
        
        for (const category in stats.byCategory) {
            statsHTML += `<li>${getCategoryName(category)}: ${stats.byCategory[category]}</li>`;
        }
        
        statsHTML += '</ul><p>Phân bổ theo quốc gia:</p><ul>';
        
        for (const country in stats.byCountry) {
            statsHTML += `<li>${country}: ${stats.byCountry[country]}</li>`;
        }
        
        statsHTML += '</ul>';
        document.getElementById('adminStats').innerHTML = statsHTML;
    }
    
    // Hàm lấy tên danh mục
    function getCategoryName(category) {
        const categories = {
            'gop-y': 'Góp ý',
            'danh-gia': 'Đánh giá',
            'hoi-dap': 'Hỏi đáp',
            'khac': 'Khác'
        };
        
        return categories[category] || 'Không xác định';
    }
});
// JavaScript cho footer (nếu cần thêm tính năng)
document.addEventListener('DOMContentLoaded', function() {
    // Code xử lý cho footer nếu cần
    console.log('Footer loaded');
});
</script>