<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy New Year - Truong Thi Duong</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #020202;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
        }
        canvas {
            display: block;
        }
        
        /* --- PH·∫¶N TEXT NEON --- */
        #neon-container {
            position: absolute;
            top: 40%;
            left: 0;
            width: 100%;
            transform: translateY(-50%);
            text-align: center;
            z-index: 10;
            pointer-events: none;
            display: none;
        }

        .neon-text {
            font-size: 50px;
            font-weight: bold;
            color: #fff;
            text-transform: uppercase;
            text-shadow: 
                0 0 5px #fff,
                0 0 10px #fff,
                0 0 20px #ff00de,
                0 0 30px #ff00de,
                0 0 40px #ff00de,
                0 0 55px #ff00de,
                0 0 75px #ff00de;
            animation: floatAndGlow 3s ease-in-out infinite alternate;
            margin: 10px 0;
            opacity: 0;
            transition: opacity 1.5s ease;
        }

        .sub-text {
            font-size: 60px;
            color: #fff;
            font-weight: 900;
            text-shadow: 
                0 0 5px #fff,
                0 0 10px #fff,
                0 0 20px #ff9900,
                0 0 30px #ff9900,
                0 0 40px #ff9900;
            animation: zoomMove 4s ease-in-out infinite alternate;
            opacity: 0;
            transition: opacity 1.5s ease 0.5s;
        }

        @media (max-width: 600px) {
            .neon-text { font-size: 30px; }
            .sub-text { font-size: 38px; }
        }

        @keyframes floatAndGlow {
            0% { transform: translateY(0); text-shadow: 0 0 20px #ff00de; }
            100% { transform: translateY(-20px); text-shadow: 0 0 40px #ff00de, 0 0 80px #ff00de; }
        }

        @keyframes zoomMove {
            0% { transform: scale(1) rotate(-2deg); }
            100% { transform: scale(1.1) rotate(2deg); }
        }

        /* --- N√öT L√å X√å ·ªû G√ìC PH·∫¢I --- */
        #lucky-money-link {
            position: fixed;
            bottom: 20px;
            right: 20px;
            font-size: 50px;
            text-decoration: none;
            z-index: 1000;
            transition:all 0.5s ease;
            cursor: pointer;
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
        }
        
        #lucky-money-link:hover {
            transform: scale(1.2) rotate(-10deg) !important;
        }

        #lucky-money-link.show {
             opacity: 1;
             transform: translateY(0);
             pointer-events: auto;
        }

        /* --- OVERLAY M·ªû ƒê·∫¶U --- */
        #overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            z-index: 999;
            cursor: pointer;
            text-align: center;
            user-select: none;
            transition: opacity 1s ease;
        }
        #overlay h1 {
            color: #ffcc00;
            margin-bottom: 15px;
            font-size: 24px;
            text-shadow: 0 0 20px #ff6600;
        }
        #overlay p {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.6; }
            50% { transform: scale(1.05); opacity: 1; }
        }
    </style>
</head>
<body>

<div id="overlay">
    <h1>‚ú® G·ª≠i: Tr∆∞∆°ng Th·ªã D∆∞∆°ng ‚ú®</h1>
    <p>(Ch·∫°m m√†n h√¨nh ƒë·ªÉ b·∫Øt ƒë·∫ßu)</p>
</div>

<div id="neon-container">
    <div class="neon-text" id="line1">CH√öC M·ª™NG NƒÇM M·ªöI</div>
    <div class="sub-text" id="line2">TR∆Ø∆†NG TH·ªä D∆Ø∆†NG</div>
</div>

<a href="https://nguyenbacson.io.vn/happynewyear-your/quay-li-xi" id="lucky-money-link" target="_blank" title="Nh·∫≠n L√¨ X√¨">
    üßß
</a>

<canvas id="canvas"></canvas>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const overlay = document.getElementById('overlay');
    const neonContainer = document.getElementById('neon-container');
    const line1 = document.getElementById('line1');
    const line2 = document.getElementById('line2');
    const luckyLink = document.getElementById('lucky-money-link');

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let fireworks = [];
    let particles = [];
    let frame = 0;
    let isPlaying = false;
    let currentStage = -1;
    
    const stages = ['intro', 'show_text', 'mix_firework', 'finale'];

    function getScreenConfig() {
        const area = canvas.width * canvas.height;
        if (area < 300000) return { scale: 0.5, countMult: 0.6 };
        else if (area < 1000000) return { scale: 0.8, countMult: 0.8 };
        else return { scale: 1.0, countMult: 1.0 };
    }

    const sounds = {
        launch: new Audio('https://nguyenbacson.io.vn/moi-ban.mp3'),
        short: new Audio('https://nguyenbacson.io.vn/no-ngan.mp3'),
        small: new Audio('https://nguyenbacson.io.vn/chum-be.mp3'),
        big: new Audio('https://nguyenbacson.io.vn/chum-to.mp3'),
        long: new Audio('https://nguyenbacson.io.vn/chum-dai.mp3')
    };

    sounds.launch.volume = 0.3;
    sounds.short.volume = 0.5;
    sounds.long.volume = 0.8;

    function playSound(type) {
        if (!isPlaying) return;
        if (type === 'long') {
            sounds.long.currentTime = 0;
            sounds.long.play().catch(() => {});
            return;
        }
        const sound = sounds[type];
        if (sound) {
            const clone = sound.cloneNode();
            clone.volume = sound.volume;
            clone.play().catch(() => {});
        }
    }

    function random(min, max) { return Math.random() * (max - min) + min; }

    function getRandomColor() {
        const palettes = [[30, 60], [0, 20], [180, 220], [280, 320], [0, 360]];
        const palette = palettes[Math.floor(Math.random() * palettes.length)];
        return random(palette[0], palette[1]);
    }

    class Firework {
        constructor(x, y, targetX, targetY, type) {
            this.x = x;
            this.y = y;
            this.targetX = targetX;
            this.targetY = targetY;
            this.type = type; 
            const angle = Math.atan2(targetY - y, targetX - x);
            const speed = random(13, 17);
            this.vx = Math.cos(angle) * speed;
            this.vy = Math.sin(angle) * speed;
            this.hue = random(0, 360);
            this.trail = [];
            playSound('launch');
        }
        update(index) {
            this.trail.push({x: this.x, y: this.y});
            if(this.trail.length > 4) this.trail.shift();
            this.x += this.vx;
            this.y += this.vy;
            this.vy += 0.05;
            const dist = Math.sqrt(Math.pow(this.x - this.targetX, 2) + Math.pow(this.y - this.targetY, 2));
            if (dist < 20 || (this.vy >= 0 && this.y < canvas.height - 100)) {
                createExplosion(this.x, this.y, this.type);
                fireworks.splice(index, 1);
            }
        }
        draw() {
            ctx.beginPath();
            ctx.moveTo(this.trail[0]?.x || this.x, this.trail[0]?.y || this.y);
            ctx.lineTo(this.x, this.y);
            ctx.strokeStyle = `hsl(${this.hue}, 100%, 60%)`;
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.stroke();
        }
    }

    class Particle {
        constructor(x, y, hue, type) {
            this.x = x;
            this.y = y;
            this.hue = hue;
            this.type = type;
            this.alpha = 1;
            this.decay = random(0.008, 0.015);
            const config = getScreenConfig();
            const speed = type === 'big' ? random(4, 8) : random(2, 5);
            const angle = random(0, Math.PI * 2);
            this.vx = Math.cos(angle) * speed;
            this.vy = Math.sin(angle) * speed;
            this.friction = 0.95;
            this.gravity = 0.05;
            this.size = random(1, 3) * config.scale;
            if (type === 'big') {
                this.friction = 0.93;
                this.sparkle = Math.random() < 0.3;
            }
        }
        update(index) {
            this.vx *= this.friction;
            this.vy *= this.friction;
            this.vy += this.gravity;
            this.x += this.vx;
            this.y += this.vy;
            this.alpha -= this.decay;
            if (this.type === 'big' && this.sparkle) this.alpha = random(0.4, 1);
            if (this.alpha <= 0.01) particles.splice(index, 1);
        }
        draw() {
            ctx.save();
            ctx.globalAlpha = this.alpha;
            ctx.fillStyle = `hsl(${this.hue}, 100%, 60%)`;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
        }
    }

    function createExplosion(x, y, type) {
        playSound(type);
        const config = getScreenConfig();
        let count = type === 'big' ? 60 : (type === 'small' ? 30 : 15);
        count *= config.countMult;
        const hue = getRandomColor();
        for (let i = 0; i < count; i++) {
            particles.push(new Particle(x, y, hue + random(-15, 15), type));
        }
    }

    function nextStage() {
        if (!isPlaying) return;
        currentStage++;
        if (currentStage >= stages.length) currentStage = 0;
        const stage = stages[currentStage];
        let delayNext = 2000;

        switch(stage) {
            case 'intro':
                neonContainer.style.display = 'none';
                line1.style.opacity = '0';
                line2.style.opacity = '0';
                for(let i=0; i<3; i++) {
                    setTimeout(() => {
                        fireworks.push(new Firework(
                            random(canvas.width*0.2, canvas.width*0.8), canvas.height,
                            random(canvas.width*0.3, canvas.width*0.7), random(canvas.height*0.2, canvas.height*0.5),
                            'short'
                        ));
                    }, i * 800);
                }
                delayNext = 3000;
                break;
            case 'show_text':
                neonContainer.style.display = 'block';
                setTimeout(() => { line1.style.opacity = '1'; }, 100);
                setTimeout(() => { line2.style.opacity = '1'; }, 600);
                for(let i=0; i<4; i++) {
                    setTimeout(() => {
                        fireworks.push(new Firework(
                            random(0, canvas.width), canvas.height,
                            random(canvas.width*0.1, canvas.width*0.9), random(canvas.height*0.1, canvas.height*0.5),
                            'small'
                        ));
                    }, i * 1000);
                }
                delayNext = 5000;
                break;
            case 'mix_firework':
                for(let i=0; i<3; i++) {
                    setTimeout(() => {
                        fireworks.push(new Firework(
                            random(canvas.width*0.1, canvas.width*0.9), canvas.height,
                            random(canvas.width*0.2, canvas.width*0.8), random(canvas.height*0.2, canvas.height*0.6),
                            'big'
                        ));
                    }, i * 1500);
                }
                delayNext = 5000;
                break;
            case 'finale':
                line1.style.opacity = '0';
                line2.style.opacity = '0';
                playSound('long');
                const duration = 25000; 
                const interval = setInterval(() => {
                    const type = Math.random() < 0.5 ? 'big' : 'small';
                    fireworks.push(new Firework(
                        random(0, canvas.width), canvas.height,
                        random(0, canvas.width), random(canvas.height*0.1, canvas.height*0.7),
                        type
                    ));
                }, 300); 
                setTimeout(() => {
                    clearInterval(interval);
                    setTimeout(nextStage, 5000); 
                }, duration);
                return; 
        }
        if (stage !== 'finale') {
            setTimeout(nextStage, delayNext);
        }
    }

    function loop() {
        requestAnimationFrame(loop);
        frame++;
        ctx.globalCompositeOperation = 'destination-out';
        ctx.fillStyle = 'rgba(0, 0, 0, 0.15)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.globalCompositeOperation = 'lighter';
        for (let i = fireworks.length - 1; i >= 0; i--) {
            fireworks[i].update(i);
            fireworks[i].draw();
        }
        for (let i = particles.length - 1; i >= 0; i--) {
            particles[i].update(i);
            particles[i].draw();
        }
    }

    overlay.addEventListener('click', () => {
        overlay.style.opacity = '0';
        setTimeout(() => { 
            overlay.style.display = 'none'; 
            luckyLink.classList.add('show');
        }, 1000);
        
        isPlaying = true;
        const s = new Audio(); s.play().catch(()=>{});
        nextStage();
    });

    window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    });

    loop();
</script>
</body>
</html>
