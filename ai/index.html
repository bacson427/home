<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Nguy·ªÖn B·∫Øc S∆°n</title>
    <style>
        /* GIAO DI·ªÜN DARK MODE */
        body { font-family: 'Segoe UI', sans-serif; background-color: #121212; color: #fff; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        .header { background-color: #1f1f1f; padding: 15px; text-align: center; border-bottom: 1px solid #333; }
        .header h2 { margin: 0; color: #4facfe; font-size: 18px; }
        .header p { margin: 5px 0 0; font-size: 12px; color: #888; }
        #chat-box { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .message { max-width: 80%; padding: 12px 16px; border-radius: 20px; font-size: 15px; line-height: 1.5; word-wrap: break-word; }
        .user-msg { align-self: flex-end; background: #0072ff; color: white; }
        .ai-msg { align-self: flex-start; background: #2a2a2a; border: 1px solid #333; color: #e0e0e0; }
        .input-area { background: #1f1f1f; padding: 15px; display: flex; gap: 10px; border-top: 1px solid #333; }
        input { flex: 1; padding: 12px; border-radius: 25px; border: 1px solid #444; background: #2a2a2a; color: white; outline: none; }
        button { padding: 10px 25px; background: #0072ff; color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: bold; }
        button:disabled { background: #555; }
    </style>
</head>
<body>

    <div class="header">
        <h2>ü§ñ AI NGUY·ªÑN B·∫ÆC S∆†N</h2>
        <p>B·∫£n sao s·ªë (Digital Clone)</p>
    </div>

    <div id="chat-box">
        <div class="message ai-msg">
            Ch√†o ƒê·∫°i Ca! Em l√† S∆°n AI ƒë√¢y. <br>
            Web: nguyenbacson.io.vn | Hactech student.<br>
            ƒê·∫°i Ca c·∫ßn h·ªèi g√¨ kh√¥ng?
        </div>
    </div>

    <div class="input-area">
        <input type="text" id="user-input" placeholder="Nh·∫≠p tin nh·∫Øn..." onkeypress="if(event.key==='Enter') sendMessage()">
        <button id="btn-send" onclick="sendMessage()">G·ª≠i</button>
    </div>

    <script>
      <script>
        // QUAN TR·ªåNG: ƒê√£ x√≥a API Key ·ªü ƒë√¢y. An to√†n tuy·ªát ƒë·ªëi!
        
        // V·∫´n gi·ªØ nguy√™n ph·∫ßn gi·ªõi thi·ªáu b·∫£n th√¢n
        const TRAINING_DATA = 
            "H√ÉY ƒê√ìNG VAI L√Ä: Nguy·ªÖn B·∫Øc S∆°n (Nam, sinh 04/02/2007). " +
            "QU√ä QU√ÅN: H·∫£i D∆∞∆°ng. HI·ªÜN T·∫†I: S·ªëng t·∫°i H√† N·ªôi. " +
            "H·ªåC V·∫§N: Sinh vi√™n nƒÉm nh·∫•t - ƒêi·ªán c√¥ng nghi·ªáp - Tr∆∞·ªùng Cao ƒë·∫≥ng ngh·ªÅ B√°ch Khoa H√† N·ªôi (Hactech). " +
            "S·ªû TH√çCH: L·∫≠p tr√¨nh C++, Web (ch·ªß web nguyenbacson.io.vn), c√¥ng ngh·ªá AI. " +
            "THI·∫æT B·ªä: D√πng Redmi 12 5G v√† Laptop Dell Core i7. " +
            "M·ª§C TI√äU: H·ªçc ti·∫øng H√†n ƒë·ªÉ sang H√†n Qu·ªëc sau khi t·ªët nghi·ªáp nh∆∞ng l∆∞·ªùi h·ªçc. " +
            "T√çNH C√ÅCH: H√†i h∆∞·ªõc, ng·∫Øn g·ªçn, g·ªçi ng∆∞·ªùi chat l√† 'ƒê·∫°i Ca' v√† x∆∞ng 'Em'.";

        async function sendMessage() {
            const inputField = document.getElementById('user-input');
            const sendBtn = document.getElementById('btn-send');
            const chatBox = document.getElementById('chat-box');
            const userText = inputField.value.trim();

            if (!userText) return;

            // 1. Hi·ªÉn th·ªã tin nh·∫Øn ng∆∞·ªùi d√πng
            chatBox.innerHTML += `<div class="message user-msg">${userText}</div>`;
            inputField.value = "";
            chatBox.scrollTop = chatBox.scrollHeight;

            // 2. Kh√≥a n√∫t g·ª≠i ƒë·ªÉ tr√°nh b·∫•m nhi·ªÅu l·∫ßn
            sendBtn.disabled = true;
            sendBtn.innerText = "...";
            
            const loadingId = "msg-" + Date.now();
            chatBox.innerHTML += `<div id="${loadingId}" class="message ai-msg">Thinking...</div>`;
            chatBox.scrollTop = chatBox.scrollHeight;

            try {
                // 3. G·ªåI V√ÄO SERVER C·ª¶A CH√çNH M√åNH (Thay ƒë·ªïi quan tr·ªçng nh·∫•t)
                // N√≥ s·∫Ω t·ª± t√¨m ƒë·∫øn file api/chat.js ƒê·∫°i Ca v·ª´a t·∫°o
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userText: userText,
                        history: TRAINING_DATA // G·ª≠i k√®m th√¥ng tin hu·∫•n luy·ªán
                    })
                });

                const data = await response.json();

                // 4. X·ª≠ l√Ω l·ªói ho·∫∑c hi·ªÉn th·ªã k·∫øt qu·∫£
                if (!response.ok || data.error) {
                    let err = "L·ªói k·∫øt n·ªëi!";
                    if (data.error && data.error.message) err = data.error.message;
                    document.getElementById(loadingId).innerText = "‚ùå " + err;
                    document.getElementById(loadingId).style.color = "#ff5555";
                } else {
                    // L·∫•y n·ªôi dung tr·∫£ v·ªÅ t·ª´ Gemini
                    const aiReply = data.candidates?.[0]?.content?.parts?.[0]?.text || "Em ch∆∞a hi·ªÉu √Ω ƒê·∫°i Ca...";
                    document.getElementById(loadingId).innerText = aiReply;
                }
            } catch (error) {
                document.getElementById(loadingId).innerText = "‚ùå L·ªói m·∫°ng: " + error.message;
            }
            
            // 5. M·ªü l·∫°i n√∫t g·ª≠i
            sendBtn.disabled = false;
            sendBtn.innerText = "G·ª≠i";
        }
    </script>
    </script>
</body>
</html>
