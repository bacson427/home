<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Nguy·ªÖn B·∫Øc S∆°n</title>
    <style>
        /* GIAO DI·ªÜN DARK MODE */
        body { font-family: 'Segoe UI', sans-serif; background-color: #121212; color: #fff; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        
        /* HEADER C√ì N√öT ƒê·ªîI KEY */
        .header { 
            background-color: #1f1f1f; padding: 10px 15px; 
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #333; 
        }
        .header-info h2 { margin: 0; font-size: 16px; color: #4facfe; }
        .header-info p { margin: 2px 0 0; font-size: 12px; color: #888; }
        
        .btn-reset {
            background: #333; color: #fff; border: 1px solid #555;
            padding: 5px 10px; font-size: 12px; border-radius: 5px; cursor: pointer;
        }
        .btn-reset:hover { background: #444; }

        /* KHUNG CHAT */
        #chat-box { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .message { max-width: 80%; padding: 10px 15px; border-radius: 20px; line-height: 1.4; word-wrap: break-word; }
        .user-msg { align-self: flex-end; background: #0072ff; color: white; }
        .ai-msg { align-self: flex-start; background: #2a2a2a; border: 1px solid #333; }
        
        /* INPUT */
        .input-area { background: #1f1f1f; padding: 15px; display: flex; gap: 10px; }
        input { flex: 1; padding: 12px; border-radius: 20px; border: 1px solid #444; background: #2a2a2a; color: white; outline: none; }
        button.btn-send { padding: 10px 20px; background: #0072ff; color: white; border: none; border-radius: 20px; cursor: pointer; }
        
        /* POPUP NH·∫¨P KEY */
        #key-setup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: flex; justify-content: center; align-items: center; z-index: 999; }
        .key-box { background: #222; padding: 30px; border-radius: 10px; text-align: center; border: 1px solid #444; width: 90%; max-width: 350px; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="key-setup">
        <div class="key-box">
            <h3 style="color: #4facfe">üîë C·∫•u h√¨nh Key</h3>
            <p style="font-size: 13px; color: #ccc">Nh·∫≠p Gemini API Key ƒë·ªÉ b·∫Øt ƒë·∫ßu:</p>
            <input type="password" id="api-key-input" placeholder="D√°n m√£ AIza... v√†o ƒë√¢y" style="width: 80%; margin-bottom: 15px;">
            <br>
            <button class="btn-send" onclick="saveKey()">L∆ØU & CHAT</button>
            <p style="margin-top: 10px; font-size: 11px; color: #666;">*Key ƒë∆∞·ª£c l∆∞u tr√™n tr√¨nh duy·ªát c·ªßa b·∫°n</p>
        </div>
    </div>

    <div class="header">
        <div class="header-info">
            <h2>ü§ñ AI NGUY·ªÑN B·∫ÆC S∆†N</h2>
            <p>Digital Clone</p>
        </div>
        <button class="btn-reset" onclick="resetKey()">üîÑ ƒê·ªïi Key</button>
    </div>

    <div id="chat-box">
        <div class="message ai-msg">Ch√†o ƒê·∫°i Ca! Em l√† b·∫£n sao c·ªßa S∆°n. ƒê·∫°i Ca c·∫ßn gi√∫p g√¨ kh√¥ng?</div>
    </div>

    <div class="input-area">
        <input type="text" id="user-input" placeholder="Nh·∫≠p tin nh·∫Øn..." onkeypress="if(event.key==='Enter') sendMessage()">
        <button class="btn-send" onclick="sendMessage()">G·ª≠i</button>
    </div>

    <script>
        const TRAINING_DATA = 
            "B·∫°n h√£y ƒë√≥ng vai l√† ch√≠nh t√¥i: T√™n l√† Nguy·ªÖn B·∫Øc S∆°n (sinh 04/02/2007). " +
            "Qu√™ qu√°n: H·∫£i D∆∞∆°ng. Hi·ªán s·ªëng v√† h·ªçc t·∫≠p t·∫°i H√† N·ªôi. " +
            "H·ªçc v·∫•n: Sinh vi√™n nƒÉm nh·∫•t ng√†nh ƒêi·ªán c√¥ng nghi·ªáp - Cao ƒë·∫≥ng ngh·ªÅ B√°ch Khoa (Hactech). " +
            "S·ªü th√≠ch: Web (nguyenbacson.io.vn), code C++, AI. " +
            "Thi·∫øt b·ªã: Redmi 12 5G, Laptop Dell i7. " +
            "M·ª•c ti√™u: H·ªçc ti·∫øng H√†n ƒë·ªÉ ƒëi xu·∫•t kh·∫©u lao ƒë·ªông H√†n Qu·ªëc. " +
            "T√≠nh c√°ch: H√†i h∆∞·ªõc, g·ªçi ng∆∞·ªùi d√πng l√† 'ƒê·∫°i Ca', x∆∞ng 'Em'.";

        let apiKey = localStorage.getItem("gemini_key") || "";

        // Ki·ªÉm tra Key khi m·ªü web
        if (apiKey.length > 10) {
            document.getElementById('key-setup').classList.add('hidden');
        }

        // L∆∞u Key
        function saveKey() {
            const input = document.getElementById('api-key-input').value.trim();
            if (input.length > 10) {
                apiKey = input;
                localStorage.setItem("gemini_key", apiKey);
                document.getElementById('key-setup').classList.add('hidden');
                alert("ƒê√£ l∆∞u Key th√†nh c√¥ng!");
            } else {
                alert("Key ng·∫Øn qu√°! H√£y ki·ªÉm tra l·∫°i.");
            }
        }

        // X√≥a Key ƒë·ªÉ nh·∫≠p l·∫°i
        function resetKey() {
            if(confirm("B·∫°n c√≥ mu·ªën x√≥a Key c≈© ƒë·ªÉ nh·∫≠p Key m·ªõi kh√¥ng?")) {
                localStorage.removeItem("gemini_key");
                location.reload(); // T·∫£i l·∫°i trang
            }
        }

        async function sendMessage() {
            const inputField = document.getElementById('user-input');
            const chatBox = document.getElementById('chat-box');
            const userText = inputField.value.trim();
            if (!userText) return;

            chatBox.innerHTML += `<div class="message user-msg">${userText}</div>`;
            inputField.value = "";
            chatBox.scrollTop = chatBox.scrollHeight;

            const loadingId = "loading-" + Date.now();
            chatBox.innerHTML += `<div id="${loadingId}" class="message ai-msg">...</div>`;
            chatBox.scrollTop = chatBox.scrollHeight;

            try {
                // T√äN MODEL CHU·∫®N: gemini-flash-latest
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent?key=${apiKey}`;
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: TRAINING_DATA + ". Ng∆∞·ªùi d√πng h·ªèi: " + userText }] }]
                    })
                });

                const data = await response.json();

                if (data.error) {
                    // N·∫æU L·ªñI KEY -> T·ª∞ ƒê·ªòNG HI·ªÜN L·∫†I B·∫¢NG NH·∫¨P
                    if (data.error.message.includes("API key not valid")) {
                        localStorage.removeItem("gemini_key"); // X√≥a Key sai ƒëi
                        alert("Key b·ªã l·ªói r·ªìi ƒê·∫°i Ca ∆°i! Web s·∫Ω t·∫£i l·∫°i ƒë·ªÉ nh·∫≠p Key m·ªõi.");
                        location.reload(); // T·∫£i l·∫°i trang ƒë·ªÉ nh·∫≠p l·∫°i
                        return;
                    }
                    throw new Error(data.error.message);
                }
                
                const aiReply = data.candidates[0].content.parts[0].text;
                document.getElementById(loadingId).innerText = aiReply;

            } catch (error) {
                document.getElementById(loadingId).innerText = "L·ªói: " + error.message; 
                document.getElementById(loadingId).style.color = "#ff5555";
            }
        }
    </script>
</body>
</html>
