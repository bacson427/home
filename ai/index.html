<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Nguy·ªÖn B·∫Øc S∆°n</title>
    <style>
        /* GIAO DI·ªÜN DARK MODE */
        body { font-family: 'Segoe UI', sans-serif; background-color: #121212; color: #fff; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        .header { background-color: #1f1f1f; padding: 15px; text-align: center; border-bottom: 1px solid #333; }
        .header h2 { margin: 0; color: #4facfe; }
        #chat-box { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .message { max-width: 80%; padding: 10px 15px; border-radius: 20px; line-height: 1.4; word-wrap: break-word; }
        .user-msg { align-self: flex-end; background: #0072ff; color: white; }
        .ai-msg { align-self: flex-start; background: #2a2a2a; border: 1px solid #333; }
        .input-area { background: #1f1f1f; padding: 15px; display: flex; gap: 10px; }
        input { flex: 1; padding: 12px; border-radius: 20px; border: 1px solid #444; background: #2a2a2a; color: white; outline: none; }
        button { padding: 10px 20px; background: #0072ff; color: white; border: none; border-radius: 20px; cursor: pointer; }
        
        /* POPUP NH·∫¨P KEY */
        #key-setup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: flex; justify-content: center; align-items: center; z-index: 999; }
        .key-box { background: #222; padding: 30px; border-radius: 10px; text-align: center; border: 1px solid #444; width: 90%; max-width: 350px; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="key-setup">
        <div class="key-box">
            <h3>üîë K√≠ch ho·∫°t AI</h3>
            <p>Nh·∫≠p API Key c·ªßa b·∫°n ƒë·ªÉ b·∫Øt ƒë·∫ßu:</p>
            <input type="password" id="api-key-input" placeholder="D√°n m√£ AIza... v√†o ƒë√¢y">
            <br><br>
            <button onclick="saveKey()">L∆ØU KEY & CHAT</button>
        </div>
    </div>

    <div class="header">
        <h2>ü§ñ AI NGUY·ªÑN B·∫ÆC S∆†N</h2>
        <p>B·∫£n sao s·ªë (Digital Clone)</p>
    </div>

    <div id="chat-box">
        <div class="message ai-msg">Ch√†o ƒê·∫°i Ca! Em l√† S∆°n AI ƒë√¢y. ƒê·∫°i Ca mu·ªën h·ªèi g√¨?</div>
    </div>

    <div class="input-area">
        <input type="text" id="user-input" placeholder="Nh·∫≠p tin nh·∫Øn..." onkeypress="if(event.key==='Enter') sendMessage()">
        <button onclick="sendMessage()">G·ª≠i</button>
    </div>

    <script>
        // === D·ªÆ LI·ªÜU HU·∫§N LUY·ªÜN ===
        const TRAINING_DATA = 
            "B·∫°n h√£y ƒë√≥ng vai l√† ch√≠nh t√¥i: T√™n l√† Nguy·ªÖn B·∫Øc S∆°n (sinh 04/02/2007). " +
            "Qu√™ qu√°n: H·∫£i D∆∞∆°ng. Hi·ªán s·ªëng v√† h·ªçc t·∫≠p t·∫°i H√† N·ªôi. " +
            "H·ªçc v·∫•n: Sinh vi√™n nƒÉm nh·∫•t ng√†nh ƒêi·ªán c√¥ng nghi·ªáp - Cao ƒë·∫≥ng ngh·ªÅ B√°ch Khoa (Hactech). " +
            "S·ªü th√≠ch: Web (nguyenbacson.io.vn), code C++, AI. " +
            "Thi·∫øt b·ªã: Redmi 12 5G, Laptop Dell i7. " +
            "M·ª•c ti√™u: H·ªçc ti·∫øng H√†n ƒë·ªÉ ƒëi xu·∫•t kh·∫©u lao ƒë·ªông H√†n Qu·ªëc. " +
            "T√≠nh c√°ch: H√†i h∆∞·ªõc, g·ªçi ng∆∞·ªùi d√πng l√† 'ƒê·∫°i Ca', x∆∞ng 'Em'.";

        let apiKey = localStorage.getItem("gemini_key") || "";

        // Ki·ªÉm tra n·∫øu ƒë√£ t·ª´ng nh·∫≠p Key th√¨ b·ªè qua m√†n h√¨nh kh√≥a
        if (apiKey.length > 10) {
            document.getElementById('key-setup').classList.add('hidden');
        }

        function saveKey() {
            const input = document.getElementById('api-key-input').value.trim();
            if (input.length > 10) {
                apiKey = input;
                localStorage.setItem("gemini_key", apiKey); // L∆∞u v√†o tr√¨nh duy·ªát ƒë·ªÉ l·∫ßn sau ƒë·ª° ph·∫£i nh·∫≠p l·∫°i
                document.getElementById('key-setup').classList.add('hidden');
            } else {
                alert("Key ng·∫Øn qu√° ƒë·∫°i ca ∆°i! Ki·ªÉm tra l·∫°i ƒëi.");
            }
        }

        async function sendMessage() {
            const inputField = document.getElementById('user-input');
            const chatBox = document.getElementById('chat-box');
            const userText = inputField.value.trim();
            if (!userText) return;

            // Hi·ªán tin nh·∫Øn ng∆∞·ªùi d√πng
            chatBox.innerHTML += `<div class="message user-msg">${userText}</div>`;
            inputField.value = "";
            chatBox.scrollTop = chatBox.scrollHeight;

            // Hi·ªán tr·∫°ng th√°i ƒëang g√µ
            const loadingId = "loading-" + Date.now();
            chatBox.innerHTML += `<div id="${loadingId}" class="message ai-msg">...</div>`;
            chatBox.scrollTop = chatBox.scrollHeight;

            try {
                // === S·ª¨A QUAN TR·ªåNG: ƒê·ªîI T√äN MODEL TH√ÄNH gemini-flash-latest ===
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent?key=${apiKey}`;
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: TRAINING_DATA + ". Ng∆∞·ªùi d√πng h·ªèi: " + userText }] }]
                    })
                });

                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error.message); // B·∫Øt l·ªói t·ª´ Google tr·∫£ v·ªÅ
                }
                
                const aiReply = data.candidates[0].content.parts[0].text;
                document.getElementById(loadingId).innerText = aiReply;

            } catch (error) {
                console.error(error);
                // Hi·ªán l·ªói chi ti·∫øt ƒë·ªÉ d·ªÖ s·ª≠a
                document.getElementById(loadingId).innerText = "L·ªói: " + error.message; 
                document.getElementById(loadingId).style.color = "#ff4444";
            }
        }
    </script>
</body>
</html>
