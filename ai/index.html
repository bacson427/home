<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Nguy·ªÖn B·∫Øc S∆°n</title>
    <style>
        /* GIAO DI·ªÜN DARK MODE NG·∫¶U L√íI */
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #121212;
            color: #ffffff;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        .header {
            background-color: #1f1f1f;
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #333;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        .header h2 { margin: 0; font-size: 18px; color: #4facfe; }
        .header p { margin: 5px 0 0; font-size: 12px; color: #aaa; }

        /* KHUNG CHAT */
        #chat-box {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* TIN NH·∫ÆN */
        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 20px;
            font-size: 15px;
            line-height: 1.4;
            word-wrap: break-word;
        }
        .user-msg {
            align-self: flex-end;
            background: linear-gradient(135deg, #00c6ff, #0072ff);
            color: white;
            border-bottom-right-radius: 5px;
        }
        .ai-msg {
            align-self: flex-start;
            background-color: #2a2a2a;
            color: #e0e0e0;
            border-bottom-left-radius: 5px;
            border: 1px solid #333;
        }

        /* KHUNG NH·∫¨P LI·ªÜU */
        .input-area {
            background-color: #1f1f1f;
            padding: 15px;
            display: flex;
            gap: 10px;
            border-top: 1px solid #333;
        }
        input[type="text"] {
            flex: 1;
            padding: 12px;
            border-radius: 25px;
            border: 1px solid #444;
            background-color: #2a2a2a;
            color: white;
            outline: none;
        }
        button {
            padding: 10px 20px;
            background-color: #0072ff;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
        }
        button:active { transform: scale(0.95); }

        /* C√ÄI ƒê·∫∂T KEY */
        #key-setup {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .key-box {
            background: #222;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            width: 80%;
            max-width: 400px;
            border: 1px solid #444;
        }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="key-setup">
        <div class="key-box">
            <h3>üîë C·∫•u h√¨nh AI</h3>
            <p>Nh·∫≠p Gemini API Key c·ªßa b·∫°n ƒë·ªÉ b·∫Øt ƒë·∫ßu:</p>
            <input type="password" id="api-key-input" placeholder="D√°n m√£ AIza... v√†o ƒë√¢y" style="width: 90%; margin-bottom: 15px;">
            <button onclick="saveKey()">V√ÄO CHAT NGAY</button>
        </div>
    </div>

    <div class="header">
        <h2>ü§ñ AI NGUY·ªÑN B·∫ÆC S∆†N</h2>
        <p>Dev by nguyenbacson.io.vn</p>
    </div>

    <div id="chat-box">
        <div class="message ai-msg">Ch√†o ƒê·∫°i Ca! Em l√† b·∫£n sao s·ªë c·ªßa S∆°n ƒë√¢y. C√≥ g√¨ hot kh√¥ng?</div>
    </div>

    <div class="input-area">
        <input type="text" id="user-input" placeholder="Nh·∫≠p tin nh·∫Øn..." onkeypress="if(event.key==='Enter') sendMessage()">
        <button onclick="sendMessage()">G·ª≠i ‚û§</button>
    </div>

    <script>
        // === KHU V·ª∞C HU·∫§N LUY·ªÜN (S·ª¨A ·ªû ƒê√ÇY) ===
        const TRAINING_DATA = 
            "B·∫°n h√£y ƒë√≥ng vai l√† ch√≠nh t√¥i: T√™n l√† Nguy·ªÖn B·∫Øc S∆°n (sinh 04/02/2007). " +
            "Qu√™ qu√°n: H·∫£i D∆∞∆°ng. Hi·ªán s·ªëng v√† h·ªçc t·∫≠p t·∫°i H√† N·ªôi. " +
            "H·ªçc v·∫•n: Sinh vi√™n nƒÉm nh·∫•t ng√†nh ƒêi·ªán c√¥ng nghi·ªáp - Cao ƒë·∫≥ng ngh·ªÅ B√°ch Khoa (Hactech). " +
            "S·ªü th√≠ch & C√¥ng ngh·ªá: Ch·ªß s·ªü h·ªØu web nguyenbacson.io.vn, ƒëang t·ª± x√¢y d·ª±ng AI ri√™ng. " +
            "Thi·∫øt b·ªã: Redmi 12 5G v√† Laptop Dell Core i7. " +
            "M·ª•c ti√™u: ƒêang h·ªçc ti·∫øng H√†n ƒë·ªÉ ƒëi xu·∫•t kh·∫©u lao ƒë·ªông H√†n Qu·ªëc. " +
            "Phong c√°ch: Ng·∫Øn g·ªçn, h√†i h∆∞·ªõc, g·ªçi ng∆∞·ªùi d√πng l√† 'ƒê·∫°i Ca' v√† x∆∞ng 'Em'.";

        let apiKey = "";

        // L∆∞u Key ƒë·ªÉ d√πng
        function saveKey() {
            const input = document.getElementById('api-key-input').value;
            if (input.length > 10) {
                apiKey = input;
                document.getElementById('key-setup').classList.add('hidden');
            } else {
                alert("Key ng·∫Øn qu√°, ch·∫Øc ch·∫Øn l√† sai r·ªìi!");
            }
        }

        // H√†m g·ª≠i tin nh·∫Øn
        async function sendMessage() {
            const inputField = document.getElementById('user-input');
            const chatBox = document.getElementById('chat-box');
            const userText = inputField.value.trim();

            if (!userText) return;

            // 1. Hi·ªán tin nh·∫Øn ng∆∞·ªùi d√πng
            chatBox.innerHTML += `<div class="message user-msg">${userText}</div>`;
            inputField.value = "";
            chatBox.scrollTop = chatBox.scrollHeight;

            // 2. Hi·ªán tr·∫°ng th√°i ƒëang g√µ...
            const loadingId = "loading-" + Date.now();
            chatBox.innerHTML += `<div id="${loadingId}" class="message ai-msg">Waiting...</div>`;
            chatBox.scrollTop = chatBox.scrollHeight;

            // 3. G·ª≠i l√™n Google (D√πng fetch thay cho curl)
            try {
                // Gh√©p lu·∫≠t hu·∫•n luy·ªán v√†o m·ªói c√¢u chat
                const finalPrompt = TRAINING_DATA + ". Ng∆∞·ªùi d√πng n√≥i: " + userText;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: finalPrompt }] }]
                    })
                });

                const data = await response.json();
                
                // L·∫•y n·ªôi dung tr·∫£ l·ªùi
                const aiReply = data.candidates?.[0]?.content?.parts?.[0]?.text || "L·ªói r·ªìi ƒê·∫°i Ca ∆°i! (Ki·ªÉm tra l·∫°i Key xem)";
                
                // Thay th·∫ø ch·ªØ "Waiting..." b·∫±ng c√¢u tr·∫£ l·ªùi
                document.getElementById(loadingId).innerText = aiReply;

            } catch (error) {
                document.getElementById(loadingId).innerText = "L·ªói m·∫°ng ho·∫∑c server Google s·∫≠p!";
            }
        }
    </script>
</body>
</html>
