<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω C√¥ng v√† S·∫£n l∆∞·ª£ng</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            padding: 10px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            background: linear-gradient(135deg, #1e5799 0%, #207cca 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        h1 {
            margin-bottom: 10px;
            font-size: 1.8rem;
        }
        
        .login-section {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            max-width: 400px;
            margin: 20px auto;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            font-size: 14px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        button {
            background-color: #1e5799;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background-color 0.3s;
            width: 100%;
        }
        
        button:hover {
            background-color: #154275;
        }
        
        .main-section {
            display: none;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -8px;
        }
        
        .form-col {
            flex: 1;
            padding: 0 8px;
            min-width: 200px;
            margin-bottom: 10px;
        }
        
        .image-upload {
            border: 2px dashed #ddd;
            padding: 15px;
            text-align: center;
            border-radius: 5px;
            margin-bottom: 10px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .image-upload:hover {
            border-color: #1e5799;
            background-color: #f8f9fa;
        }
        
        .image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }
        
        .image-preview img {
            width: 80px;
            height: 80px;
            border-radius: 5px;
            object-fit: cover;
            border: 1px solid #ddd;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 14px;
        }
        
        .data-table th, .data-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        
        .data-table th {
            background-color: #f2f2f2;
            font-weight: 600;
            font-size: 13px;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .btn-export {
            background-color: #28a745;
        }
        
        .btn-export:hover {
            background-color: #218838;
        }
        
        .btn-logout {
            background-color: #dc3545;
        }
        
        .btn-logout:hover {
            background-color: #c82333;
        }
        
        .hidden {
            display: none;
        }
        
        .error-message {
            color: #dc3545;
            margin-top: 5px;
            font-size: 13px;
            text-align: center;
        }
        
        .success-message {
            color: #28a745;
            margin-top: 5px;
            font-size: 13px;
            text-align: center;
        }
        
        .btn-delete {
            background-color: #dc3545;
            padding: 5px 10px;
            font-size: 12px;
            width: auto;
        }
        
        .btn-delete:hover {
            background-color: #c82333;
        }
        
        .debug-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 12px;
            color: #856404;
        }
        
        .export-options {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .export-btn {
            flex: 1;
            min-width: 150px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 5px;
            }
            
            header {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .main-section, .login-section {
                padding: 15px;
            }
            
            .form-col {
                min-width: 100%;
            }
            
            .data-table {
                font-size: 12px;
            }
            
            .data-table th, .data-table td {
                padding: 6px;
            }
            
            .export-options {
                flex-direction: column;
            }
        }
        
        @media (max-width: 480px) {
            .action-buttons {
                flex-direction: column;
            }
            
            .image-preview img {
                width: 60px;
                height: 60px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>H·ªÜ TH·ªêNG T√çNH C√îNG V√Ä S·∫¢N L∆Ø·ª¢NG</h1>
            <p>Qu·∫£n l√Ω d·ªØ li·ªáu c√¥ng vi·ªác v√† s·∫£n l∆∞·ª£ng s·∫£n ph·∫©m</p>
        </header>
        
        <section id="loginSection" class="login-section">
            <h2>ƒêƒÉng nh·∫≠p h·ªá th·ªëng</h2>
            <div class="form-group">
                <label for="userId">ID ƒëƒÉng nh·∫≠p</label>
                <input type="text" id="userId" placeholder="Nh·∫≠p ID ƒëƒÉng nh·∫≠p" value="0388427368">
            </div>
            <div class="form-group">
                <label for="password">M·∫≠t kh·∫©u</label>
                <input type="password" id="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" value="@Van2007">
            </div>
            <button id="loginBtn">ƒêƒÉng nh·∫≠p</button>
            <div id="loginMessage" class="error-message"></div>
            <div id="debugInfo" class="debug-info" style="display: none;"></div>
        </section>

    <section id="mainSection" class="main-section">
        <h2>Nh·∫≠p d·ªØ li·ªáu c√¥ng vi·ªác</h2>
        <form id="workForm">
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="name">T√™n nh√¢n vi√™n *</label>
                        <input type="text" id="name" required>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="date">Ng√†y th√°ng nƒÉm *</label>
                        <input type="date" id="date" required>
                    </div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="startImage">·∫¢nh b·∫Øt ƒë·∫ßu *</label>
                        <div class="image-upload" id="startImageUpload">
                            <p>üì∑ Nh·∫•p ƒë·ªÉ t·∫£i ·∫£nh l√™n</p>
                            <input type="file" id="startImage" accept="image/*" class="hidden" multiple>
                        </div>
                        <div id="startImagePreview" class="image-preview"></div>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="endImage">·∫¢nh k·∫øt th√∫c *</label>
                        <div class="image-upload" id="endImageUpload">
                            <p>üì∑ Nh·∫•p ƒë·ªÉ t·∫£i ·∫£nh l√™n</p>
                            <input type="file" id="endImage" accept="image/*" class="hidden" multiple>
                        </div>
                        <div id="endImagePreview" class="image-preview"></div>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="additionalImage">·∫¢nh b·ªï sung (t√πy ch·ªçn)</label>
                <div class="image-upload" id="additionalImageUpload">
                    <p>üì∑ Nh·∫•p ƒë·ªÉ t·∫£i ·∫£nh b·ªï sung</p>
                    <input type="file" id="additionalImage" accept="image/*" class="hidden" multiple>
                </div>
                <div id="additionalImagePreview" class="image-preview"></div>
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="workType">C√¥ng vi·ªác *</label>
                        <select id="workType" required>
                            <option value="">-- Ch·ªçn c√¥ng vi·ªác --</option>
                            <option value="nhap_du_lieu">Nh·∫≠p d·ªØ li·ªáu</option>
                            <option value="ham_ech">H√†m ·∫øch</option>
                            <option value="san_luong">S·∫£n l∆∞·ª£ng</option>
                            <option value="them">Th√™m</option>
                            <option value="ham_ech_tinh_theo_san_pham">H√†m ·∫øch t√≠nh theo s·∫£n ph·∫©m</option>
                            <option value="nhap_du_lieu_tinh_theo_to">Nh·∫≠p d·ªØ li·ªáu t√≠nh theo t·ªù</option>
                            <option value="khac">Kh√°c</option>
                        </select>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="quantity">S·ªë l∆∞·ª£ng</label>
                        <input type="number" id="quantity" min="0" step="1" placeholder="0">
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="notes">Ghi ch√∫</label>
                <textarea id="notes" rows="2" placeholder="Nh·∫≠p ghi ch√∫ n·∫øu c√≥..."></textarea>
            </div>
            
            <button type="submit">‚ûï Th√™m d·ªØ li·ªáu</button>
            <div id="formMessage" class="success-message"></div>
        </form>
        
        <h2>D·ªØ li·ªáu ƒë√£ nh·∫≠p</h2>
        <div style="overflow-x: auto;">
            <table class="data-table" id="dataTable">
                <thead>
                    <tr>
                        <th>T√™n</th>
                        <th>Ng√†y</th>
                        <th>C√¥ng vi·ªác</th>
                        <th>S·ªë l∆∞·ª£ng</th>
                        <th>·∫¢nh b·∫Øt ƒë·∫ßu</th>
                        <th>·∫¢nh k·∫øt th√∫c</th>
                        <th>·∫¢nh b·ªï sung</th>
                        <th>Ghi ch√∫</th>
                        <th>H√†nh ƒë·ªông</th>
                    </tr>
                </thead>
                <tbody id="dataTableBody">
                    <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
                </tbody>
            </table>
        </div>
        
        <h3>Xu·∫•t d·ªØ li·ªáu</h3>
        <div class="export-options">
            <button id="exportExcelBtn" class="btn-export export-btn">üìä Xu·∫•t Excel (.xlsx)</button>
            <button id="exportCSVBtn" class="btn-export export-btn" style="background-color: #17a2b8;">üìÑ Xu·∫•t CSV</button>
            <button id="exportPDFBtn" class="btn-export export-btn" style="background-color: #dc3545;">üìã Xu·∫•t PDF</button>
        </div>
        
        <div class="action-buttons">
            <button id="clearDataBtn" class="btn-logout" style="background-color: #ffc107; color: #000;">üóëÔ∏è X√≥a to√†n b·ªô d·ªØ li·ªáu</button>
            <button id="logoutBtn" class="btn-logout">üö™ ƒêƒÉng xu·∫•t</button>
        </div>
    </section>
</div>
<script>
    // ===== PH·∫¶N JAVASCRIPT =====
    document.addEventListener('DOMContentLoaded', function() {
        // Bi·∫øn to√†n c·ª•c
        let workData = [];
        
        // Th√¥ng tin ƒëƒÉng nh·∫≠p
        const ADMIN_ID = '0388427368';
        const ADMIN_PASSWORD = '@Van2007';
        
        console.log('Th√¥ng tin ƒëƒÉng nh·∫≠p:', {
            id: ADMIN_ID,
            password: ADMIN_PASSWORD
        });
        
        // Tham chi·∫øu ƒë·∫øn c√°c ph·∫ßn t·ª≠ DOM
        const loginSection = document.getElementById('loginSection');
        const mainSection = document.getElementById('mainSection');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const clearDataBtn = document.getElementById('clearDataBtn');
        const userIdInput = document.getElementById('userId');
        const passwordInput = document.getElementById('password');
        const loginMessage = document.getElementById('loginMessage');
        const debugInfo = document.getElementById('debugInfo');
        const workForm = document.getElementById('workForm');
        const dataTableBody = document.getElementById('dataTableBody');
        const exportExcelBtn = document.getElementById('exportExcelBtn');
        const exportCSVBtn = document.getElementById('exportCSVBtn');
        const exportPDFBtn = document.getElementById('exportPDFBtn');
        
        // Hi·ªÉn th·ªã th√¥ng tin debug
        function showDebugInfo(message) {
            debugInfo.style.display = 'block';
            debugInfo.innerHTML = '<strong>Debug:</strong> ' + message;
            console.log('Debug:', message);
        }
        
        // Thi·∫øt l·∫≠p ng√†y m·∫∑c ƒë·ªãnh l√† h√¥m nay
        document.getElementById('date').valueAsDate = new Date();
        
        // X·ª≠ l√Ω s·ª± ki·ªán ƒëƒÉng nh·∫≠p
        loginBtn.addEventListener('click', handleLogin);
        
        // Cho ph√©p ƒëƒÉng nh·∫≠p b·∫±ng ph√≠m Enter
        passwordInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                handleLogin();
            }
        });
        
        function handleLogin() {
            const userId = userIdInput.value.trim();
            const password = passwordInput.value.trim();
            
            showDebugInfo(`Nh·∫≠p: ID='${userId}', Password='${password}' | Mong ƒë·ª£i: ID='${ADMIN_ID}', Password='${ADMIN_PASSWORD}'`);
            
            if (userId === ADMIN_ID && password === ADMIN_PASSWORD) {
                showDebugInfo('‚úÖ ƒêƒÉng nh·∫≠p TH√ÄNH C√îNG!');
                loginSection.style.display = 'none';
                mainSection.style.display = 'block';
                loginMessage.textContent = '';
                loadWorkData();
            } else {
                let errorMsg = 'ID ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!';
                
                if (userId !== ADMIN_ID) {
                    errorMsg += ' (Sai ID)';
                } else if (password !== ADMIN_PASSWORD) {
                    errorMsg += ' (Sai m·∫≠t kh·∫©u)';
                }
                
                loginMessage.textContent = errorMsg;
                showDebugInfo('‚ùå ƒêƒÉng nh·∫≠p TH·∫§T B·∫†I: ' + errorMsg);
                userIdInput.focus();
            }
        }
        
        // X·ª≠ l√Ω s·ª± ki·ªán ƒëƒÉng xu·∫•t
        logoutBtn.addEventListener('click', function() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) {
                mainSection.style.display = 'none';
                loginSection.style.display = 'block';
                userIdInput.value = '';
                passwordInput.value = '';
                debugInfo.style.display = 'none';
                userIdInput.focus();
            }
        });
        
        // X·ª≠ l√Ω x√≥a to√†n b·ªô d·ªØ li·ªáu
        clearDataBtn.addEventListener('click', function() {
            if (confirm('‚ö†Ô∏è B·∫°n c√≥ CH·∫ÆC CH·∫ÆN mu·ªën x√≥a TO√ÄN B·ªò d·ªØ li·ªáu? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!')) {
                workData = [];
                localStorage.removeItem('workData');
                updateDataTable();
                alert('ƒê√£ x√≥a to√†n b·ªô d·ªØ li·ªáu!');
            }
        });
            // X·ª≠ l√Ω upload ·∫£nh
            const imageUploads = [
                { upload: 'startImageUpload', input: 'startImage', preview: 'startImagePreview', type: 'start' },
                { upload: 'endImageUpload', input: 'endImage', preview: 'endImagePreview', type: 'end' },
                { upload: 'additionalImageUpload', input: 'additionalImage', preview: 'additionalImagePreview', type: 'additional' }
            ];
            
            let currentImages = {
                start: [],
                end: [],
                additional: []
            };
            
            imageUploads.forEach(item => {
                const uploadElement = document.getElementById(item.upload);
                const inputElement = document.getElementById(item.input);
                const previewElement = document.getElementById(item.preview);
                
                uploadElement.addEventListener('click', function() {
                    inputElement.click();
                });
                
                inputElement.addEventListener('change', function() {
                    previewElement.innerHTML = '';
                    currentImages[item.type] = [];
                    
                    if (inputElement.files) {
                        Array.from(inputElement.files).forEach(file => {
                            if (file.type.startsWith('image/')) {
                                const reader = new FileReader();
                                reader.onload = function(e) {
                                    currentImages[item.type].push({
                                        name: file.name,
                                        data: e.target.result,
                                        type: file.type,
                                        size: file.size
                                    });
                                    
                                    const img = document.createElement('img');
                                    img.src = e.target.result;
                                    img.title = file.name;
                                    previewElement.appendChild(img);
                                };
                                reader.readAsDataURL(file);
                            }
                        });
                    }
                });
            });
            
            // X·ª≠ l√Ω form th√™m d·ªØ li·ªáu
            workForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('name').value.trim();
                const date = document.getElementById('date').value;
                const workType = document.getElementById('workType').value;
                const quantity = document.getElementById('quantity').value || '0';
                const notes = document.getElementById('notes').value.trim();
                
                if (currentImages.start.length === 0 || currentImages.end.length === 0) {
                    alert('‚ö†Ô∏è Vui l√≤ng t·∫£i l√™n ·∫£nh b·∫Øt ƒë·∫ßu v√† ·∫£nh k·∫øt th√∫c!');
                    return;
                }
                
                if (!workType) {
                    alert('‚ö†Ô∏è Vui l√≤ng ch·ªçn lo·∫°i c√¥ng vi·ªác!');
                    return;
                }
                
                const workItem = {
                    id: Date.now(),
                    name: name,
                    date: date,
                    workType: workType,
                    quantity: quantity,
                    notes: notes,
                    startImages: currentImages.start,
                    endImages: currentImages.end,
                    additionalImages: currentImages.additional
                };
                
                workData.push(workItem);
                saveWorkData();
                updateDataTable();
                
                workForm.reset();
                document.getElementById('startImagePreview').innerHTML = '';
                document.getElementById('endImagePreview').innerHTML = '';
                document.getElementById('additionalImagePreview').innerHTML = '';
                document.getElementById('date').valueAsDate = new Date();
                
                currentImages = {
                    start: [],
                    end: [],
                    additional: []
                };
                
                document.getElementById('formMessage').textContent = '‚úÖ ƒê√£ th√™m d·ªØ li·ªáu th√†nh c√¥ng!';
                setTimeout(() => {
                    document.getElementById('formMessage').textContent = '';
                }, 3000);
            });
            
            // Xu·∫•t file Excel (.xlsx) - S·ª¨ D·ª§NG TH∆Ø VI·ªÜN SheetJS
            exportExcelBtn.addEventListener('click', function() {
                if (workData.length === 0) {
                    alert('üì≠ Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t!');
                    return;
                }
                
                // T·∫°o workbook Excel
                const wb = XLSX.utils.book_new();
                
                // T·∫°o d·ªØ li·ªáu worksheet
                const wsData = [
                    ['D·ªÆ LI·ªÜU C√îNG VI·ªÜC', '', '', '', '', '', '', ''],
                    ['Xu·∫•t ng√†y:', new Date().toLocaleDateString('vi-VN'), '', '', '', '', '', ''],
                    [], // D√≤ng tr·ªëng
                    ['STT', 'T√™n nh√¢n vi√™n', 'Ng√†y l√†m vi·ªác', 'C√¥ng vi·ªác', 'S·ªë l∆∞·ª£ng', 'S·ªë ·∫£nh b·∫Øt ƒë·∫ßu', 'S·ªë ·∫£nh k·∫øt th√∫c', 'S·ªë ·∫£nh b·ªï sung', 'Ghi ch√∫']
                ];
                
                // Th√™m d·ªØ li·ªáu
                workData.forEach((item, index) => {
                    wsData.push([
                        index + 1,
                        item.name,
                        formatDate(item.date),
                        getWorkTypeLabel(item.workType),
                        item.quantity,
                        item.startImages.length,
                        item.endImages.length,
                        item.additionalImages.length,
                        item.notes || ''
                    ]);
                });
                
                const ws = XLSX.utils.aoa_to_sheet(wsData);
                
                // Thi·∫øt l·∫≠p ƒë·ªô r·ªông c·ªôt
                const colWidths = [
                    { wch: 5 },  // STT
                    { wch: 20 }, // T√™n
                    { wch: 12 }, // Ng√†y
                    { wch: 25 }, // C√¥ng vi·ªác
                    { wch: 10 }, // S·ªë l∆∞·ª£ng
                    { wch: 15 }, // ·∫¢nh b·∫Øt ƒë·∫ßu
                    { wch: 15 }, // ·∫¢nh k·∫øt th√∫c
                    { wch: 15 }, // ·∫¢nh b·ªï sung
                    { wch: 30 }  // Ghi ch√∫
                ];
                ws['!cols'] = colWidths;
                
                // Th√™m worksheet v√†o workbook
                XLSX.utils.book_append_sheet(wb, ws, 'CongViec');
                
                // Xu·∫•t file
                const timestamp = new Date().toISOString().slice(0,10).replace(/-/g, '');
                XLSX.writeFile(wb, `cong_viec_${timestamp}.xlsx`);
                
                alert('‚úÖ ƒê√£ xu·∫•t file Excel th√†nh c√¥ng!\n\nüìù File .xlsx t∆∞∆°ng th√≠ch v·ªõi:\n‚Ä¢ Microsoft Excel 2007+\n‚Ä¢ Google Sheets\n‚Ä¢ LibreOffice\n‚Ä¢ WPS Office');
            });
            
            // Xu·∫•t file CSV v·ªõi UTF-8 BOM
            exportCSVBtn.addEventListener('click', function() {
                if (workData.length === 0) {
                    alert('üì≠ Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t!');
                    return;
                }
                
                const BOM = '\uFEFF';
                let csvContent = BOM + "STT,T√™n nh√¢n vi√™n,Ng√†y l√†m vi·ªác,C√¥ng vi·ªác,S·ªë l∆∞·ª£ng,S·ªë ·∫£nh b·∫Øt ƒë·∫ßu,S·ªë ·∫£nh k·∫øt th√∫c,S·ªë ·∫£nh b·ªï sung,Ghi ch√∫\n";
                
                workData.forEach((item, index) => {
                    const row = [
                        index + 1,
                        `"${item.name}"`,
                        `"${formatDate(item.date)}"`,
                        `"${getWorkTypeLabel(item.workType)}"`,
                        `"${item.quantity}"`,
                        `"${item.startImages.length}"`,
                        `"${item.endImages.length}"`,
                        `"${item.additionalImages.length}"`,
                        `"${item.notes || ''}"`
                    ].join(',');
                    csvContent += row + '\n';
                });
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.setAttribute('href', url);
                const timestamp = new Date().toISOString().slice(0,10).replace(/-/g, '');
                link.setAttribute('download', `cong_viec_${timestamp}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                alert('‚úÖ ƒê√£ xu·∫•t file CSV th√†nh c√¥ng!\n\nüìù H∆∞·ªõng d·∫´n m·ªü CSV:\n1. M·ªü Excel ‚Üí Data ‚Üí From Text/CSV\n2. Ch·ªçn file CSV\n3. Ch·ªçn encoding: Unicode (UTF-8)\n4. Load ‚Üí ƒê·∫£m b·∫£o ti·∫øng Vi·ªát hi·ªÉn th·ªã ƒë√∫ng');
            });
            
            // Xu·∫•t file PDF
            exportPDFBtn.addEventListener('click', function() {
                if (workData.length === 0) {
                    alert('üì≠ Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t!');
                    return;
                }
                
                // T·∫°o n·ªôi dung HTML cho PDF
                let htmlContent = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <title>B√°o c√°o c√¥ng vi·ªác</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            h1 { color: #1e5799; text-align: center; }
                            table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                            th, td { border: 1px solid #000; padding: 8px; text-align: left; }
                            th { background-color: #f2f2f2; font-weight: bold; }
                            .header { text-align: center; margin-bottom: 20px; }
                            .footer { margin-top: 30px; text-align: right; font-size: 12px; }
                        </style>
                    </head>
                    <body>
                    <div class="header">
                        <h1>B√ÅO C√ÅO C√îNG VI·ªÜC</h1>
                        <p>Ng√†y xu·∫•t: ${new Date().toLocaleDateString('vi-VN')}</p>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>T√™n nh√¢n vi√™n</th>
                                <th>Ng√†y l√†m vi·ªác</th>
                                <th>C√¥ng vi·ªác</th>
                                <th>S·ªë l∆∞·ª£ng</th>
                                <th>·∫¢nh b·∫Øt ƒë·∫ßu</th>
                                <th>·∫¢nh k·∫øt th√∫c</th>
                                <th>·∫¢nh b·ªï sung</th>
                                <th>Ghi ch√∫</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                workData.forEach((item, index) => {
                    htmlContent += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${item.name}</td>
                            <td>${formatDate(item.date)}</td>
                            <td>${getWorkTypeLabel(item.workType)}</td>
                            <td>${item.quantity}</td>
                            <td>${item.startImages.length}</td>
                            <td>${item.endImages.length}</td>
                            <td>${item.additionalImages.length}</td>
                            <td>${item.notes || ''}</td>
                        </tr>
                    `;
                });
                
                htmlContent += `
                        </tbody>
                    </table>
                    <div class="footer">
                        <p>T·ªïng s·ªë b·∫£n ghi: ${workData.length}</p>
                    </div>
                    </body>
                    </html>
                `;
                
                // M·ªü c·ª≠a s·ªï in ƒë·ªÉ xu·∫•t PDF
                const printWindow = window.open('', '_blank');
                printWindow.document.write(htmlContent);
                printWindow.document.close();
                printWindow.print();
            });
            
            // H√†m l∆∞u d·ªØ li·ªáu v√†o localStorage
            function saveWorkData() {
                const workDataToSave = workData.map(item => ({
                    ...item,
                    startImages: item.startImages.map(img => ({ name: img.name, size: img.size })),
                    endImages: item.endImages.map(img => ({ name: img.name, size: img.size })),
                    additionalImages: item.additionalImages.map(img => ({ name: img.name, size: img.size }))
                }));
                localStorage.setItem('workData', JSON.stringify(workDataToSave));
            }
            
            // H√†m t·∫£i d·ªØ li·ªáu t·ª´ localStorage
            function loadWorkData() {
                const savedData = localStorage.getItem('workData');
                if (savedData) {
                    try {
                        workData = JSON.parse(savedData);
                        updateDataTable();
                    } catch (e) {
                        console.error('L·ªói ƒë·ªçc d·ªØ li·ªáu:', e);
                        workData = [];
                    }
                }
            }
            
            // H√†m c·∫≠p nh·∫≠t b·∫£ng d·ªØ li·ªáu
            function updateDataTable() {
                dataTableBody.innerHTML = '';
                
                if (workData.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td colspan="9" style="text-align: center; padding: 20px; color: #666;">üìù Ch∆∞a c√≥ d·ªØ li·ªáu n√†o ƒë∆∞·ª£c th√™m</td>`;
                    dataTableBody.appendChild(row);
                    return;
                }
                
                workData.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                workData.forEach(item => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${item.name}</td>
                        <td>${formatDate(item.date)}</td>
                        <td>${getWorkTypeLabel(item.workType)}</td>
                        <td style="text-align: center;">${item.quantity}</td>
                        <td style="text-align: center;">${item.startImages.length} ·∫£nh</td>
                        <td style="text-align: center;">${item.endImages.length} ·∫£nh</td>
                        <td style="text-align: center;">${item.additionalImages.length} ·∫£nh</td>
                        <td>${item.notes || 'Kh√¥ng c√≥'}</td>
                        <td style="text-align: center;">
                            <button class="btn-delete" data-id="${item.id}">üóëÔ∏è X√≥a</button>
                        </td>
                    `;
                    
                    dataTableBody.appendChild(row);
                });
                
                document.querySelectorAll('.btn-delete').forEach(button => {
                    button.addEventListener('click', function() {
                        const id = parseInt(this.getAttribute('data-id'));
                        const item = workData.find(item => item.id === id);
                        if (confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a d·ªØ li·ªáu c·ªßa "${item.name}" ng√†y ${formatDate(item.date)}?`)) {
                            workData = workData.filter(item => item.id !== id);
                            saveWorkData();
                            updateDataTable();
                        }
                    });
                });
            }
            
            // H√†m chuy·ªÉn ƒë·ªïi m√£ c√¥ng vi·ªác th√†nh nh√£n
            function getWorkTypeLabel(workType) {
                const workTypes = {
                    'nhap_du_lieu': 'Nh·∫≠p d·ªØ li·ªáu',
                    'ham_ech': 'H√†m ·∫øch',
                    'san_luong': 'S·∫£n l∆∞·ª£ng',
                    'them': 'Th√™m',
                    'ham_ech_tinh_theo_san_pham': 'H√†m ·∫øch t√≠nh theo s·∫£n ph·∫©m',
                    'nhap_du_lieu_tinh_theo_to': 'Nh·∫≠p d·ªØ li·ªáu t√≠nh theo t·ªù',
                    'khac': 'Kh√°c'
                };
                return workTypes[workType] || workType;
            }
            
            // H√†m ƒë·ªãnh d·∫°ng ng√†y
            function formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('vi-VN');
            }
            
            // T·ª± ƒë·ªông ƒëƒÉng nh·∫≠p n·∫øu ƒë√£ ƒëƒÉng nh·∫≠p tr∆∞·ªõc ƒë√≥
            function checkAutoLogin() {
                const savedData = localStorage.getItem('workData');
                if (savedData) {
                    showDebugInfo('ƒê√£ t√¨m th·∫•y d·ªØ li·ªáu c≈©, c√≥ th·ªÉ t·ª± ƒë·ªông ƒëƒÉng nh·∫≠p...');
                }
            }
            
            // Ki·ªÉm tra auto login khi trang load
            checkAutoLogin();
        });
    </script>
    
    <!-- Th√™m th∆∞ vi·ªán SheetJS ƒë·ªÉ xu·∫•t Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</body>
</html>