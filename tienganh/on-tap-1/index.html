<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Listening Exam - Hactech</title>
    <style>
        :root {
            --primary: #4834d4;       /* M√†u ch·ªß ƒë·∫°o (Xanh t√≠m hi·ªán ƒë·∫°i) */
            --secondary: #686de0;
            --bg-color: #f1f2f6;      /* M√†u n·ªÅn d·ªãu m·∫Øt */
            --sidebar-bg: #ffffff;
            --text-color: #2f3542;
            --success: #6ab04c;
            --danger: #eb4d4b;
            --accent: #f0932b;
        }

        * { box-sizing: border-box; }
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; margin: 0; display: flex; height: 100vh; background-color: var(--bg-color); color: var(--text-color); overflow: hidden; }

        /* --- SIDEBAR (B√™n tr√°i) --- */
        .sidebar {
            width: 280px; background: var(--sidebar-bg); border-right: 1px solid #dfe4ea;
            display: flex; flex-direction: column; padding: 20px; box-shadow: 2px 0 10px rgba(0,0,0,0.02); z-index: 10;
        }
        
        .timer-box {
            background: linear-gradient(135deg, var(--danger), #ff7979); color: white;
            padding: 15px; border-radius: 12px; text-align: center; font-size: 2rem; font-weight: 800;
            margin-bottom: 25px; box-shadow: 0 4px 15px rgba(235, 77, 75, 0.3); letter-spacing: 1px;
        }

        .map-title { font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; color: #a4b0be; margin-bottom: 10px; font-weight: bold; }
        
        .question-grid {
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; overflow-y: auto; padding-right: 5px;
        }
        .q-node {
            aspect-ratio: 1; border: 1px solid #ced6e0; border-radius: 8px; background: #f1f2f6;
            display: flex; align-items: center; justify-content: center; font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: all 0.2s ease;
        }
        .q-node:hover { transform: translateY(-2px); border-color: var(--primary); color: var(--primary); }
        .q-node.active { background: var(--primary); color: white; border-color: var(--primary); }
        .q-node.correct { background: var(--success); color: white; border-color: var(--success); }
        .q-node.wrong { background: var(--danger); color: white; border-color: var(--danger); }

        /* --- MAIN CONTENT (B√™n ph·∫£i) --- */
        .main-wrapper { flex: 1; display: flex; flex-direction: column; position: relative; }

        /* Header */
        .top-header {
            background: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #dfe4ea;
        }
        .exam-title { font-size: 1.4rem; font-weight: 800; color: var(--primary); }
        .candidate-info { font-size: 1rem; color: #57606f; background: #f1f2f6; padding: 8px 15px; border-radius: 20px; }

        /* Scroll Area */
        .exam-content { flex: 1; overflow-y: auto; padding: 40px; scroll-behavior: smooth; }
        .exam-paper { max-width: 850px; margin: 0 auto; padding-bottom: 60px; }

        /* Section Styling */
        .part-divider {
            margin-top: 40px; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid var(--primary);
        }
        .part-name { font-size: 1.5rem; font-weight: bold; color: var(--primary); }
        .part-desc { color: #747d8c; margin-top: 5px; font-style: italic; }

        /* Question Card */
        .q-card {
            background: white; border-radius: 12px; padding: 25px; margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.03); border: 1px solid #f1f2f6; position: relative; transition: 0.3s;
        }
        .q-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.05); }

        /* Audio Player Button */
        .audio-btn {
            background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 30px;
            cursor: pointer; display: inline-flex; align-items: center; gap: 8px; font-weight: 600; font-size: 0.9rem;
            transition: 0.2s; outline: none; margin-bottom: 15px;
        }
        .audio-btn:hover { background: var(--secondary); box-shadow: 0 4px 10px rgba(72, 52, 212, 0.3); }
        .audio-btn.playing { background: var(--danger); animation: pulse 1.5s infinite; }

        .q-text { font-size: 1.1rem; font-weight: 600; margin-bottom: 15px; line-height: 1.5; color: #2f3542; }

        /* Options */
        .opt-label {
            display: block; padding: 12px 15px; margin-bottom: 8px; border: 2px solid #f1f2f6; border-radius: 8px;
            cursor: pointer; transition: 0.2s; font-size: 0.95rem;
        }
        .opt-label:hover { border-color: var(--secondary); background: #f7f1e3; }
        .opt-label input { margin-right: 12px; transform: scale(1.2); }

        /* Result & Copyright */
        .result-box {
            display: none; margin-top: 15px; padding: 15px; background: #fff4e6; border-radius: 8px;
            border-left: 5px solid var(--accent); color: #d35400; font-size: 0.9rem; line-height: 1.6;
        }

        .footer-controls {
            background: white; padding: 15px 30px; border-top: 1px solid #dfe4ea; display: flex; justify-content: space-between; align-items: center;
        }
        .copyright { font-size: 0.85rem; color: #a4b0be; font-weight: 500; }
        .btn-submit {
            background: var(--success); color: white; border: none; padding: 12px 35px; border-radius: 8px;
            font-size: 1.1rem; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(106, 176, 76, 0.4); transition: 0.2s;
        }
        .btn-submit:hover { background: #55963e; transform: translateY(-2px); }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(235, 77, 75, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(235, 77, 75, 0); } 100% { box-shadow: 0 0 0 0 rgba(235, 77, 75, 0); } }

        /* Scrollbar ƒë·∫πp */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f2f6; }
        ::-webkit-scrollbar-thumb { background: #ced6e0; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a4b0be; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="timer-box" id="timer">60:00</div>
    <div class="map-title">Question Map</div>
    <div class="question-grid" id="qMap">
        </div>
</div>

<div class="main-wrapper">
    <div class="top-header">
        <div class="exam-title">LISTENING TEST (HARD MODE)</div>
        <div class="candidate-info">Th√≠ sinh: <b>Tr∆∞∆°ng Th·ªã D∆∞∆°ng</b></div>
    </div>

    <div class="exam-content">
        <div class="exam-paper" id="paper">
            </div>
    </div>

    <div class="footer-controls">
        <div class="copyright">¬© B·∫£n quy·ªÅn thu·ªôc v·ªÅ Nguy·ªÖn B·∫Øc S∆°n</div>
        <button class="btn-submit" onclick="submitExam()">N·ªòP B√ÄI (SUBMIT)</button>
    </div>
</div>
<script>
    // --- D·ªÆ LI·ªÜU ƒê·ªÄ THI (40 C√ÇU - 4 PH·∫¶N) ---
    const examData = [
        // PART 1
        {
            title: "PART 1: PHOTOGRAPHS",
            desc: "Listen and select the sentence that best describes the mental image.",
            qs: [
                { id: 1, text: "Q1: Look at the picture description.", script: "A. The electrician is climbing a pole. B. He is digging a hole. C. He is driving a truck. D. He is eating lunch.", ans: 0, expl: "Keywords: 'electrician', 'climbing', 'pole'." },
                { id: 2, text: "Q2: Look at the picture description.", script: "A. The lab is empty. B. She is looking through a microscope. C. They are washing equipment. D. The chemicals are spilled.", ans: 1, expl: "Keywords: 'looking through', 'microscope'." },
                { id: 3, text: "Q3: Look at the picture description.", script: "A. Traffic is heavy. B. The bridge is broken. C. Pedestrians are waiting. D. A police officer is directing traffic.", ans: 0, expl: "Keywords: 'Traffic', 'heavy'." },
                { id: 4, text: "Q4: Look at the picture description.", script: "A. He is soldering a wire. B. He is painting a wall. C. He is reading a book. D. He is typing on a laptop.", ans: 0, expl: "Keywords: 'soldering', 'wire'." },
                { id: 5, text: "Q5: Look at the picture description.", script: "A. The meeting has started. B. The room is dark. C. The projector is off. D. Everyone is standing.", ans: 0, expl: "Keywords: 'meeting', 'started'." },
                { id: 6, text: "Q6: Look at the picture description.", script: "A. Boxes are stacked on the shelf. B. The forklift is moving. C. The warehouse is closed. D. A worker is sleeping.", ans: 0, expl: "Keywords: 'Boxes', 'stacked'." },
                { id: 7, text: "Q7: Look at the picture description.", script: "A. The plane is taking off. B. Passengers are boarding. C. The pilot is waving. D. Luggage is lost.", ans: 1, expl: "Keywords: 'Passengers', 'boarding'." },
                { id: 8, text: "Q8: Look at the picture description.", script: "A. She is signing a document. B. She is making coffee. C. She is talking on the phone. D. She is leaving the office.", ans: 0, expl: "Keywords: 'signing', 'document'." },
                { id: 9, text: "Q9: Look at the picture description.", script: "A. The solar panels are on the roof. B. It is raining heavily. C. The wind turbine is broken. D. The sun is setting.", ans: 0, expl: "Keywords: 'solar panels', 'roof'." },
                { id: 10, text: "Q10: Look at the picture description.", script: "A. They are shaking hands. B. They are arguing. C. They are running. D. They are eating.", ans: 0, expl: "Keywords: 'shaking hands'." }
            ]
        },
        // PART 2
        {
            title: "PART 2: QUESTION & RESPONSE",
            desc: "Listen to the question and choose the best response.",
            qs: [
                { id: 11, text: "Q11: Mark your answer.", script: "When will the report be ready? ... A. Yes, it is. ... B. By 2 PM today. ... C. It's too long.", ans: 1, expl: "H·ªèi 'When' -> Tr·∫£ l·ªùi th·ªùi gian." },
                { id: 12, text: "Q12: Mark your answer.", script: "Who is the new manager? ... A. Mr. Smith. ... B. In the office. ... C. Since yesterday.", ans: 0, expl: "H·ªèi 'Who' -> T√™n ng∆∞·ªùi." },
                { id: 13, text: "Q13: Mark your answer.", script: "Where did you put the file? ... A. On your desk. ... B. To read it. ... C. It's a blue file.", ans: 0, expl: "H·ªèi 'Where' -> ƒê·ªãa ƒëi·ªÉm." },
                { id: 14, text: "Q14: Mark your answer.", script: "Why is the machine off? ... A. It's broken. ... B. At 5 o'clock. ... C. Yes, turn it on.", ans: 0, expl: "H·ªèi 'Why' -> L√Ω do (Broken)." },
                { id: 15, text: "Q15: Mark your answer.", script: "How much is this tool? ... A. It's heavy. ... B. 50 dollars. ... C. Use it carefully.", ans: 1, expl: "H·ªèi 'How much' -> Gi√° ti·ªÅn." },
                { id: 16, text: "Q16: Mark your answer.", script: "Did you call the client? ... A. No, I forgot. ... B. He is nice. ... C. The phone is here.", ans: 0, expl: "Yes/No question -> No + Explanation." },
                { id: 17, text: "Q17: Mark your answer.", script: "Would you like coffee or tea? ... A. Yes, please. ... B. Neither, just water. ... C. It is hot.", ans: 1, expl: "Choice question -> Neither." },
                { id: 18, text: "Q18: Mark your answer.", script: "How long is the meeting? ... A. About an hour. ... B. In room 302. ... C. With the boss.", ans: 0, expl: "H·ªèi 'How long' -> Kho·∫£ng th·ªùi gian." },
                { id: 19, text: "Q19: Mark your answer.", script: "Is there a pharmacy nearby? ... A. Yes, across the street. ... B. No, I am sick. ... C. Buy some medicine.", ans: 0, expl: "H·ªèi ƒë·ªãa ƒëi·ªÉm -> Yes + Location." },
                { id: 20, text: "Q20: Mark your answer.", script: "Don't you like this color? ... A. Yes, it's nice. ... B. No, it's red. ... C. I paint it.", ans: 0, expl: "Negative question. Yes = I like it." }
            ]
        },
        // PART 3
        {
            title: "PART 3: CONVERSATIONS",
            desc: "Listen to the dialogue and answer the questions.",
            group: true,
            script: "Man: Do you know when the safety inspection starts?\nWoman: I think it's scheduled for next Monday.\nMan: Oh, I thought it was today. We need to prepare the lab.\nWoman: Don't worry, we have the whole weekend to clean up.",
            qs: [
                { id: 21, text: "What are they discussing?", script: "", ans: 1, opts: ["A party", "Safety inspection", "New equipment", "Lunch"], expl: "Keyword: 'safety inspection'." },
                { id: 22, text: "When is the event?", script: "", ans: 1, opts: ["Today", "Next Monday", "Tomorrow", "Last week"], expl: "Woman says: 'next Monday'." },
                { id: 23, text: "What will they do this weekend?", script: "", ans: 0, opts: ["Clean up", "Sleep", "Work overtime", "Travel"], expl: "Woman says: 'weekend to clean up'." }
            ]
        },
        {
            group: true,
            script: "Woman: Excuse me, I bought this drill yesterday but it stopped working.\nMan: I'm sorry. Do you have the receipt?\nWoman: Yes, here it is. Can I get a refund?\nMan: Since you bought it yesterday, we can exchange it for a new one.",
            qs: [
                { id: 24, text: "Where is the conversation?", script: "", ans: 1, opts: ["At a bank", "At a store", "At home", "At school"], expl: "Context: Buying and returning items." },
                { id: 25, text: "What is the problem?", script: "", ans: 2, opts: ["Lost receipt", "Too expensive", "Drill stopped working", "Wrong color"], expl: "Woman says: 'stopped working'." },
                { id: 26, text: "What does the man offer?", script: "", ans: 2, opts: ["Refund", "Repair", "Exchange", "Nothing"], expl: "Man says: 'exchange it for a new one'." }
            ]
        },
        {
            group: true,
            script: "Man: I'm going to the cafeteria. Do you want anything?\nWoman: I'd love a coffee, but I have to finish this report by 2 PM.\nMan: I can bring it back for you. Black or with sugar?\nWoman: Thanks! Just black, please.",
            qs: [
                { id: 27, text: "Where is the man going?", script: "", ans: 0, opts: ["Cafeteria", "Library", "Gym", "Home"], expl: "Man says: 'going to the cafeteria'." },
                { id: 28, text: "Why can't the woman go?", script: "", ans: 1, opts: ["She is sick", "She is busy", "She has no money", "She is dieting"], expl: "Woman says: 'finish this report'." },
                { id: 29, text: "What does she want?", script: "", ans: 0, opts: ["Black coffee", "Tea", "Sandwich", "Water"], expl: "Woman says: 'Just black'." },
                { id: 30, text: "When is her deadline?", script: "", ans: 1, opts: ["1 PM", "2 PM", "3 PM", "4 PM"], expl: "Woman says: 'by 2 PM'." }
            ]
        },
        // PART 4
        {
            title: "PART 4: SHORT TALKS",
            desc: "Listen to the announcement/talk and answer.",
            group: true,
            script: "Attention passengers. Flight VN123 to Tokyo is delayed due to bad weather. The new departure time is 8:30 PM. Please wait in the departure lounge. We apologize for the inconvenience and will provide free meal vouchers at the counter.",
            qs: [
                { id: 31, text: "Where is this announcement?", script: "", ans: 1, opts: ["Train station", "Airport", "Bus stop", "Taxi"], expl: "Keyword: 'Flight VN123'." },
                { id: 32, text: "Why is the flight delayed?", script: "", ans: 2, opts: ["Engine trouble", "Strike", "Bad weather", "No pilot"], expl: "Keyword: 'due to bad weather'." },
                { id: 33, text: "What is offered to passengers?", script: "", ans: 0, opts: ["Meal vouchers", "Hotel room", "Money", "Free ticket"], expl: "Keyword: 'free meal vouchers'." }
            ]
        },
        {
            group: true,
            script: "Welcome to Hactech factory. Today you will see how we manufacture electric motors. Please wear your safety helmets at all times. The tour takes about 45 minutes. If you have questions, please ask the guide at the end.",
            qs: [
                { id: 34, text: "Who is the audience?", script: "", ans: 1, opts: ["Students", "Visitors/Tourists", "Doctors", "Pilots"], expl: "Context: Factory tour." },
                { id: 35, text: "What must they wear?", script: "", ans: 1, opts: ["Gloves", "Safety helmets", "Boots", "Masks"], expl: "Keyword: 'safety helmets'." },
                { id: 36, text: "How long is the tour?", script: "", ans: 2, opts: ["30 mins", "1 hour", "45 mins", "2 hours"], expl: "Keyword: '45 minutes'." },
                { id: 37, text: "When can they ask questions?", script: "", ans: 0, opts: ["At the end", "During the tour", "Before the tour", "Never"], expl: "Keyword: 'at the end'." }
            ]
        },
        {
            group: true,
            script: "This is a weather warning. A heavy storm is approaching the coast. Residents are advised to stay indoors and secure loose objects. Strong winds and heavy rain are expected tonight. The storm will pass by tomorrow morning.",
            qs: [
                { id: 38, text: "What is the report about?", script: "", ans: 0, opts: ["A storm", "Traffic", "Sports", "Economy"], expl: "Keyword: 'heavy storm'." },
                { id: 39, text: "What should people do?", script: "", ans: 1, opts: ["Go out", "Stay indoors", "Go swimming", "Drive"], expl: "Keyword: 'stay indoors'." },
                { id: 40, text: "When will it end?", script: "", ans: 0, opts: ["Tomorrow morning", "Tonight", "Next week", "Now"], expl: "Keyword: 'pass by tomorrow morning'." }
            ]
        }
    ];

    // --- LOGIC X·ª¨ L√ù ---
    let timerInterval;
    let timeLeft = 3600; // 60 ph√∫t
    let isSubmitted = false;

    // Kh·ªüi t·∫°o
    function init() {
        const paper = document.getElementById('paper');
        const map = document.getElementById('qMap');

        // Render Map
        for (let i = 1; i <= 40; i++) {
            const node = document.createElement('div');
            node.className = 'q-node';
            node.innerText = i;
            node.id = `map-${i}`;
            node.onclick = () => document.getElementById(`q-${i}`).scrollIntoView({behavior: 'smooth', block: 'center'});
            map.appendChild(node);
        }

        // Render Questions
        examData.forEach(part => {
            // Divider
            const div = document.createElement('div');
            div.innerHTML = `<div class="part-divider"><div class="part-name">${part.title}</div><div class="part-desc">${part.desc}</div></div>`;
            paper.appendChild(div);

            // Audio chung cho Part 3, 4
            if (part.group) {
                const groupAudio = document.createElement('div');
                groupAudio.innerHTML = `<button class="audio-btn" onclick="speak('${part.script.replace(/\n/g, ' ').replace(/'/g, "\\'")}', this)">üîä NGHE ƒêO·∫†N H·ªòI THO·∫†I (GROUP)</button>`;
                paper.appendChild(groupAudio);
            }

            // Render t·ª´ng c√¢u
            part.qs.forEach(q => {
                const card = document.createElement('div');
                card.className = 'q-card';
                card.id = `q-${q.id}`;

                // Audio ri√™ng cho Part 1, 2
                let audioBtn = '';
                if (!part.group) {
                    audioBtn = `<button class="audio-btn" onclick="speak('${q.script.replace(/'/g, "\\'")}', this)">üîä NGHE C√ÇU H·ªéI ${q.id}</button>`;
                }

                // Options (Part 1,2 m·∫∑c ƒë·ªãnh A,B,C,D n·∫øu ko c√≥ opts ri√™ng)
                let optionsHtml = '';
                const opts = q.opts || ["A", "B", "C", "D"]; // M·∫∑c ƒë·ªãnh ABCD cho Part 1,2
                opts.forEach((opt, idx) => {
                    optionsHtml += `<label class="opt-label"><input type="radio" name="ans-${q.id}" value="${idx}" onchange="markMap(${q.id})"> ${opt}</label>`;
                });

                card.innerHTML = `
                    ${audioBtn}
                    <div class="q-text">${q.text}</div>
                    <div class="options">${optionsHtml}</div>
                    <div class="result-box" id="res-${q.id}">
                        <b>Script:</b> "${part.group ? part.script : q.script}" <br>
                        <b>Gi·∫£i th√≠ch:</b> ${q.expl} <br>
                        <b>ƒê√°p √°n ƒë√∫ng:</b> ${opts[q.ans]}
                    </div>
                `;
                paper.appendChild(card);
            });
        });

        startTimer();
    }

    function speak(text, btn) {
        if (isSubmitted) return;
        window.speechSynthesis.cancel();
        
        // Reset buttons
        document.querySelectorAll('.audio-btn').forEach(b => {
            b.classList.remove('playing');
            if(b.innerText.includes('ƒêANG')) b.innerText = b.innerText.replace('ƒêANG ƒê·ªåC...', 'NGHE');
        });

        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'en-US';
        utterance.rate = 1.0; 
        
        btn.classList.add('playing');
        let orgText = btn.innerText;
        btn.innerText = "üîä ƒêANG ƒê·ªåC...";
        
        utterance.onend = () => {
            btn.classList.remove('playing');
            btn.innerText = orgText;
        };
        
        window.speechSynthesis.speak(utterance);
    }

    function markMap(id) {
        document.getElementById(`map-${id}`).classList.add('active');
    }

    function startTimer() {
        timerInterval = setInterval(() => {
            if (timeLeft <= 0) {
                finishExam();
                return;
            }
            timeLeft--;
            const m = Math.floor(timeLeft / 60);
            const s = timeLeft % 60;
            document.getElementById('timer').innerText = `${m}:${s < 10 ? '0' + s : s}`;
        }, 1000);
    }

    function submitExam() {
        if (isSubmitted) return;
        if (!confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën n·ªôp b√†i?")) return;
        
        isSubmitted = true;
        clearInterval(timerInterval);
        window.speechSynthesis.cancel();

        let score = 0;
        let total = 40;

        examData.forEach(part => {
            part.qs.forEach(q => {
                const selected = document.querySelector(`input[name="ans-${q.id}"]:checked`);
                const mapNode = document.getElementById(`map-${q.id}`);
                const resBox = document.getElementById(`res-${q.id}`);
                const card = document.getElementById(`q-${q.id}`);

                resBox.style.display = 'block';

                if (selected && parseInt(selected.value) === q.ans) {
                    score++;
                    mapNode.className = 'q-node correct';
                    card.style.borderLeft = '5px solid #6ab04c';
                } else {
                    mapNode.className = 'q-node wrong';
                    card.style.borderLeft = '5px solid #eb4d4b';
                }
            });
        });

        alert(`K·∫æT QU·∫¢ C·ª¶A TR∆Ø∆†NG TH·ªä D∆Ø∆†NG: ${score}/${total}\n\nXem chi ti·∫øt gi·∫£i th√≠ch b√™n d∆∞·ªõi t·ª´ng c√¢u.`);
        window.scrollTo(0,0);
    }

    // Run
    init();

</script>
</body>
</html>
