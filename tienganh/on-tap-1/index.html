<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Listening Exam - D√†nh ri√™ng cho Tr∆∞∆°ng Th·ªã D∆∞∆°ng</title>
    <style>
        :root {
            --primary: #2c3e50; --secondary: #3498db; --accent: #e67e22;
            --bg: #ecf0f1; --sidebar: #fff; --text: #2c3e50;
            --success: #27ae60; --danger: #c0392b;
        }
        * { box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; background: var(--bg); color: var(--text); overflow: hidden; }

        /* Sidebar */
        .sidebar { width: 300px; background: var(--sidebar); border-right: 1px solid #bdc3c7; display: flex; flex-direction: column; padding: 20px; box-shadow: 2px 0 10px rgba(0,0,0,0.05); z-index: 10; }
        .timer-box { background: var(--danger); color: white; padding: 15px; border-radius: 8px; text-align: center; font-size: 2rem; font-weight: bold; margin-bottom: 20px; box-shadow: 0 4px 0 #96281b; }
        .map-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; overflow-y: auto; padding-right: 5px; }
        .node { aspect-ratio: 1; border: 1px solid #bdc3c7; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: bold; cursor: pointer; transition: 0.2s; background: #f9f9f9; }
        .node:hover { background: var(--secondary); color: white; border-color: var(--secondary); }
        .node.active { background: var(--primary); color: white; }
        .node.correct { background: var(--success); color: white; border-color: var(--success); }
        .node.wrong { background: var(--danger); color: white; border-color: var(--danger); }

        /* Main */
        .main { flex: 1; display: flex; flex-direction: column; }
        .header { background: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #bdc3c7; }
        .title { font-size: 1.5rem; font-weight: 800; color: var(--primary); }
        .candidate { background: var(--bg); padding: 8px 15px; border-radius: 20px; font-weight: 600; }
        
        .content { flex: 1; overflow-y: auto; padding: 40px; scroll-behavior: smooth; }
        .paper { max-width: 850px; margin: 0 auto; padding-bottom: 60px; }

        /* Sections */
        .part-header { margin-top: 40px; border-bottom: 3px solid var(--secondary); padding-bottom: 10px; margin-bottom: 20px; }
        .part-title { font-size: 1.4rem; font-weight: bold; color: var(--secondary); }
        .part-desc { color: #7f8c8d; font-style: italic; margin-top: 5px; }

        /* Cards */
        .card { background: white; padding: 25px; margin-bottom: 25px; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.05); border-left: 5px solid transparent; transition: 0.3s; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        
        .audio-btn { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 30px; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; font-weight: 600; margin-bottom: 15px; transition: 0.2s; }
        .audio-btn:hover { background: var(--secondary); }
        .audio-btn.playing { background: var(--accent); animation: pulse 1s infinite; }

        .q-text { font-size: 1.1rem; font-weight: 600; margin-bottom: 15px; }
        
        /* Multiple Choice Styles */
        .opt-label { display: block; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; margin-bottom: 8px; cursor: pointer; transition: 0.2s; }
        .opt-label:hover { border-color: var(--secondary); background: #f0f8ff; }
        .opt-label input { margin-right: 10px; transform: scale(1.2); }

        /* Gap Filling Styles */
        .gap-container { font-size: 1.2rem; line-height: 2; color: #333; }
        .gap-input { border: none; border-bottom: 2px solid #bdc3c7; font-size: 1.2rem; width: 150px; padding: 5px; text-align: center; color: var(--primary); font-weight: bold; background: #fafafa; transition: 0.3s; }
        .gap-input:focus { outline: none; border-bottom-color: var(--secondary); background: #eefbff; }
        .gap-input.correct { border-bottom-color: var(--success); color: var(--success); background: #e8f5e9; }
        .gap-input.wrong { border-bottom-color: var(--danger); color: var(--danger); background: #ffebee; }

        /* Feedback */
        .feedback { margin-top: 15px; padding: 15px; background: #fff8e1; border: 1px solid #ffe082; border-radius: 6px; display: none; color: #d35400; font-size: 0.95rem; }

        .footer { background: white; padding: 15px 30px; border-top: 1px solid #bdc3c7; display: flex; justify-content: space-between; align-items: center; }
        .btn-submit { background: var(--success); color: white; border: none; padding: 12px 40px; border-radius: 8px; font-size: 1.2rem; font-weight: bold; cursor: pointer; }
        .btn-submit:hover { background: #219150; }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(230, 126, 34, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(230, 126, 34, 0); } 100% { box-shadow: 0 0 0 0 rgba(230, 126, 34, 0); } }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="timer-box" id="timer">60:00</div>
    <div style="margin-bottom:10px; font-weight:bold; color:#7f8c8d; text-transform: uppercase; font-size: 0.9rem;">Question Map</div>
    <div class="map-grid" id="qMap"></div>
</div>

<div class="main">
    <div class="header">
        <div class="title">LISTENING EXAM (PRO)</div>
        <div class="candidate">Th√≠ sinh: <b>Tr∆∞∆°ng Th·ªã D∆∞∆°ng</b></div>
    </div>
    <div class="content">
        <div class="paper" id="paper"></div>
    </div>
    <div class="footer">
        <div style="color: #95a5a6; font-size: 0.9rem;">¬© Copyright by Nguy·ªÖn B·∫Øc S∆°n</div>
        <button class="btn-submit" onclick="submitExam()">N·ªòP B√ÄI (SUBMIT)</button>
    </div>
</div>
<script>
    // D·ªÆ LI·ªÜU ƒê·ªÄ THI (50 C√ÇU)
    const examData = [
        // PART 1 (1-10)
        {
            title: "PART 1: PHOTOGRAPHS", desc: "Listen and choose the best description.", type: "mc",
            qs: [
                { id: 1, text: "Q1: Mental Image", script: "A. The electrician is climbing a pole. B. He is digging a hole. C. He is driving. D. He is sleeping.", ans: 0, expl: "Keywords: 'electrician', 'climbing'." },
                { id: 2, text: "Q2: Mental Image", script: "A. The lab is empty. B. She is looking through a microscope. C. They are washing. D. Chemicals are spilled.", ans: 1, expl: "Keywords: 'microscope'." },
                { id: 3, text: "Q3: Mental Image", script: "A. Heavy traffic. B. Broken bridge. C. Pedestrians waiting. D. Police directing.", ans: 0, expl: "Keywords: 'Traffic'." },
                { id: 4, text: "Q4: Mental Image", script: "A. Soldering a wire. B. Painting wall. C. Reading book. D. Typing laptop.", ans: 0, expl: "Keywords: 'soldering'." },
                { id: 5, text: "Q5: Mental Image", script: "A. Meeting started. B. Dark room. C. Projector off. D. Standing.", ans: 0, expl: "Keywords: 'meeting'." },
                { id: 6, text: "Q6: Mental Image", script: "A. Boxes stacked. B. Forklift moving. C. Warehouse closed. D. Worker sleeping.", ans: 0, expl: "Keywords: 'Boxes', 'stacked'." },
                { id: 7, text: "Q7: Mental Image", script: "A. Plane taking off. B. Passengers boarding. C. Pilot waving. D. Luggage lost.", ans: 1, expl: "Keywords: 'boarding'." },
                { id: 8, text: "Q8: Mental Image", script: "A. Signing document. B. Making coffee. C. Talking phone. D. Leaving.", ans: 0, expl: "Keywords: 'signing'." },
                { id: 9, text: "Q9: Mental Image", script: "A. Solar panels on roof. B. Raining. C. Wind turbine broken. D. Sun setting.", ans: 0, expl: "Keywords: 'solar panels'." },
                { id: 10, text: "Q10: Mental Image", script: "A. Shaking hands. B. Arguing. C. Running. D. Eating.", ans: 0, expl: "Keywords: 'shaking hands'." }
            ]
        },
        // PART 2 (11-20)
        {
            title: "PART 2: QUESTION & RESPONSE", desc: "Listen and choose the best response.", type: "mc",
            qs: [
                { id: 11, text: "Q11: Mark Answer", script: "When is the report due? ... A. Yes. ... B. By 2 PM. ... C. Too long.", ans: 1, expl: "When -> Time." },
                { id: 12, text: "Q12: Mark Answer", script: "Who is the manager? ... A. Mr. Smith. ... B. In office. ... C. Yesterday.", ans: 0, expl: "Who -> Name." },
                { id: 13, text: "Q13: Mark Answer", script: "Where is the file? ... A. On desk. ... B. To read. ... C. Blue file.", ans: 0, expl: "Where -> Place." },
                { id: 14, text: "Q14: Mark Answer", script: "Why is it off? ... A. Broken. ... B. 5 o'clock. ... C. Turn on.", ans: 0, expl: "Why -> Reason." },
                { id: 15, text: "Q15: Mark Answer", script: "How much is it? ... A. Heavy. ... B. $50. ... C. Careful.", ans: 1, expl: "How much -> Price." },
                { id: 16, text: "Q16: Mark Answer", script: "Did you call? ... A. No, forgot. ... B. Nice. ... C. Phone here.", ans: 0, expl: "Yes/No question." },
                { id: 17, text: "Q17: Mark Answer", script: "Coffee or tea? ... A. Yes. ... B. Water please. ... C. Hot.", ans: 1, expl: "Choice -> Neither." },
                { id: 18, text: "Q18: Mark Answer", script: "How long is it? ... A. 1 hour. ... B. Room 302. ... C. With boss.", ans: 0, expl: "How long -> Duration." },
                { id: 19, text: "Q19: Mark Answer", script: "Pharmacy nearby? ... A. Across street. ... B. I am sick. ... C. Buy medicine.", ans: 0, expl: "Location." },
                { id: 20, text: "Q20: Mark Answer", script: "Like this color? ... A. Yes, nice. ... B. It is red. ... C. Paint it.", ans: 0, expl: "Opinion." }
            ]
        },
        // PART 3 (21-30)
        {
            title: "PART 3: CONVERSATIONS", desc: "Listen to the dialogue and answer.", type: "mc", group: true,
            script: "Man: When does the safety inspection start?\nWoman: Next Monday.\nMan: I thought it was today.\nWoman: No, we have the weekend to prepare.",
            qs: [
                { id: 21, text: "What discussing?", ans: 1, opts: ["Party", "Inspection", "Equipment", "Lunch"], expl: "Safety inspection." },
                { id: 22, text: "When is it?", ans: 1, opts: ["Today", "Monday", "Tomorrow", "Last week"], expl: "Next Monday." },
                { id: 23, text: "What do this weekend?", ans: 0, opts: ["Prepare/Clean", "Sleep", "Work", "Travel"], expl: "Prepare." }
            ]
        },
        {
            type: "mc", group: true,
            script: "Woman: I bought this drill yesterday but it stopped working.\nMan: Do you have the receipt?\nWoman: Yes. Can I get a refund?\nMan: We can exchange it for a new one.",
            qs: [
                { id: 24, text: "Where is this?", ans: 1, opts: ["Bank", "Store", "Home", "School"], expl: "Store context." },
                { id: 25, text: "Problem?", ans: 2, opts: ["Lost receipt", "Expensive", "Not working", "Wrong color"], expl: "Stopped working." },
                { id: 26, text: "Man offers?", ans: 2, opts: ["Refund", "Repair", "Exchange", "Nothing"], expl: "Exchange." }
            ]
        },
        {
            type: "mc", group: true,
            script: "Man: Going to cafeteria. Want anything?\nWoman: Coffee please. Black.\nMan: Sugar?\nWoman: No, just black. I'm busy with a report.",
            qs: [
                { id: 27, text: "Man going?", ans: 0, opts: ["Cafeteria", "Library", "Gym", "Home"], expl: "Cafeteria." },
                { id: 28, text: "Woman doing?", ans: 1, opts: ["Sick", "Busy/Report", "No money", "Diet"], expl: "Busy." },
                { id: 29, text: "She wants?", ans: 0, opts: ["Black coffee", "Tea", "Sandwich", "Water"], expl: "Black coffee." },
                { id: 30, text: "Sugar?", ans: 1, opts: ["Yes", "No", "A little", "Milk"], expl: "No sugar." }
            ]
        }
    ];
// K·∫æT TH√öC PH·∫¶N 2. D√ÅN PH·∫¶N 3 NGAY D∆Ø·ªöI
</script>
<script>
    // D·ªÆ LI·ªÜU C√ÇU 31-50
    const part3Data = [
        // PART 4 (31-40) - Multiple Choice
        {
            title: "PART 4: SHORT TALKS", desc: "Listen and answer.", type: "mc", group: true,
            script: "Attention. Flight VN123 to Tokyo is delayed due to weather. New time is 8:30 PM. Free meal vouchers available.",
            qs: [
                { id: 31, text: "Where is this?", ans: 1, opts: ["Station", "Airport", "Bus", "Taxi"], expl: "Flight VN123." },
                { id: 32, text: "Why delayed?", ans: 2, opts: ["Engine", "Strike", "Weather", "Pilot"], expl: "Due to weather." },
                { id: 33, text: "Offer?", ans: 0, opts: ["Meal vouchers", "Hotel", "Money", "Ticket"], expl: "Meal vouchers." }
            ]
        },
        {
            type: "mc", group: true,
            script: "Welcome to Hactech factory. Wear safety helmets. Tour takes 45 minutes. Questions at the end.",
            qs: [
                { id: 34, text: "Audience?", ans: 1, opts: ["Students", "Visitors", "Doctors", "Pilots"], expl: "Factory tour." },
                { id: 35, text: "Wear?", ans: 1, opts: ["Gloves", "Helmets", "Boots", "Masks"], expl: "Safety helmets." },
                { id: 36, text: "Duration?", ans: 2, opts: ["30m", "1h", "45m", "2h"], expl: "45 minutes." },
                { id: 37, text: "Questions?", ans: 0, opts: ["At end", "During", "Before", "Never"], expl: "At the end." }
            ]
        },
        {
            type: "mc", group: true,
            script: "Storm warning. Stay indoors. Strong winds tonight. Ends tomorrow morning.",
            qs: [
                { id: 38, text: "Topic?", ans: 0, opts: ["Storm", "Traffic", "Sports", "Economy"], expl: "Storm warning." },
                { id: 39, text: "Advice?", ans: 1, opts: ["Go out", "Stay indoors", "Swim", "Drive"], expl: "Stay indoors." },
                { id: 40, text: "Ends?", ans: 0, opts: ["Tomorrow AM", "Tonight", "Next week", "Now"], expl: "Tomorrow morning." }
            ]
        },
        // --- PART 5: GAP FILLING (41-50) - NEW! ---
        {
            title: "PART 5: DICTATION / GAP FILLING",
            desc: "Listen and type the missing word in the blank.",
            type: "gap",
            qs: [
                { id: 41, text: "Q41: Fill in the blank.", script: "Please sign this document.", display: "Please <input class='gap-input' id='in-41' oninput='markMap(41)'> this document.", ans: "sign", expl: "Please sign (k√Ω t√™n)." },
                { id: 42, text: "Q42: Fill in the blank.", script: "The meeting starts at 9 AM.", display: "The <input class='gap-input' id='in-42' oninput='markMap(42)'> starts at 9 AM.", ans: "meeting", expl: "The meeting (cu·ªôc h·ªçp)." },
                { id: 43, text: "Q43: Fill in the blank.", script: "We need to reduce costs.", display: "We need to <input class='gap-input' id='in-43' oninput='markMap(43)'> costs.", ans: "reduce", expl: "To reduce (gi·∫£m)." },
                { id: 44, text: "Q44: Fill in the blank.", script: "The voltage is too high.", display: "The <input class='gap-input' id='in-44' oninput='markMap(44)'> is too high.", ans: "voltage", expl: "The voltage (ƒëi·ªán √°p)." },
                { id: 45, text: "Q45: Fill in the blank.", script: "I apologize for the delay.", display: "I apologize for the <input class='gap-input' id='in-45' oninput='markMap(45)'>.", ans: "delay", expl: "The delay (s·ª± ch·∫≠m tr·ªÖ)." },
                { id: 46, text: "Q46: Fill in the blank.", script: "The new policy is effective.", display: "The new <input class='gap-input' id='in-46' oninput='markMap(46)'> is effective.", ans: "policy", expl: "The policy (ch√≠nh s√°ch)." },
                { id: 47, text: "Q47: Fill in the blank.", script: "Please wear a helmet.", display: "Please wear a <input class='gap-input' id='in-47' oninput='markMap(47)'>.", ans: "helmet", expl: "A helmet (m≈© b·∫£o hi·ªÉm)." },
                { id: 48, text: "Q48: Fill in the blank.", script: "The deadline is tomorrow.", display: "The <input class='gap-input' id='in-48' oninput='markMap(48)'> is tomorrow.", ans: "deadline", expl: "The deadline (h·∫°n ch√≥t)." },
                { id: 49, text: "Q49: Fill in the blank.", script: "Can you confirm the reservation?", display: "Can you <input class='gap-input' id='in-49' oninput='markMap(49)'> the reservation?", ans: "confirm", expl: "Confirm (x√°c nh·∫≠n)." },
                { id: 50, text: "Q50: Fill in the blank.", script: "The battery is empty.", display: "The <input class='gap-input' id='in-50' oninput='markMap(50)'> is empty.", ans: "battery", expl: "The battery (pin)." }
            ]
        }
    ];

    // --- LOGIC X·ª¨ L√ù (JS) ---
    const allData = [...examData, ...part3Data];
    let isSubmitted = false;
    let timer;
    let timeLeft = 3600; 

    function init() {
        const paper = document.getElementById('paper');
        const map = document.getElementById('qMap');
        
        // Render Map Nodes
        for(let i=1; i<=50; i++) {
            const n = document.createElement('div');
            n.className = 'node'; n.innerText = i; n.id = `node-${i}`;
            n.onclick = () => document.getElementById(`q-${i}`).scrollIntoView({behavior:'smooth', block:'center'});
            map.appendChild(n);
        }

        // Render Exam Content
        allData.forEach(part => {
            const div = document.createElement('div');
            div.innerHTML = `<div class="part-header"><div class="part-title">${part.title}</div><div class="part-desc">${part.desc}</div></div>`;
            paper.appendChild(div);

            // Group Audio for Part 3 & 4
            if(part.group && part.script) {
                 paper.innerHTML += `<button class="audio-btn" onclick="speak('${part.script.replace(/\n/g, ' ').replace(/'/g, "\\'")}', this)">üîä PLAY GROUP AUDIO</button>`;
            }

            part.qs.forEach(q => {
                const card = document.createElement('div');
                card.className = 'card'; card.id = `q-${q.id}`;
                
                // Audio for Part 1, 2, 5 (Individual)
                let audioBtn = "";
                if(!part.group) {
                    audioBtn = `<button class="audio-btn" onclick="speak('${q.script.replace(/'/g, "\\'")}', this)">üîä PLAY Q${q.id}</button>`;
                }

                // Render Input (MC or Gap)
                let contentHtml = "";
                if (part.type === 'mc') {
                    // Multiple Choice
                    const opts = q.opts || ["A", "B", "C", "D"];
                    opts.forEach((o, i) => {
                        contentHtml += `<label class="opt-label"><input type="radio" name="ans-${q.id}" value="${i}" onchange="markMap(${q.id})"> ${o}</label>`;
                    });
                } else {
                    // Gap Filling
                    contentHtml = `<div class="gap-container">${q.display}</div>`;
                }

                card.innerHTML = `
                    ${audioBtn}
                    <div class="q-text">${q.text}</div>
                    ${contentHtml}
                    <div class="feedback" id="feed-${q.id}">
                        <b>Script:</b> "${q.script}"<br>
                        <b>Answer:</b> ${part.type === 'mc' ? (q.opts ? q.opts[q.ans] : ["A","B","C","D"][q.ans]) : q.ans}<br>
                        <b>Note:</b> ${q.expl}
                    </div>
                `;
                paper.appendChild(card);
            });
        });
        startTimer();
    }

    function speak(txt, btn) {
        if(isSubmitted) return;
        window.speechSynthesis.cancel();
        document.querySelectorAll('.audio-btn').forEach(b => { b.classList.remove('playing'); if(b.innerText.includes('...')) b.innerText = b.innerText.replace('...', ''); });
        
        const u = new SpeechSynthesisUtterance(txt);
        u.lang = 'en-US'; u.rate = 1;
        btn.classList.add('playing'); let oldT = btn.innerText; btn.innerText = "üîä PLAYING...";
        u.onend = () => { btn.classList.remove('playing'); btn.innerText = oldT; };
        window.speechSynthesis.speak(u);
    }

    function markMap(id) {
        document.getElementById(`node-${id}`).classList.add('active');
    }

    function startTimer() {
        timer = setInterval(() => {
            if(timeLeft<=0) { finishExam(); return; }
            timeLeft--;
            let m = Math.floor(timeLeft/60); let s = timeLeft%60;
            document.getElementById('timer').innerText = `${m}:${s<10?'0'+s:s}`;
        }, 1000);
    }

    function submitExam() {
        if(isSubmitted) return;
        if(!confirm("N·ªôp b√†i?")) return;
        isSubmitted = true; clearInterval(timer); window.speechSynthesis.cancel();
        
        let score = 0;
        
        allData.forEach(part => {
            part.qs.forEach(q => {
                const node = document.getElementById(`node-${q.id}`);
                const feed = document.getElementById(`feed-${q.id}`);
                const card = document.getElementById(`q-${q.id}`);
                feed.style.display = 'block';

                let isCorrect = false;

                if (part.type === 'mc') {
                    const sel = document.querySelector(`input[name="ans-${q.id}"]:checked`);
                    if(sel && parseInt(sel.value) === q.ans) isCorrect = true;
                } else {
                    const inp = document.getElementById(`in-${q.id}`);
                    const val = inp.value.trim().toLowerCase();
                    if(val === q.ans.toLowerCase()) {
                        isCorrect = true;
                        inp.classList.add('correct');
                    } else {
                        inp.classList.add('wrong');
                    }
                }

                if(isCorrect) {
                    score++;
                    node.className = 'node correct';
                    card.style.borderLeftColor = '#27ae60';
                } else {
                    node.className = 'node wrong';
                    card.style.borderLeftColor = '#c0392b';
                }
            });
        });
        
        alert(`K·∫æT QU·∫¢ C·ª¶A TR∆Ø∆†NG TH·ªä D∆Ø∆†NG: ${score}/50`);
        window.scrollTo(0,0);
    }

    init();
</script>
</body>
</html>
