<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hactech Advanced Listening Exam (Full 40 Questions)</title>
    <style>
        :root { --header: #1e272e; --sidebar: #d2dae2; --accent: #0fbcf9; --danger: #ff5e57; --success: #0be881; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; background: #f1f2f6; overflow: hidden; }
        
        /* Sidebar */
        .sidebar { width: 280px; background: var(--sidebar); border-right: 1px solid #ccc; display: flex; flex-direction: column; padding: 15px; overflow-y: auto; }
        .timer-display { background: var(--danger); color: white; padding: 15px; text-align: center; font-size: 1.8rem; font-weight: bold; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 4px 0 #d63031; }
        .grid-qs { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; }
        .q-dot { width: 100%; aspect-ratio: 1; background: white; border: 1px solid #aaa; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; border-radius: 4px; transition: 0.2s; }
        .q-dot:hover { background: var(--accent); color: white; }
        .q-dot.done { background: #808e9b; color: white; border-color: #808e9b; }
        .q-dot.right { background: var(--success); color: white; border-color: var(--success); }
        .q-dot.wrong { background: var(--danger); color: white; border-color: var(--danger); }

        /* Main */
        .main { flex: 1; display: flex; flex-direction: column; height: 100vh; }
        .top-bar { background: var(--header); color: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .content-area { flex: 1; overflow-y: auto; padding: 40px; scroll-behavior: smooth; }
        .container { max-width: 900px; margin: 0 auto; padding-bottom: 50px; }

        /* Exam Blocks */
        .section-header { font-size: 1.4rem; font-weight: bold; color: #3c40c6; margin-top: 40px; margin-bottom: 10px; border-bottom: 3px solid #3c40c6; padding-bottom: 5px; }
        .desc-text { color: #57606f; font-style: italic; margin-bottom: 20px; }
        
        .audio-box { background: #fff; padding: 15px; border-radius: 50px; display: flex; align-items: center; gap: 15px; margin-bottom: 25px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #dcdde1; }
        .play-btn { width: 50px; height: 50px; border-radius: 50%; background: var(--accent); color: white; border: none; cursor: pointer; font-size: 1.5rem; transition: 0.2s; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .play-btn:hover { transform: scale(1.1); background: #3c40c6; }
        .play-btn.playing { background: var(--danger); animation: pulse 1s infinite; }
        
        .q-card { background: white; padding: 20px; margin-bottom: 20px; border-radius: 8px; border-left: 5px solid transparent; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .q-title { font-weight: 600; margin-bottom: 12px; font-size: 1.05rem; }
        .options label { display: block; padding: 10px; border: 1px solid #f1f2f6; margin-bottom: 5px; cursor: pointer; border-radius: 4px; transition: 0.2s; }
        .options label:hover { background: #f7f1e3; border-color: #d1ccc0; }
        .options input { margin-right: 10px; }

        /* Transcript */
        .script-reveal { margin-top: 15px; padding: 15px; background: #fff4e6; border: 1px solid #ffeaa7; border-radius: 6px; display: none; font-size: 0.95rem; line-height: 1.5; color: #d35400; }
        
        .footer { background: white; padding: 15px 30px; border-top: 1px solid #ddd; text-align: right; }
        .btn-finish { background: var(--success); color: white; padding: 12px 40px; border: none; border-radius: 5px; font-weight: bold; font-size: 1.1rem; cursor: pointer; }
        .btn-finish:hover { background: #05c46b; }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 94, 87, 0.4); } 70% { box-shadow: 0 0 0 15px rgba(255, 94, 87, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 94, 87, 0); } }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="timer-display" id="timer">60:00</div>
    <div style="margin-bottom:10px; font-weight:bold; color:#57606f">Question Map</div>
    <div class="grid-qs" id="map"></div>
</div>

<div class="main">
    <div class="top-bar">
        <h1>ADVANCED LISTENING EXAM (PRO)</h1>
        <div>Candidate: <b>Nguyen Bac Son</b></div>
    </div>
    <div class="content-area">
        <div class="container" id="examContainer">
            </div>
    </div>
    <div class="footer">
        <button class="btn-finish" onclick="finishExam()">N·ªòP B√ÄI (SUBMIT)</button>
    </div>
</div>

<script>
// --- PART 1 OF DATA ---
const part1Data = [
    // --- PART 1: PHOTOGRAPHS (1-10) ---
    {
        section: "PART 1: PHOTOGRAPHS (10 Questions)",
        desc: "Imagine the picture based on the audio description and choose the correct statement.",
        questions: [
            { id: 1, s: "A. The electrician is climbing the utility pole. B. He is digging a hole in the ground. C. The wires are being cut by pliers. D. He is driving a maintenance truck.", q: "Q1: Look at the mental picture.", ans: 0, expl: "Keywords: 'electrician', 'climbing', 'utility pole'." },
            { id: 2, s: "A. The meeting room is empty. B. A presentation is being given on the screen. C. The employees are having lunch. D. They are shaking hands outside.", q: "Q2: Look at the mental picture.", ans: 1, expl: "Keywords: 'presentation', 'screen'." },
            { id: 3, s: "A. The machinery is being operated by a robot. B. Some boxes are stacked on the shelf. C. The conveyor belt has stopped moving. D. A technician is inspecting the control panel.", q: "Q3: Look at the mental picture.", ans: 3, expl: "Keywords: 'technician', 'inspecting', 'control panel'." },
            { id: 4, s: "A. She is putting on safety glasses. B. She is typing on a keyboard. C. She is holding a test tube. D. She is cleaning the microscope.", q: "Q4: Look at the mental picture.", ans: 2, expl: "Keywords: 'holding', 'test tube' (Lab context)." },
            { id: 5, s: "A. Traffic is heavy on the highway. B. The bridge is under construction. C. Cars are parked in the garage. D. Pedestrians are crossing the street.", q: "Q5: Look at the mental picture.", ans: 1, expl: "Keywords: 'bridge', 'under construction'." },
            { id: 6, s: "A. The man is welding a metal pipe. B. He is painting the wall. C. He is reading a newspaper. D. He is buying some tools.", q: "Q6: Look at the mental picture.", ans: 0, expl: "Keywords: 'welding', 'metal pipe'." },
            { id: 7, s: "A. The airplane is taking off. B. Passengers are boarding the bus. C. Luggage is being loaded onto the cart. D. The pilot is waving goodbye.", q: "Q7: Look at the mental picture.", ans: 2, expl: "Keywords: 'Luggage', 'loaded'." },
            { id: 8, s: "A. Some documents are scattered on the desk. B. The computer screen is broken. C. A man is signing a contract. D. The office lights are turned off.", q: "Q8: Look at the mental picture.", ans: 2, expl: "Keywords: 'signing', 'contract'." },
            { id: 9, s: "A. They are assembling a circuit board. B. They are playing video games. C. They are watching TV. D. They are soldering a large pipe.", q: "Q9: Look at the mental picture.", ans: 0, expl: "Keywords: 'assembling', 'circuit board'." },
            { id: 10, s: "A. The store is closed for renovation. B. A customer is paying at the counter. C. The shelves are empty. D. The cashier is sleeping.", q: "Q10: Look at the mental picture.", ans: 1, expl: "Keywords: 'paying', 'counter'." }
        ]
    },
    // --- PART 2: QUESTION & RESPONSE (11-20) ---
    {
        section: "PART 2: QUESTION & RESPONSE (10 Questions)",
        desc: "Listen to the question and select the best response. (Hard Mode: Indirect Answers)",
        questions: [
            { id: 11, s: "Q: When will the new transformers arrive? ... A. By truck. ... B. I'm not sure, ask the supply manager. ... C. Yes, they are new.", q: "Q11: Mark your answer.", ans: 1, expl: "Indirect answer. Kh√¥ng tr·∫£ l·ªùi th·ªùi gian c·ª• th·ªÉ m√† b·∫£o ƒëi h·ªèi ng∆∞·ªùi kh√°c." },
            { id: 12, s: "Q: Who left the laboratory door open? ... A. It was open when I got here. ... B. To let some air in. ... C. Mr. Wilson has the key.", q: "Q12: Mark your answer.", ans: 0, expl: "Ph·ªß ƒë·ªãnh tr√°ch nhi·ªám gi√°n ti·∫øp." },
            { id: 13, s: "Q: Why hasn't the report been finished yet? ... A. It's very interesting. ... B. Because the printer broke down. ... C. I reported it yesterday.", q: "Q13: Mark your answer.", ans: 1, expl: "L√Ω do: Printer broke down." },
            { id: 14, s: "Q: Would you prefer coffee or tea? ... A. Neither, I'll have some water. ... B. Yes, please. ... C. It's too hot.", q: "Q14: Mark your answer.", ans: 0, expl: "L·ª±a ch·ªçn th·ª© 3 (Neither)." },
            { id: 15, s: "Q: How do I operate this multimeter? ... A. It measures voltage. ... B. Check the user manual on page 5. ... C. It's brand new.", q: "Q15: Mark your answer.", ans: 1, expl: "H∆∞·ªõng d·∫´n gi√°n ti·∫øp: Check manual." },
            { id: 16, s: "Q: Has the safety inspection started? ... A. It's safety first. ... B. No, the inspector is late. ... C. I have inspected it.", q: "Q16: Mark your answer.", ans: 1, expl: "Yes/No question -> No + Reason." },
            { id: 17, s: "Q: Where can I find the spare parts? ... A. In the warehouse, aisle 4. ... B. It is a spare part. ... C. To fix the machine.", q: "Q17: Mark your answer.", ans: 0, expl: "Ch·ªâ ƒë·ªãa ƒëi·ªÉm c·ª• th·ªÉ." },
            { id: 18, s: "Q: Didn't you go to the seminar yesterday? ... A. Yes, I learned a lot. ... B. It was at 9 AM. ... C. No, I went there.", q: "Q18: Mark your answer.", ans: 0, expl: "C√¢u h·ªèi ph·ªß ƒë·ªãnh (Didn't you). Tr·∫£ l·ªùi Yes nghƒ©a l√† C√≥ ƒëi." },
            { id: 19, s: "Q: What is the estimated cost for the repair? ... A. About two hours. ... B. At least $500. ... C. It's very expensive.", q: "Q19: Mark your answer.", ans: 1, expl: "H·ªèi gi√° (Cost) -> S·ªë ti·ªÅn." },
            { id: 20, s: "Q: Are you going to the Hactech workshop? ... A. I'm afraid I have a meeting. ... B. It's a great workshop. ... C. Yes, I am working.", q: "Q20: Mark your answer.", ans: 0, expl: "T·ª´ ch·ªëi kh√©o (I have a meeting)." }
        ]
    }
];
</script>
<script>
// --- PART 2 OF DATA ---
const part2Data = [
    // --- PART 3: CONVERSATIONS (21-30) ---
    {
        section: "PART 3: CONVERSATIONS (10 Questions)",
        desc: "Listen to the conversation and answer the questions.",
        groupAudio: true, // Audio chung cho c·∫£ nh√≥m
        script: "Man: Hey, have you seen the new blueprints for the wiring project?\nWoman: No, I haven't. I thought they were still being reviewed by the chief engineer.\nMan: Well, he approved them this morning. We need to start the installation by Wednesday.\nWoman: That's tight! I'll call the team and arrange a meeting this afternoon.",
        questions: [
            { id: 21, q: "What are the speakers discussing?", options: ["A budget plan", "Project blueprints", "A holiday party", "New computers"], ans: 1, expl: "Keyword: 'blueprints for the wiring project'." },
            { id: 22, q: "Who approved the plans?", options: ["The woman", "The client", "The chief engineer", "The architect"], ans: 2, expl: "Man says: 'he (chief engineer) approved them'." },
            { id: 23, q: "What will happen this afternoon?", options: ["Installation starts", "A meeting", "Blueprint review", "Project finish"], ans: 1, expl: "Woman says: 'arrange a meeting this afternoon'." }
        ]
    },
    {
        groupAudio: true,
        script: "Woman: Excuse me, I bought this electric drill here yesterday, but it doesn't work properly.\nMan: I'm sorry to hear that. Does it not turn on at all?\nWoman: It turns on, but it makes a strange grinding noise and smells like burning plastic.\nMan: It sounds like a motor issue. Since you bought it yesterday, I can exchange it for a new one immediately.",
        questions: [
            { id: 24, q: "Where is this conversation taking place?", options: ["At a repair shop", "At a hardware store", "At a construction site", "In a factory"], ans: 1, expl: "Context: Buying and exchanging a tool." },
            { id: 25, q: "What is the problem with the drill?", options: ["It won't turn on", "It is too heavy", "It makes noise and smells bad", "It is the wrong color"], ans: 2, expl: "Woman says: 'strange grinding noise and smells'." },
            { id: 26, q: "What does the man offer to do?", options: ["Refund the money", "Repair it", "Exchange it", "Call the manager"], ans: 2, expl: "Man says: 'exchange it for a new one'." }
        ]
    },
    {
        groupAudio: true,
        script: "Man: Do you know if the bus to the industrial park stops here?\nWoman: No, the 501 bus stop has been moved to Main Street due to the road construction.\nMan: Oh no, I'm going to be late for my shift at the factory. Is it far?\nWoman: It's about a 10-minute walk. If you hurry, you might catch the 8:15 bus.",
        questions: [
            { id: 27, q: "Where does the man want to go?", options: ["To the city center", "To the industrial park", "To Main Street", "To the hospital"], ans: 1, expl: "Man asks about bus to 'industrial park'." },
            { id: 28, q: "Why was the bus stop moved?", options: ["Road construction", "Traffic jam", "Accident", "Holiday parade"], ans: 0, expl: "Keyword: 'due to road construction'." },
            { id: 29, q: "How long is the walk to the new stop?", options: ["5 minutes", "10 minutes", "15 minutes", "20 minutes"], ans: 1, expl: "Keyword: '10-minute walk'." },
            { id: 30, q: "What time is the next bus?", options: ["8:00", "8:10", "8:15", "8:30"], ans: 2, expl: "Keyword: '8:15 bus'." }
        ]
    },
    // --- PART 4: SHORT TALKS (31-40) ---
    {
        section: "PART 4: SHORT TALKS (10 Questions)",
        desc: "Listen to the talk/announcement and answer the questions.",
        groupAudio: true,
        script: "Attention everyone. This is a reminder that the annual fire safety drill will take place tomorrow at 10 AM. When you hear the alarm, please stop all work immediately. Do not use the elevators. Proceed calmly to the nearest emergency exit and gather at the assembly point in the north parking lot. Attendance will be taken by your supervisors.",
        questions: [
            { id: 31, q: "What is the announcement about?", options: ["A holiday party", "A fire safety drill", "A new elevator", "A parking lot closure"], ans: 1, expl: "Keyword: 'fire safety drill'." },
            { id: 32, q: "When will the event happen?", options: ["Today at 10 AM", "Tomorrow at 10 AM", "Next week", "In the afternoon"], ans: 1, expl: "Keyword: 'tomorrow at 10 AM'." },
            { id: 33, q: "Where should employees gather?", options: ["In the lobby", "In the cafeteria", "In the north parking lot", "In the basement"], ans: 2, expl: "Keyword: 'north parking lot'." }
        ]
    },
    {
        groupAudio: true,
        script: "Welcome to the Museum of Technology. Today, we are opening a new exhibit called 'The Future of Energy'. In this exhibit, you will see models of advanced solar panels, wind turbines, and nuclear fusion reactors. We also have an interactive section where you can try generating electricity yourself using a hand-crank generator. The tour starts in 5 minutes.",
        questions: [
            { id: 34, q: "Where is the speaker?", options: ["At a school", "At a museum", "At a power plant", "At a store"], ans: 1, expl: "Keyword: 'Museum of Technology'." },
            { id: 35, q: "What is the name of the new exhibit?", options: ["History of Cars", "The Future of Energy", "Space Exploration", "Digital World"], ans: 1, expl: "Keyword: 'The Future of Energy'." },
            { id: 36, q: "What can visitors do in the interactive section?", options: ["Buy souvenirs", "Watch a movie", "Generate electricity", "Eat lunch"], ans: 2, expl: "Keyword: 'generating electricity yourself'." },
            { id: 37, q: "When does the tour start?", options: ["In 5 minutes", "In 10 minutes", "In 1 hour", "Tomorrow"], ans: 0, expl: "Keyword: 'starts in 5 minutes'." }
        ]
    },
    {
        groupAudio: true,
        script: "This is a traffic update for the morning commute. Heavy congestion is reported on the King's Bridge due to a stalled truck in the middle lane. Police are on the scene, but delays are expected to last for at least an hour. We recommend taking the Tunnel Route or using public transportation today to avoid being late.",
        questions: [
            { id: 38, q: "What is causing the traffic jam?", options: ["Road maintenance", "A stalled truck", "Bad weather", "A protest"], ans: 1, expl: "Keyword: 'stalled truck'." },
            { id: 39, q: "How long are delays expected to last?", options: ["10 minutes", "30 minutes", "At least an hour", "All day"], ans: 2, expl: "Keyword: 'at least an hour'." },
            { id: 40, q: "What does the speaker suggest?", options: ["Waiting in the car", "Going home", "Taking the Tunnel Route", "Driving faster"], ans: 2, expl: "Keyword: 'recommend taking the Tunnel Route'." }
        ]
    }
];

// --- MAIN LOGIC ---
let allData = [...part1Data, ...part2Data];
let timer;
let timeLeft = 60 * 60; // 60 minutes
let synth = window.speechSynthesis;
let isSubmitted = false;

function init() {
    // Render Map
    const map = document.getElementById('map');
    for(let i=1; i<=40; i++) {
        const dot = document.createElement('div');
        dot.className = 'q-dot';
        dot.id = `dot-${i}`;
        dot.innerText = i;
        dot.onclick = () => {
            document.getElementById(`q-${i}`).scrollIntoView({behavior: "smooth", block: "center"});
        };
        map.appendChild(dot);
    }

    // Render Content
    const container = document.getElementById('examContainer');
    allData.forEach(block => {
        // Render Header for Section
        if(block.section) {
            container.innerHTML += `<div class="section-header">${block.section}</div><div class="desc-text">${block.desc}</div>`;
        }
        
        // Render Audio Player (Shared or Individual)
        let audioScript = block.script || ""; 
        if (!block.groupAudio && block.questions) {
            // For Part 1, 2 where each question has audio inside logic but not displayed
             // Logic handles inside loop
        } else {
             // For Part 3, 4
             container.innerHTML += `
                <div class="audio-box">
                    <button class="play-btn" onclick="playAudio('${audioScript.replace(/\n/g, ' ').replace(/'/g, "\\'")}', this)">‚ñ∂</button>
                    <span style="font-weight:600; color:#555">LISTEN TO AUDIO CLIP</span>
                </div>
             `;
        }

        // Render Questions
        block.questions.forEach(q => {
             let scriptForSingle = "";
             if(block.section.includes("PART 1") || block.section.includes("PART 2")) {
                 scriptForSingle = `
                    <div class="audio-box" style="margin-top:10px; padding:10px; border-radius:10px; width:fit-content;">
                        <button class="play-btn" style="width:40px; height:40px; font-size:1rem" onclick="playAudio('${q.s.replace(/'/g, "\\'")}', this)">‚ñ∂</button>
                        <span style="font-size:0.9rem; margin-left:10px;">Question ${q.id} Audio</span>
                    </div>
                 `;
             }

             let optionsHtml = "";
             q.options.forEach((opt, idx) => {
                 optionsHtml += `<label><input type="radio" name="ans-${q.id}" value="${idx}" onchange="markDot(${q.id})"> ${opt}</label>`;
             });

             container.innerHTML += `
                <div class="q-card" id="q-${q.id}">
                    ${scriptForSingle}
                    <div class="q-title">${q.q}</div>
                    <div class="options">${optionsHtml}</div>
                    <div class="script-reveal" id="reveal-${q.id}">
                        <b>Script:</b> "${q.s || block.script || "See group script"}" <br>
                        <b>Gi·∫£i th√≠ch:</b> ${q.expl} <br>
                        <b>ƒê√°p √°n ƒë√∫ng:</b> ${q.options[q.ans]}
                    </div>
                </div>
             `;
        });
    });

    startTimer();
}

function playAudio(text, btn) {
    if(isSubmitted) return; // Hard mode: No replay after submit (optional)
    synth.cancel();
    document.querySelectorAll('.play-btn').forEach(b => { b.classList.remove('playing'); b.innerText = "‚ñ∂"; });
    
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-US';
    utterance.rate = 1.05; // Slightly faster for advanced
    
    btn.classList.add('playing');
    btn.innerText = "üîä";
    
    utterance.onend = () => {
        btn.classList.remove('playing');
        btn.innerText = "‚ñ∂";
    };
    synth.speak(utterance);
}

function markDot(id) {
    document.getElementById(`dot-${id}`).classList.add('done');
}

function startTimer() {
    timer = setInterval(() => {
        if(timeLeft <= 0) {
            finishExam();
            return;
        }
        timeLeft--;
        let m = Math.floor(timeLeft / 60);
        let s = timeLeft % 60;
        document.getElementById('timer').innerText = `${m}:${s < 10 ? '0'+s : s}`;
    }, 1000);
}

function finishExam() {
    if(isSubmitted) return;
    if(!confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën n·ªôp b√†i?")) return;
    
    isSubmitted = true;
    clearInterval(timer);
    synth.cancel();

    let score = 0;
    
    // Check Part 1 & 2
    part1Data.forEach(p => p.questions.forEach(checkQ));
    // Check Part 3 & 4
    part2Data.forEach(p => p.questions.forEach(checkQ));

    function checkQ(q) {
        const sel = document.querySelector(`input[name="ans-${q.id}"]:checked`);
        const dot = document.getElementById(`dot-${q.id}`);
        const reveal = document.getElementById(`reveal-${q.id}`);
        const card = document.getElementById(`q-${q.id}`);
        
        reveal.style.display = 'block';

        if (sel && parseInt(sel.value) === q.ans) {
            score++;
            dot.className = "q-dot right";
            card.style.borderLeftColor = "#0be881";
        } else {
            dot.className = "q-dot wrong";
            card.style.borderLeftColor = "#ff5e57";
        }
    }

    alert(`K·∫æT QU·∫¢ C·ª¶A B·∫†N: ${score}/40\nKi·ªÉm tra l·∫°i ƒë√°p √°n v√† gi·∫£i th√≠ch b√™n d∆∞·ªõi.`);
    window.scrollTo(0,0);
}

// Ch·∫°y kh·ªüi t·∫°o
init();

</script>
</body>
</html>
